!function (e, t) { for (var n in t) e[n] = t[n] }(window, function (e) { var t = {}; function n(r) { if (t[r]) return t[r].exports; var i = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(i.exports, i, i.exports, n), i.l = !0, i.exports } return n.m = e, n.c = t, n.d = function (e, t, r) { n.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: r }) }, n.r = function (e) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, n.t = function (e, t) { if (1 & t && (e = n(e)), 8 & t) return e; if (4 & t && "object" == typeof e && e && e.__esModule) return e; var r = Object.create(null); if (n.r(r), Object.defineProperty(r, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var i in e) n.d(r, i, function (t) { return e[t] }.bind(null, i)); return r }, n.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return n.d(t, "a", t), t }, n.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, n.p = "", n(n.s = 5) }([function (e, t, n) { "use strict"; var r = n(21), i = n(65), o = Object.prototype.toString; function a(e) { return "[object Array]" === o.call(e) } function s(e) { return null !== e && "object" == typeof e } function c(e) { return "[object Function]" === o.call(e) } function u(e, t) { if (null != e) if ("object" != typeof e && (e = [e]), a(e)) for (var n = 0, r = e.length; n < r; n++)t.call(null, e[n], n, e); else for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && t.call(null, e[i], i, e) } e.exports = { isArray: a, isArrayBuffer: function (e) { return "[object ArrayBuffer]" === o.call(e) }, isBuffer: i, isFormData: function (e) { return "undefined" != typeof FormData && e instanceof FormData }, isArrayBufferView: function (e) { return "undefined" != typeof ArrayBuffer && ArrayBuffer.isView ? ArrayBuffer.isView(e) : e && e.buffer && e.buffer instanceof ArrayBuffer }, isString: function (e) { return "string" == typeof e }, isNumber: function (e) { return "number" == typeof e }, isObject: s, isUndefined: function (e) { return void 0 === e }, isDate: function (e) { return "[object Date]" === o.call(e) }, isFile: function (e) { return "[object File]" === o.call(e) }, isBlob: function (e) { return "[object Blob]" === o.call(e) }, isFunction: c, isStream: function (e) { return s(e) && c(e.pipe) }, isURLSearchParams: function (e) { return "undefined" != typeof URLSearchParams && e instanceof URLSearchParams }, isStandardBrowserEnv: function () { return ("undefined" == typeof navigator || "ReactNative" !== navigator.product && "NativeScript" !== navigator.product && "NS" !== navigator.product) && ("undefined" != typeof window && "undefined" != typeof document) }, forEach: u, merge: function e() { var t = {}; function n(n, r) { "object" == typeof t[r] && "object" == typeof n ? t[r] = e(t[r], n) : t[r] = n } for (var r = 0, i = arguments.length; r < i; r++)u(arguments[r], n); return t }, deepMerge: function e() { var t = {}; function n(n, r) { "object" == typeof t[r] && "object" == typeof n ? t[r] = e(t[r], n) : t[r] = "object" == typeof n ? e({}, n) : n } for (var r = 0, i = arguments.length; r < i; r++)u(arguments[r], n); return t }, extend: function (e, t, n) { return u(t, (function (t, i) { e[i] = n && "function" == typeof t ? r(t, n) : t })), e }, trim: function (e) { return e.replace(/^\s*/, "").replace(/\s*$/, "") } } }, function (e, t, n) { (function (e) { var r = Object.getOwnPropertyDescriptors || function (e) { for (var t = Object.keys(e), n = {}, r = 0; r < t.length; r++)n[t[r]] = Object.getOwnPropertyDescriptor(e, t[r]); return n }, i = /%[sdj%]/g; t.format = function (e) { if (!g(e)) { for (var t = [], n = 0; n < arguments.length; n++)t.push(s(arguments[n])); return t.join(" ") } n = 1; for (var r = arguments, o = r.length, a = String(e).replace(i, (function (e) { if ("%%" === e) return "%"; if (n >= o) return e; switch (e) { case "%s": return String(r[n++]); case "%d": return Number(r[n++]); case "%j": try { return JSON.stringify(r[n++]) } catch (e) { return "[Circular]" } default: return e } })), c = r[n]; n < o; c = r[++n])v(c) || !b(c) ? a += " " + c : a += " " + s(c); return a }, t.deprecate = function (n, r) { if (void 0 !== e && !0 === e.noDeprecation) return n; if (void 0 === e) return function () { return t.deprecate(n, r).apply(this, arguments) }; var i = !1; return function () { if (!i) { if (e.throwDeprecation) throw new Error(r); e.traceDeprecation ? console.trace(r) : console.error(r), i = !0 } return n.apply(this, arguments) } }; var o, a = {}; function s(e, n) { var r = { seen: [], stylize: u }; return arguments.length >= 3 && (r.depth = arguments[2]), arguments.length >= 4 && (r.colors = arguments[3]), h(n) ? r.showHidden = n : n && t._extend(r, n), y(r.showHidden) && (r.showHidden = !1), y(r.depth) && (r.depth = 2), y(r.colors) && (r.colors = !1), y(r.customInspect) && (r.customInspect = !0), r.colors && (r.stylize = c), f(r, e, r.depth) } function c(e, t) { var n = s.styles[t]; return n ? "[" + s.colors[n][0] + "m" + e + "[" + s.colors[n][1] + "m" : e } function u(e, t) { return e } function f(e, n, r) { if (e.customInspect && n && E(n.inspect) && n.inspect !== t.inspect && (!n.constructor || n.constructor.prototype !== n)) { var i = n.inspect(r, e); return g(i) || (i = f(e, i, r)), i } var o = function (e, t) { if (y(t)) return e.stylize("undefined", "undefined"); if (g(t)) { var n = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'"; return e.stylize(n, "string") } if (m(t)) return e.stylize("" + t, "number"); if (h(t)) return e.stylize("" + t, "boolean"); if (v(t)) return e.stylize("null", "null") }(e, n); if (o) return o; var a = Object.keys(n), s = function (e) { var t = {}; return e.forEach((function (e, n) { t[e] = !0 })), t }(a); if (e.showHidden && (a = Object.getOwnPropertyNames(n)), S(n) && (a.indexOf("message") >= 0 || a.indexOf("description") >= 0)) return l(n); if (0 === a.length) { if (E(n)) { var c = n.name ? ": " + n.name : ""; return e.stylize("[Function" + c + "]", "special") } if (_(n)) return e.stylize(RegExp.prototype.toString.call(n), "regexp"); if (C(n)) return e.stylize(Date.prototype.toString.call(n), "date"); if (S(n)) return l(n) } var u, b = "", T = !1, w = ["{", "}"]; (p(n) && (T = !0, w = ["[", "]"]), E(n)) && (b = " [Function" + (n.name ? ": " + n.name : "") + "]"); return _(n) && (b = " " + RegExp.prototype.toString.call(n)), C(n) && (b = " " + Date.prototype.toUTCString.call(n)), S(n) && (b = " " + l(n)), 0 !== a.length || T && 0 != n.length ? r < 0 ? _(n) ? e.stylize(RegExp.prototype.toString.call(n), "regexp") : e.stylize("[Object]", "special") : (e.seen.push(n), u = T ? function (e, t, n, r, i) { for (var o = [], a = 0, s = t.length; a < s; ++a)P(t, String(a)) ? o.push(d(e, t, n, r, String(a), !0)) : o.push(""); return i.forEach((function (i) { i.match(/^\d+$/) || o.push(d(e, t, n, r, i, !0)) })), o }(e, n, r, s, a) : a.map((function (t) { return d(e, n, r, s, t, T) })), e.seen.pop(), function (e, t, n) { if (e.reduce((function (e, t) { return t.indexOf("\n") >= 0 && 0, e + t.replace(/\u001b\[\d\d?m/g, "").length + 1 }), 0) > 60) return n[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + n[1]; return n[0] + t + " " + e.join(", ") + " " + n[1] }(u, b, w)) : w[0] + b + w[1] } function l(e) { return "[" + Error.prototype.toString.call(e) + "]" } function d(e, t, n, r, i, o) { var a, s, c; if ((c = Object.getOwnPropertyDescriptor(t, i) || { value: t[i] }).get ? s = c.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : c.set && (s = e.stylize("[Setter]", "special")), P(r, i) || (a = "[" + i + "]"), s || (e.seen.indexOf(c.value) < 0 ? (s = v(n) ? f(e, c.value, null) : f(e, c.value, n - 1)).indexOf("\n") > -1 && (s = o ? s.split("\n").map((function (e) { return "  " + e })).join("\n").substr(2) : "\n" + s.split("\n").map((function (e) { return "   " + e })).join("\n")) : s = e.stylize("[Circular]", "special")), y(a)) { if (o && i.match(/^\d+$/)) return s; (a = JSON.stringify("" + i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (a = a.substr(1, a.length - 2), a = e.stylize(a, "name")) : (a = a.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"), a = e.stylize(a, "string")) } return a + ": " + s } function p(e) { return Array.isArray(e) } function h(e) { return "boolean" == typeof e } function v(e) { return null === e } function m(e) { return "number" == typeof e } function g(e) { return "string" == typeof e } function y(e) { return void 0 === e } function _(e) { return b(e) && "[object RegExp]" === T(e) } function b(e) { return "object" == typeof e && null !== e } function C(e) { return b(e) && "[object Date]" === T(e) } function S(e) { return b(e) && ("[object Error]" === T(e) || e instanceof Error) } function E(e) { return "function" == typeof e } function T(e) { return Object.prototype.toString.call(e) } function w(e) { return e < 10 ? "0" + e.toString(10) : e.toString(10) } t.debuglog = function (n) { if (y(o) && (o = e.env.NODE_DEBUG || ""), n = n.toUpperCase(), !a[n]) if (new RegExp("\\b" + n + "\\b", "i").test(o)) { var r = e.pid; a[n] = function () { var e = t.format.apply(t, arguments); console.error("%s %d: %s", n, r, e) } } else a[n] = function () { }; return a[n] }, t.inspect = s, s.colors = { bold: [1, 22], italic: [3, 23], underline: [4, 24], inverse: [7, 27], white: [37, 39], grey: [90, 39], black: [30, 39], blue: [34, 39], cyan: [36, 39], green: [32, 39], magenta: [35, 39], red: [31, 39], yellow: [33, 39] }, s.styles = { special: "cyan", number: "yellow", boolean: "yellow", undefined: "grey", null: "bold", string: "green", date: "magenta", regexp: "red" }, t.isArray = p, t.isBoolean = h, t.isNull = v, t.isNullOrUndefined = function (e) { return null == e }, t.isNumber = m, t.isString = g, t.isSymbol = function (e) { return "symbol" == typeof e }, t.isUndefined = y, t.isRegExp = _, t.isObject = b, t.isDate = C, t.isError = S, t.isFunction = E, t.isPrimitive = function (e) { return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" == typeof e || void 0 === e }, t.isBuffer = n(37); var R = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; function k() { var e = new Date, t = [w(e.getHours()), w(e.getMinutes()), w(e.getSeconds())].join(":"); return [e.getDate(), R[e.getMonth()], t].join(" ") } function P(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } t.log = function () { console.log("%s - %s", k(), t.format.apply(t, arguments)) }, t.inherits = n(38), t._extend = function (e, t) { if (!t || !b(t)) return e; for (var n = Object.keys(t), r = n.length; r--;)e[n[r]] = t[n[r]]; return e }; var O = "undefined" != typeof Symbol ? Symbol("util.promisify.custom") : void 0; function D(e, t) { if (!e) { var n = new Error("Promise was rejected with a falsy value"); n.reason = e, e = n } return t(e) } t.promisify = function (e) { if ("function" != typeof e) throw new TypeError('The "original" argument must be of type Function'); if (O && e[O]) { var t; if ("function" != typeof (t = e[O])) throw new TypeError('The "util.promisify.custom" argument must be of type Function'); return Object.defineProperty(t, O, { value: t, enumerable: !1, writable: !1, configurable: !0 }), t } function t() { for (var t, n, r = new Promise((function (e, r) { t = e, n = r })), i = [], o = 0; o < arguments.length; o++)i.push(arguments[o]); i.push((function (e, r) { e ? n(e) : t(r) })); try { e.apply(this, i) } catch (e) { n(e) } return r } return Object.setPrototypeOf(t, Object.getPrototypeOf(e)), O && Object.defineProperty(t, O, { value: t, enumerable: !1, writable: !1, configurable: !0 }), Object.defineProperties(t, r(e)) }, t.promisify.custom = O, t.callbackify = function (t) { if ("function" != typeof t) throw new TypeError('The "original" argument must be of type Function'); function n() { for (var n = [], r = 0; r < arguments.length; r++)n.push(arguments[r]); var i = n.pop(); if ("function" != typeof i) throw new TypeError("The last argument must be of type Function"); var o = this, a = function () { return i.apply(o, arguments) }; t.apply(this, n).then((function (t) { e.nextTick(a, null, t) }), (function (t) { e.nextTick(D, t, a) })) } return Object.setPrototypeOf(n, Object.getPrototypeOf(t)), Object.defineProperties(n, r(t)), n } }).call(this, n(11)) }, function (e, t, n) { "use strict"; var r = { generateIdentifier: function () { return Math.random().toString(36).substr(2, 10) } }; r.localCName = r.generateIdentifier(), r.splitLines = function (e) { return e.trim().split("\n").map((function (e) { return e.trim() })) }, r.splitSections = function (e) { return e.split("\nm=").map((function (e, t) { return (t > 0 ? "m=" + e : e).trim() + "\r\n" })) }, r.getDescription = function (e) { var t = r.splitSections(e); return t && t[0] }, r.getMediaSections = function (e) { var t = r.splitSections(e); return t.shift(), t }, r.matchPrefix = function (e, t) { return r.splitLines(e).filter((function (e) { return 0 === e.indexOf(t) })) }, r.parseCandidate = function (e) { for (var t, n = { foundation: (t = 0 === e.indexOf("a=candidate:") ? e.substring(12).split(" ") : e.substring(10).split(" "))[0], component: parseInt(t[1], 10), protocol: t[2].toLowerCase(), priority: parseInt(t[3], 10), ip: t[4], address: t[4], port: parseInt(t[5], 10), type: t[7] }, r = 8; r < t.length; r += 2)switch (t[r]) { case "raddr": n.relatedAddress = t[r + 1]; break; case "rport": n.relatedPort = parseInt(t[r + 1], 10); break; case "tcptype": n.tcpType = t[r + 1]; break; case "ufrag": n.ufrag = t[r + 1], n.usernameFragment = t[r + 1]; break; default: n[t[r]] = t[r + 1] }return n }, r.writeCandidate = function (e) { var t = []; t.push(e.foundation), t.push(e.component), t.push(e.protocol.toUpperCase()), t.push(e.priority), t.push(e.address || e.ip), t.push(e.port); var n = e.type; return t.push("typ"), t.push(n), "host" !== n && e.relatedAddress && e.relatedPort && (t.push("raddr"), t.push(e.relatedAddress), t.push("rport"), t.push(e.relatedPort)), e.tcpType && "tcp" === e.protocol.toLowerCase() && (t.push("tcptype"), t.push(e.tcpType)), (e.usernameFragment || e.ufrag) && (t.push("ufrag"), t.push(e.usernameFragment || e.ufrag)), "candidate:" + t.join(" ") }, r.parseIceOptions = function (e) { return e.substr(14).split(" ") }, r.parseRtpMap = function (e) { var t = e.substr(9).split(" "), n = { payloadType: parseInt(t.shift(), 10) }; return t = t[0].split("/"), n.name = t[0], n.clockRate = parseInt(t[1], 10), n.channels = 3 === t.length ? parseInt(t[2], 10) : 1, n.numChannels = n.channels, n }, r.writeRtpMap = function (e) { var t = e.payloadType; void 0 !== e.preferredPayloadType && (t = e.preferredPayloadType); var n = e.channels || e.numChannels || 1; return "a=rtpmap:" + t + " " + e.name + "/" + e.clockRate + (1 !== n ? "/" + n : "") + "\r\n" }, r.parseExtmap = function (e) { var t = e.substr(9).split(" "); return { id: parseInt(t[0], 10), direction: t[0].indexOf("/") > 0 ? t[0].split("/")[1] : "sendrecv", uri: t[1] } }, r.writeExtmap = function (e) { return "a=extmap:" + (e.id || e.preferredId) + (e.direction && "sendrecv" !== e.direction ? "/" + e.direction : "") + " " + e.uri + "\r\n" }, r.parseFmtp = function (e) { for (var t, n = {}, r = e.substr(e.indexOf(" ") + 1).split(";"), i = 0; i < r.length; i++)n[(t = r[i].trim().split("="))[0].trim()] = t[1]; return n }, r.writeFmtp = function (e) { var t = "", n = e.payloadType; if (void 0 !== e.preferredPayloadType && (n = e.preferredPayloadType), e.parameters && Object.keys(e.parameters).length) { var r = []; Object.keys(e.parameters).forEach((function (t) { e.parameters[t] ? r.push(t + "=" + e.parameters[t]) : r.push(t) })), t += "a=fmtp:" + n + " " + r.join(";") + "\r\n" } return t }, r.parseRtcpFb = function (e) { var t = e.substr(e.indexOf(" ") + 1).split(" "); return { type: t.shift(), parameter: t.join(" ") } }, r.writeRtcpFb = function (e) { var t = "", n = e.payloadType; return void 0 !== e.preferredPayloadType && (n = e.preferredPayloadType), e.rtcpFeedback && e.rtcpFeedback.length && e.rtcpFeedback.forEach((function (e) { t += "a=rtcp-fb:" + n + " " + e.type + (e.parameter && e.parameter.length ? " " + e.parameter : "") + "\r\n" })), t }, r.parseSsrcMedia = function (e) { var t = e.indexOf(" "), n = { ssrc: parseInt(e.substr(7, t - 7), 10) }, r = e.indexOf(":", t); return r > -1 ? (n.attribute = e.substr(t + 1, r - t - 1), n.value = e.substr(r + 1)) : n.attribute = e.substr(t + 1), n }, r.parseSsrcGroup = function (e) { var t = e.substr(13).split(" "); return { semantics: t.shift(), ssrcs: t.map((function (e) { return parseInt(e, 10) })) } }, r.getMid = function (e) { var t = r.matchPrefix(e, "a=mid:")[0]; if (t) return t.substr(6) }, r.parseFingerprint = function (e) { var t = e.substr(14).split(" "); return { algorithm: t[0].toLowerCase(), value: t[1] } }, r.getDtlsParameters = function (e, t) { return { role: "auto", fingerprints: r.matchPrefix(e + t, "a=fingerprint:").map(r.parseFingerprint) } }, r.writeDtlsParameters = function (e, t) { var n = "a=setup:" + t + "\r\n"; return e.fingerprints.forEach((function (e) { n += "a=fingerprint:" + e.algorithm + " " + e.value + "\r\n" })), n }, r.parseCryptoLine = function (e) { var t = e.substr(9).split(" "); return { tag: parseInt(t[0], 10), cryptoSuite: t[1], keyParams: t[2], sessionParams: t.slice(3) } }, r.writeCryptoLine = function (e) { return "a=crypto:" + e.tag + " " + e.cryptoSuite + " " + ("object" == typeof e.keyParams ? r.writeCryptoKeyParams(e.keyParams) : e.keyParams) + (e.sessionParams ? " " + e.sessionParams.join(" ") : "") + "\r\n" }, r.parseCryptoKeyParams = function (e) { if (0 !== e.indexOf("inline:")) return null; var t = e.substr(7).split("|"); return { keyMethod: "inline", keySalt: t[0], lifeTime: t[1], mkiValue: t[2] ? t[2].split(":")[0] : void 0, mkiLength: t[2] ? t[2].split(":")[1] : void 0 } }, r.writeCryptoKeyParams = function (e) { return e.keyMethod + ":" + e.keySalt + (e.lifeTime ? "|" + e.lifeTime : "") + (e.mkiValue && e.mkiLength ? "|" + e.mkiValue + ":" + e.mkiLength : "") }, r.getCryptoParameters = function (e, t) { return r.matchPrefix(e + t, "a=crypto:").map(r.parseCryptoLine) }, r.getIceParameters = function (e, t) { var n = r.matchPrefix(e + t, "a=ice-ufrag:")[0], i = r.matchPrefix(e + t, "a=ice-pwd:")[0]; return n && i ? { usernameFragment: n.substr(12), password: i.substr(10) } : null }, r.writeIceParameters = function (e) { return "a=ice-ufrag:" + e.usernameFragment + "\r\na=ice-pwd:" + e.password + "\r\n" }, r.parseRtpParameters = function (e) { for (var t = { codecs: [], headerExtensions: [], fecMechanisms: [], rtcp: [] }, n = r.splitLines(e)[0].split(" "), i = 3; i < n.length; i++) { var o = n[i], a = r.matchPrefix(e, "a=rtpmap:" + o + " ")[0]; if (a) { var s = r.parseRtpMap(a), c = r.matchPrefix(e, "a=fmtp:" + o + " "); switch (s.parameters = c.length ? r.parseFmtp(c[0]) : {}, s.rtcpFeedback = r.matchPrefix(e, "a=rtcp-fb:" + o + " ").map(r.parseRtcpFb), t.codecs.push(s), s.name.toUpperCase()) { case "RED": case "ULPFEC": t.fecMechanisms.push(s.name.toUpperCase()) } } } return r.matchPrefix(e, "a=extmap:").forEach((function (e) { t.headerExtensions.push(r.parseExtmap(e)) })), t }, r.writeRtpDescription = function (e, t) { var n = ""; n += "m=" + e + " ", n += t.codecs.length > 0 ? "9" : "0", n += " UDP/TLS/RTP/SAVPF ", n += t.codecs.map((function (e) { return void 0 !== e.preferredPayloadType ? e.preferredPayloadType : e.payloadType })).join(" ") + "\r\n", n += "c=IN IP4 0.0.0.0\r\n", n += "a=rtcp:9 IN IP4 0.0.0.0\r\n", t.codecs.forEach((function (e) { n += r.writeRtpMap(e), n += r.writeFmtp(e), n += r.writeRtcpFb(e) })); var i = 0; return t.codecs.forEach((function (e) { e.maxptime > i && (i = e.maxptime) })), i > 0 && (n += "a=maxptime:" + i + "\r\n"), n += "a=rtcp-mux\r\n", t.headerExtensions && t.headerExtensions.forEach((function (e) { n += r.writeExtmap(e) })), n }, r.parseRtpEncodingParameters = function (e) { var t, n = [], i = r.parseRtpParameters(e), o = -1 !== i.fecMechanisms.indexOf("RED"), a = -1 !== i.fecMechanisms.indexOf("ULPFEC"), s = r.matchPrefix(e, "a=ssrc:").map((function (e) { return r.parseSsrcMedia(e) })).filter((function (e) { return "cname" === e.attribute })), c = s.length > 0 && s[0].ssrc, u = r.matchPrefix(e, "a=ssrc-group:FID").map((function (e) { return e.substr(17).split(" ").map((function (e) { return parseInt(e, 10) })) })); u.length > 0 && u[0].length > 1 && u[0][0] === c && (t = u[0][1]), i.codecs.forEach((function (e) { if ("RTX" === e.name.toUpperCase() && e.parameters.apt) { var r = { ssrc: c, codecPayloadType: parseInt(e.parameters.apt, 10) }; c && t && (r.rtx = { ssrc: t }), n.push(r), o && ((r = JSON.parse(JSON.stringify(r))).fec = { ssrc: c, mechanism: a ? "red+ulpfec" : "red" }, n.push(r)) } })), 0 === n.length && c && n.push({ ssrc: c }); var f = r.matchPrefix(e, "b="); return f.length && (f = 0 === f[0].indexOf("b=TIAS:") ? parseInt(f[0].substr(7), 10) : 0 === f[0].indexOf("b=AS:") ? 1e3 * parseInt(f[0].substr(5), 10) * .95 - 16e3 : void 0, n.forEach((function (e) { e.maxBitrate = f }))), n }, r.parseRtcpParameters = function (e) { var t = {}, n = r.matchPrefix(e, "a=ssrc:").map((function (e) { return r.parseSsrcMedia(e) })).filter((function (e) { return "cname" === e.attribute }))[0]; n && (t.cname = n.value, t.ssrc = n.ssrc); var i = r.matchPrefix(e, "a=rtcp-rsize"); t.reducedSize = i.length > 0, t.compound = 0 === i.length; var o = r.matchPrefix(e, "a=rtcp-mux"); return t.mux = o.length > 0, t }, r.parseMsid = function (e) { var t, n = r.matchPrefix(e, "a=msid:"); if (1 === n.length) return { stream: (t = n[0].substr(7).split(" "))[0], track: t[1] }; var i = r.matchPrefix(e, "a=ssrc:").map((function (e) { return r.parseSsrcMedia(e) })).filter((function (e) { return "msid" === e.attribute })); return i.length > 0 ? { stream: (t = i[0].value.split(" "))[0], track: t[1] } : void 0 }, r.parseSctpDescription = function (e) { var t, n = r.parseMLine(e), i = r.matchPrefix(e, "a=max-message-size:"); i.length > 0 && (t = parseInt(i[0].substr(19), 10)), isNaN(t) && (t = 65536); var o = r.matchPrefix(e, "a=sctp-port:"); if (o.length > 0) return { port: parseInt(o[0].substr(12), 10), protocol: n.fmt, maxMessageSize: t }; if (r.matchPrefix(e, "a=sctpmap:").length > 0) { var a = r.matchPrefix(e, "a=sctpmap:")[0].substr(10).split(" "); return { port: parseInt(a[0], 10), protocol: a[1], maxMessageSize: t } } }, r.writeSctpDescription = function (e, t) { var n = []; return n = "DTLS/SCTP" !== e.protocol ? ["m=" + e.kind + " 9 " + e.protocol + " " + t.protocol + "\r\n", "c=IN IP4 0.0.0.0\r\n", "a=sctp-port:" + t.port + "\r\n"] : ["m=" + e.kind + " 9 " + e.protocol + " " + t.port + "\r\n", "c=IN IP4 0.0.0.0\r\n", "a=sctpmap:" + t.port + " " + t.protocol + " 65535\r\n"], void 0 !== t.maxMessageSize && n.push("a=max-message-size:" + t.maxMessageSize + "\r\n"), n.join("") }, r.generateSessionId = function () { return Math.random().toString().substr(2, 21) }, r.writeSessionBoilerplate = function (e, t, n) { var i = void 0 !== t ? t : 2; return "v=0\r\no=" + (n || "thisisadapterortc") + " " + (e || r.generateSessionId()) + " " + i + " IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n" }, r.writeMediaSection = function (e, t, n, i) { var o = r.writeRtpDescription(e.kind, t); if (o += r.writeIceParameters(e.iceGatherer.getLocalParameters()), o += r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(), "offer" === n ? "actpass" : "active"), o += "a=mid:" + e.mid + "\r\n", e.direction ? o += "a=" + e.direction + "\r\n" : e.rtpSender && e.rtpReceiver ? o += "a=sendrecv\r\n" : e.rtpSender ? o += "a=sendonly\r\n" : e.rtpReceiver ? o += "a=recvonly\r\n" : o += "a=inactive\r\n", e.rtpSender) { var a = "msid:" + i.id + " " + e.rtpSender.track.id + "\r\n"; o += "a=" + a, o += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + a, e.sendEncodingParameters[0].rtx && (o += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + a, o += "a=ssrc-group:FID " + e.sendEncodingParameters[0].ssrc + " " + e.sendEncodingParameters[0].rtx.ssrc + "\r\n") } return o += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " cname:" + r.localCName + "\r\n", e.rtpSender && e.sendEncodingParameters[0].rtx && (o += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " cname:" + r.localCName + "\r\n"), o }, r.getDirection = function (e, t) { for (var n = r.splitLines(e), i = 0; i < n.length; i++)switch (n[i]) { case "a=sendrecv": case "a=sendonly": case "a=recvonly": case "a=inactive": return n[i].substr(2) }return t ? r.getDirection(t) : "sendrecv" }, r.getKind = function (e) { return r.splitLines(e)[0].split(" ")[0].substr(2) }, r.isRejected = function (e) { return "0" === e.split(" ", 2)[1] }, r.parseMLine = function (e) { var t = r.splitLines(e)[0].substr(2).split(" "); return { kind: t[0], port: parseInt(t[1], 10), protocol: t[2], fmt: t.slice(3).join(" ") } }, r.parseOLine = function (e) { var t = r.matchPrefix(e, "o=")[0].substr(2).split(" "); return { username: t[0], sessionId: t[1], sessionVersion: parseInt(t[2], 10), netType: t[3], addressType: t[4], address: t[5] } }, r.isValidSDP = function (e) { if ("string" != typeof e || 0 === e.length) return !1; for (var t = r.splitLines(e), n = 0; n < t.length; n++)if (t[n].length < 2 || "=" !== t[n].charAt(1)) return !1; return !0 }, e.exports = r }, function (e, t, n) { "use strict"; var r, i = "object" == typeof Reflect ? Reflect : null, o = i && "function" == typeof i.apply ? i.apply : function (e, t, n) { return Function.prototype.apply.call(e, t, n) }; r = i && "function" == typeof i.ownKeys ? i.ownKeys : Object.getOwnPropertySymbols ? function (e) { return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)) } : function (e) { return Object.getOwnPropertyNames(e) }; var a = Number.isNaN || function (e) { return e != e }; function s() { s.init.call(this) } e.exports = s, s.EventEmitter = s, s.prototype._events = void 0, s.prototype._eventsCount = 0, s.prototype._maxListeners = void 0; var c = 10; function u(e) { if ("function" != typeof e) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e) } function f(e) { return void 0 === e._maxListeners ? s.defaultMaxListeners : e._maxListeners } function l(e, t, n, r) { var i, o, a, s; if (u(n), void 0 === (o = e._events) ? (o = e._events = Object.create(null), e._eventsCount = 0) : (void 0 !== o.newListener && (e.emit("newListener", t, n.listener ? n.listener : n), o = e._events), a = o[t]), void 0 === a) a = o[t] = n, ++e._eventsCount; else if ("function" == typeof a ? a = o[t] = r ? [n, a] : [a, n] : r ? a.unshift(n) : a.push(n), (i = f(e)) > 0 && a.length > i && !a.warned) { a.warned = !0; var c = new Error("Possible EventEmitter memory leak detected. " + a.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit"); c.name = "MaxListenersExceededWarning", c.emitter = e, c.type = t, c.count = a.length, s = c, console && console.warn && console.warn(s) } return e } function d() { if (!this.fired) return this.target.removeListener(this.type, this.wrapFn), this.fired = !0, 0 === arguments.length ? this.listener.call(this.target) : this.listener.apply(this.target, arguments) } function p(e, t, n) { var r = { fired: !1, wrapFn: void 0, target: e, type: t, listener: n }, i = d.bind(r); return i.listener = n, r.wrapFn = i, i } function h(e, t, n) { var r = e._events; if (void 0 === r) return []; var i = r[t]; return void 0 === i ? [] : "function" == typeof i ? n ? [i.listener || i] : [i] : n ? function (e) { for (var t = new Array(e.length), n = 0; n < t.length; ++n)t[n] = e[n].listener || e[n]; return t }(i) : m(i, i.length) } function v(e) { var t = this._events; if (void 0 !== t) { var n = t[e]; if ("function" == typeof n) return 1; if (void 0 !== n) return n.length } return 0 } function m(e, t) { for (var n = new Array(t), r = 0; r < t; ++r)n[r] = e[r]; return n } Object.defineProperty(s, "defaultMaxListeners", { enumerable: !0, get: function () { return c }, set: function (e) { if ("number" != typeof e || e < 0 || a(e)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + e + "."); c = e } }), s.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, s.prototype.setMaxListeners = function (e) { if ("number" != typeof e || e < 0 || a(e)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + e + "."); return this._maxListeners = e, this }, s.prototype.getMaxListeners = function () { return f(this) }, s.prototype.emit = function (e) { for (var t = [], n = 1; n < arguments.length; n++)t.push(arguments[n]); var r = "error" === e, i = this._events; if (void 0 !== i) r = r && void 0 === i.error; else if (!r) return !1; if (r) { var a; if (t.length > 0 && (a = t[0]), a instanceof Error) throw a; var s = new Error("Unhandled error." + (a ? " (" + a.message + ")" : "")); throw s.context = a, s } var c = i[e]; if (void 0 === c) return !1; if ("function" == typeof c) o(c, this, t); else { var u = c.length, f = m(c, u); for (n = 0; n < u; ++n)o(f[n], this, t) } return !0 }, s.prototype.addListener = function (e, t) { return l(this, e, t, !1) }, s.prototype.on = s.prototype.addListener, s.prototype.prependListener = function (e, t) { return l(this, e, t, !0) }, s.prototype.once = function (e, t) { return u(t), this.on(e, p(this, e, t)), this }, s.prototype.prependOnceListener = function (e, t) { return u(t), this.prependListener(e, p(this, e, t)), this }, s.prototype.removeListener = function (e, t) { var n, r, i, o, a; if (u(t), void 0 === (r = this._events)) return this; if (void 0 === (n = r[e])) return this; if (n === t || n.listener === t) 0 == --this._eventsCount ? this._events = Object.create(null) : (delete r[e], r.removeListener && this.emit("removeListener", e, n.listener || t)); else if ("function" != typeof n) { for (i = -1, o = n.length - 1; o >= 0; o--)if (n[o] === t || n[o].listener === t) { a = n[o].listener, i = o; break } if (i < 0) return this; 0 === i ? n.shift() : function (e, t) { for (; t + 1 < e.length; t++)e[t] = e[t + 1]; e.pop() }(n, i), 1 === n.length && (r[e] = n[0]), void 0 !== r.removeListener && this.emit("removeListener", e, a || t) } return this }, s.prototype.off = s.prototype.removeListener, s.prototype.removeAllListeners = function (e) { var t, n, r; if (void 0 === (n = this._events)) return this; if (void 0 === n.removeListener) return 0 === arguments.length ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== n[e] && (0 == --this._eventsCount ? this._events = Object.create(null) : delete n[e]), this; if (0 === arguments.length) { var i, o = Object.keys(n); for (r = 0; r < o.length; ++r)"removeListener" !== (i = o[r]) && this.removeAllListeners(i); return this.removeAllListeners("removeListener"), this._events = Object.create(null), this._eventsCount = 0, this } if ("function" == typeof (t = n[e])) this.removeListener(e, t); else if (void 0 !== t) for (r = t.length - 1; r >= 0; r--)this.removeListener(e, t[r]); return this }, s.prototype.listeners = function (e) { return h(this, e, !0) }, s.prototype.rawListeners = function (e) { return h(this, e, !1) }, s.listenerCount = function (e, t) { return "function" == typeof e.listenerCount ? e.listenerCount(t) : v.call(e, t) }, s.prototype.listenerCount = v, s.prototype.eventNames = function () { return this._eventsCount > 0 ? r(this._events) : [] } }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), function (e) { e[e.INITIALIZED = 0] = "INITIALIZED", e[e.CALLING = 1] = "CALLING", e[e.ESTABLISHED = 2] = "ESTABLISHED", e[e.FINISHED = 3] = "FINISHED" }(t.CallStatus || (t.CallStatus = {})) }, function (e, t, n) { "use strict"; function r(e) { for (var n in e) t.hasOwnProperty(n) || (t[n] = e[n]) } Object.defineProperty(t, "__esModule", { value: !0 }), n(31), r(n(33)), r(n(4)), r(n(7)), r(n(9)), r(n(29)), r(n(85)), r(n(86)), r(n(30)) }, function (e, t, n) { e.exports = n(36) }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.ErrorCode = { NO_PEER_CONNECTION: { id: "5070", name: "NO_PEER_CONNECTION", description: "Peer connection is not created." }, INVALID_DTMF_CONFIG_NO_AUDIO_TRACK: { id: "5071", name: "INVALID_DTMF_CONFIG_NO_AUDIO_TRACK", description: "Invalid DTMF configuration (no audio track)." }, DTMF_UNAVAILABLE: { id: "5072", name: "DTMF_UNAVAILABLE", description: "DTMF function not available." }, INVALID_DTMF_TONE: { id: "5073", name: "INVALID_DTMF_TONE", description: "Illegal DTMF tone sent. Allowed tones are digits 1-9, * and #." }, ACTIVE_CALL_ON_INCOMING_CALL: { id: "5074", name: "ACTIVE_CALL_ON_INCOMING_CALL", description: "Received incoming call while there was another active call." }, NO_LOCAL_STREAM: { id: "5075", name: "NO_LOCAL_STREAM", description: "Local stream is not created." }, NO_AUDIO_TRACK: { id: "5076", name: "NO_AUDIO_TRACK", description: "No audio track." }, NO_VIDEO_TRACK: { id: "5077", name: "NO_VIDEO_TRACK", description: "No video track." }, NO_DISPLAY_MEDIA: { id: "5078", name: "NO_DISPLAY_MEDIA", description: "Display media API is not available." }, UNKNOWN_SHARESCREEN_ERROR: { id: "5079", name: "UNKNOWN_SHARESCREEN_ERROR", description: "Unknown share screen error." } } }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = function (e, t, n, r) { void 0 === r && (r = Date.now()), this.event = e, this.callId = t, this.data = n, this.timestamp = r }; t.Log = o; var a = function (e) { function t(t, n) { return e.call(this, "ice-connection-change", t, n) || this } return i(t, e), t }(o); t.IceConnectionChangeLog = a; var s = function (e) { function t(t, n, r) { return e.call(this, "call-media-stats", t, { stats: n }, r) || this } return i(t, e), t }(o); t.CallMediaStatsLog = s; var c = function (e) { function t(t, n) { return e.call(this, "call-total-media-stats", t, { stats: n }) || this } return i(t, e), t }(o); t.TotalCallMediaStatsLog = c; var u = function (e) { function t(t, n) { return e.call(this, "call-feedback", t, n) || this } return i(t, e), t }(o); t.CallFeedbackLog = u; var f = function (e) { function t(t, n) { return e.call(this, "error", t, n) || this } return i(t, e), t }(o); t.ErrorLog = f }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = function (e, t, n) { this.id = e, this.name = t, this.description = n }; t.HangupStatus = r }, function (e, t, n) { var r = n(3), i = n(6); function o(e) { r.EventEmitter.call(this), this.backoffStrategy_ = e, this.maxNumberOfRetry_ = -1, this.backoffNumber_ = 0, this.backoffDelay_ = 0, this.timeoutID_ = -1, this.handlers = { backoff: this.onBackoff_.bind(this) } } n(1).inherits(o, r.EventEmitter), o.prototype.failAfter = function (e) { i.checkArgument(e > 0, "Expected a maximum number of retry greater than 0 but got %s.", e), this.maxNumberOfRetry_ = e }, o.prototype.backoff = function (e) { i.checkState(-1 === this.timeoutID_, "Backoff in progress."), this.backoffNumber_ === this.maxNumberOfRetry_ ? (this.emit("fail", e), this.reset()) : (this.backoffDelay_ = this.backoffStrategy_.next(), this.timeoutID_ = setTimeout(this.handlers.backoff, this.backoffDelay_), this.emit("backoff", this.backoffNumber_, this.backoffDelay_, e)) }, o.prototype.onBackoff_ = function () { this.timeoutID_ = -1, this.emit("ready", this.backoffNumber_, this.backoffDelay_), this.backoffNumber_++ }, o.prototype.reset = function () { this.backoffNumber_ = 0, this.backoffStrategy_.reset(), clearTimeout(this.timeoutID_), this.timeoutID_ = -1 }, e.exports = o }, function (e, t) { var n, r, i = e.exports = {}; function o() { throw new Error("setTimeout has not been defined") } function a() { throw new Error("clearTimeout has not been defined") } function s(e) { if (n === setTimeout) return setTimeout(e, 0); if ((n === o || !n) && setTimeout) return n = setTimeout, setTimeout(e, 0); try { return n(e, 0) } catch (t) { try { return n.call(null, e, 0) } catch (t) { return n.call(this, e, 0) } } } !function () { try { n = "function" == typeof setTimeout ? setTimeout : o } catch (e) { n = o } try { r = "function" == typeof clearTimeout ? clearTimeout : a } catch (e) { r = a } }(); var c, u = [], f = !1, l = -1; function d() { f && c && (f = !1, c.length ? u = c.concat(u) : l = -1, u.length && p()) } function p() { if (!f) { var e = s(d); f = !0; for (var t = u.length; t;) { for (c = u, u = []; ++l < t;)c && c[l].run(); l = -1, t = u.length } c = null, f = !1, function (e) { if (r === clearTimeout) return clearTimeout(e); if ((r === a || !r) && clearTimeout) return r = clearTimeout, clearTimeout(e); try { r(e) } catch (t) { try { return r.call(null, e) } catch (t) { return r.call(this, e) } } }(e) } } function h(e, t) { this.fun = e, this.array = t } function v() { } i.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)t[n - 1] = arguments[n]; u.push(new h(e, t)), 1 !== u.length || f || s(p) }, h.prototype.run = function () { this.fun.apply(null, this.array) }, i.title = "browser", i.browser = !0, i.env = {}, i.argv = [], i.version = "", i.versions = {}, i.on = v, i.addListener = v, i.once = v, i.off = v, i.removeListener = v, i.removeAllListeners = v, i.emit = v, i.prependListener = v, i.prependOnceListener = v, i.listeners = function (e) { return [] }, i.binding = function (e) { throw new Error("process.binding is not supported") }, i.cwd = function () { return "/" }, i.chdir = function (e) { throw new Error("process.chdir is not supported") }, i.umask = function () { return 0 } }, function (e, t, n) { n(3), n(1); function r(e) { return null != e } function i(e) { if (r((e = e || {}).initialDelay) && e.initialDelay < 1) throw new Error("The initial timeout must be greater than 0."); if (r(e.maxDelay) && e.maxDelay < 1) throw new Error("The maximal timeout must be greater than 0."); if (this.initialDelay_ = e.initialDelay || 100, this.maxDelay_ = e.maxDelay || 1e4, this.maxDelay_ <= this.initialDelay_) throw new Error("The maximal backoff delay must be greater than the initial backoff delay."); if (r(e.randomisationFactor) && (e.randomisationFactor < 0 || e.randomisationFactor > 1)) throw new Error("The randomisation factor must be between 0 and 1."); this.randomisationFactor_ = e.randomisationFactor || 0 } i.prototype.getMaxDelay = function () { return this.maxDelay_ }, i.prototype.getInitialDelay = function () { return this.initialDelay_ }, i.prototype.next = function () { var e = this.next_(), t = 1 + Math.random() * this.randomisationFactor_; return Math.round(e * t) }, i.prototype.next_ = function () { throw new Error("BackoffStrategy.next_() unimplemented.") }, i.prototype.reset = function () { this.reset_() }, i.prototype.reset_ = function () { throw new Error("BackoffStrategy.reset_() unimplemented.") }, e.exports = i }, function (e, t, n) { var r = n(1), i = n(12); function o(e) { i.call(this, e), this.backoffDelay_ = 0, this.nextBackoffDelay_ = this.getInitialDelay() } r.inherits(o, i), o.prototype.next_ = function () { var e = Math.min(this.nextBackoffDelay_, this.getMaxDelay()); return this.nextBackoffDelay_ += this.backoffDelay_, this.backoffDelay_ = e, e }, o.prototype.reset_ = function () { this.nextBackoffDelay_ = this.getInitialDelay(), this.backoffDelay_ = 0 }, e.exports = o }, function (e, t, n) { "use strict"; var r = n(42); function i(e) { this.message = e } i.prototype = new Error, i.prototype.name = "InvalidTokenError", e.exports = function (e, t) { if ("string" != typeof e) throw new i("Invalid token specified"); var n = !0 === (t = t || {}).header ? 0 : 1; try { return JSON.parse(r(e.split(".")[n])) } catch (e) { throw new i("Invalid token specified: " + e.message) } }, e.exports.InvalidTokenError = i }, function (e, t, n) { "use strict"; var r; Object.defineProperty(t, "__esModule", { value: !0 }), function (e) { e[e.OFFLINE = 0] = "OFFLINE", e[e.CONNECTING = 1] = "CONNECTING", e[e.RECONNECTING = 2] = "RECONNECTING", e[e.CONNECTED = 3] = "CONNECTED" }(r || (r = {})), t.default = r, t.StatusLabels = new Map([[r.OFFLINE, "OFFLINE"], [r.CONNECTING, "CONNECTING"], [r.RECONNECTING, "RECONNECTING"], [r.CONNECTED, "CONNECTED"]]) }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(31), i = n(7), o = n(48), a = n(8), s = n(49), c = n(4), u = n(58), f = function () { function e(e, t, n, r, i, o, a, s, f, l, d) { void 0 === l && (l = null), void 0 === d && (d = null), this.eventEmitter = e, this.apiEventEmitter = t, this.gateway = n, this.logger = r, this.rtcConfig = i, this.device = o, this.options = a, this.callSource = s, this.callDestination = f, this.hasRemoteDescription = !1, this.remoteCandidates = [], this.callId = l || u(), this.corrId = d || u(), this.callStatus = c.CallStatus.INITIALIZED, this.callStartTime = new Date } return e.prototype.id = function () { return this.callId }, e.prototype.correlationId = function () { return this.corrId }, e.prototype.source = function () { return this.callSource }, e.prototype.destination = function () { return this.callDestination }, e.prototype.on = function (e, t) { if (!this.getAllowedApiEvents().includes(e)) throw new Error("Unknown event: " + e + "!"); "error" === e ? this.apiEventEmitter.on("call-error", t) : this.apiEventEmitter.once(e, t) }, e.prototype.hangup = function () { this.callStatus !== c.CallStatus.FINISHED && (this.callStatus = c.CallStatus.FINISHED, this.gateway.send({ action: "hangup", callId: this.callId })) }, e.prototype.mute = function (e) { var t = this; return new Promise((function (n, r) { if (t.localStream) { var o = t.localStream.getAudioTracks(); o ? (o.forEach((function (t) { return t.enabled = !e })), n()) : r(i.ErrorCode.NO_AUDIO_TRACK) } else r(i.ErrorCode.NO_LOCAL_STREAM) })) }, e.prototype.sendDTMF = function (e) { var t = this; return new Promise((function (n, r) { e && !e.toString().match(/[^0-9*#w]/) ? (t.dtmfSender || t.createDTMFSender(r), t.dtmfSender && t.dtmfSender.insertDTMF(e, o.default.DTMF_TONE_DURATION, o.default.DTMF_TONE_GAP), n()) : r(i.ErrorCode.INVALID_DTMF_TONE) })) }, e.prototype.shareScreen = function () { var e = this; return new Promise((function (t, n) { if (e.localStream) if (e.localStream.getVideoTracks()) { var r = e.getDisplayMedia(); r ? r.then((function (r) { e.screenStream = r, console.log("Screen share started"), r.oninactive = e.stopShareScreen.bind(e), e.replaceVideoStream(r).then((function () { return t })).catch((function (e) { return n(e) })) })).catch((function (t) { return e.handleShareScreenFlowError(t, n) })) : n(i.ErrorCode.NO_DISPLAY_MEDIA) } else n(i.ErrorCode.NO_VIDEO_TRACK); else n(i.ErrorCode.NO_LOCAL_STREAM) })) }, e.prototype.stopShareScreen = function () { var e = this; return new Promise((function (t, n) { console.log("Screen share stopped"), e.screenStream && e.screenStream.getTracks().forEach((function (e) { return e.stop() })), e.replaceVideoStream(e.localStream).then((function () { return t() })).catch((function (e) { return n(e) })) })) }, e.prototype.sendFeedback = function (e) { if (e.score < 1 || e.score > 5) throw Error("Feedback score must be a number between 1 and 5."); this.logger.log(new a.CallFeedbackLog(this.callId, e)) }, e.prototype.muted = function () { var e = this.localStream; if (!e) return !1; var t = e.getAudioTracks(); if (!t) return !1; var n = !0; return t.forEach((function (e) { !0 !== e.enabled || (n = !1) })), n }, e.prototype.status = function () { return this.callStatus }, e.prototype.duration = function () { return this.callEstablishTime ? this.callEndTime ? this.getDurationInSeconds(this.callEndTime) : this.getDurationInSeconds(new Date) : 0 }, e.prototype.endTime = function () { return this.callEndTime }, e.prototype.establishTime = function () { return this.callEstablishTime }, e.prototype.startTime = function () { return this.callStartTime }, e.prototype.hasLocalVideo = function () { return this.options.video }, e.prototype.hasRemoteVideo = function () { return null != this.remoteStream && 0 !== this.remoteStream.getVideoTracks().length }, e.prototype.createPC = function () { this.pc = new RTCPeerConnection(this.rtcConfig), this.pc.onicecandidate = this.onIceCandidate.bind(this), this.pc.oniceconnectionstatechange = this.onIceConnectionStateChange.bind(this), this.pc.ontrack = this.onTrack.bind(this), this.pcMonitor = new s.PeerConnectionMediaMonitor(this.callId, this.pc, this.options.video, this.logger) }, e.prototype.onIceConnectionStateChange = function () { if (this.pc) { var e = this.pc.iceConnectionState; if ("connected" === e) { var t = { localStream: this.localStream, remoteStream: this.remoteStream }; this.callStatus = c.CallStatus.ESTABLISHED, this.callEstablishTime = new Date, this.apiEventEmitter.emit("established", t) } this.logger.log(new a.IceConnectionChangeLog(this.callId, { state: e })) } }, e.prototype.onTrack = function (e) { this.remoteStream = e.streams[0] }, e.prototype.getLocalStream = function (e) { return void 0 === e && (e = !1), this.device.getLocalStream(e) }, e.prototype.setLocalStream = function (e, t) { return e.localStream = t, t }, e.prototype.setLocalDescription = function (e, t) { return e.setLocalDescription(t), t }, e.prototype.hangupHandler = function (e) { this.callStatus = c.CallStatus.FINISHED, this.apiEventEmitter.emit("hangup", { status: e.status }), this.eventEmitter.emit("call_finished", {}), this.cleanup() }, e.prototype.errorHandler = function (e) { this.logger.log(new a.ErrorLog(this.callId, e.status)), this.callStatus = c.CallStatus.FINISHED, this.apiEventEmitter.emit("call-error", { status: e.status }), this.eventEmitter.emit("call_finished", {}), this.cleanup() }, e.prototype.cleanup = function () { this.callEndTime = new Date, this.pcMonitor && this.pcMonitor.stop(), this.pcCleanup() }, e.prototype.handleTrickleIce = function (e) { this.hasRemoteDescription ? this.addIceCandidate(e.candidate) : this.remoteCandidates.push(e.candidate) }, e.prototype.addTracks = function (e, t) { t.getTracks().forEach((function (n) { return e.addTrack(n, t) })) }, e.prototype.setRemoteCandidates = function () { var e = this; this.remoteCandidates.length > 0 && (this.remoteCandidates.forEach((function (t) { return e.addIceCandidate(t) })), this.remoteCandidates = []) }, e.prototype.pcCleanup = function () { this.pc && (this.pc.close(), this.pc = null, this.hasRemoteDescription = !1), this.localStream && this.localStream.getTracks().forEach((function (e) { return e.stop() })), this.screenStream && this.screenStream.getTracks().forEach((function (e) { return e.stop() })) }, e.prototype.getDisplayMedia = function () { return "firefox" === r.default.browserDetails.browser && r.default.browserShim.shimGetDisplayMedia(window, "window"), navigator.mediaDevices.getDisplayMedia ? (console.log("navigator.mediaDevices.getDisplayMedia"), navigator.mediaDevices.getDisplayMedia({ video: !0 })) : navigator.getDisplayMedia ? (console.log("navigator.getDisplayMedia"), navigator.getDisplayMedia({ video: !0 })) : null }, e.prototype.replaceVideoStream = function (e) { var t = this; return new Promise((function (n, r) { var o = t.pc.getSenders().find((function (e) { return e.track && "video" === e.track.kind })); o ? o.replaceTrack(e.getVideoTracks()[0]).then((function () { return n() })).catch((function (e) { return t.handleShareScreenFlowError(e, r) })) : r(i.ErrorCode.NO_VIDEO_TRACK) })) }, e.prototype.handleShareScreenFlowError = function (e, t) { console.error("Share screen flow error occurred: " + e), t(i.ErrorCode.UNKNOWN_SHARESCREEN_ERROR) }, e.prototype.createDTMFSender = function (e) { if (this.pc) { var t = this.pc.getSenders().find((function (e) { return e.track && "audio" === e.track.kind })); t ? (this.dtmfSender = t.dtmf, "canInsertDTMF" in this.dtmfSender && !1 === this.dtmfSender.canInsertDTMF && e(i.ErrorCode.DTMF_UNAVAILABLE)) : e(i.ErrorCode.INVALID_DTMF_CONFIG_NO_AUDIO_TRACK) } else e(i.ErrorCode.NO_PEER_CONNECTION) }, e.prototype.onIceCandidate = function (e) { var t = e.candidate ? e.candidate : { completed: !0 }; this.gateway.send({ action: "ice_candidate", callId: this.callId, ice: t }) }, e.prototype.addIceCandidate = function (e) { var t = this, n = e.completed ? null : e; this.pc.addIceCandidate(n).catch((function (n) { return t.logger.log(new a.ErrorLog(t.callId, "Error adding ice candidate " + e + ": " + n)) })) }, e.prototype.getDurationInSeconds = function (e) { return Math.floor((e.getTime() - this.callEstablishTime.getTime()) / 1e3) }, e }(); t.DefaultCall = f }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(51), i = n(54), o = function () { function e(e) { this._bytesSent = 0, this._bytesReceived = 0, this._timestamp = Date.now(), this._audio = new r.AudioMediaStats, this._video = new i.VideoMediaStats, this._isVideo = e } return Object.defineProperty(e.prototype, "audio", { get: function () { return this._audio }, set: function (e) { this._audio = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "video", { get: function () { return this._video }, set: function (e) { this._video = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "bytesSent", { get: function () { return this._bytesSent }, set: function (e) { this._bytesSent = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "bytesReceived", { get: function () { return this._bytesReceived }, set: function (e) { this._bytesReceived = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "currentRoundTripTime", { get: function () { return this._currentRoundTripTime }, set: function (e) { this._currentRoundTripTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "availableOutgoingBitrate", { get: function () { return this._availableOutgoingBitrate }, set: function (e) { this._availableOutgoingBitrate = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "timestamp", { get: function () { return this._timestamp }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { var e = { bytesSent: this.bytesSent, bytesReceived: this.bytesReceived, currentRoundTripTime: this.currentRoundTripTime, availableOutgoingBitrate: this.availableOutgoingBitrate, audio: this.audio }; return this._isVideo && (e.video = this.video), e }, e }(); t.CallStats = o }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { this._packetsSent = 0, this._bytesSent = 0, this._retransmittedPacketsSent = 0, this._retransmittedBytesSent = 0 } return Object.defineProperty(e.prototype, "packetsSent", { get: function () { return this._packetsSent }, set: function (e) { this._packetsSent = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "bytesSent", { get: function () { return this._bytesSent }, set: function (e) { this._bytesSent = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "retransmittedPacketsSent", { get: function () { return this._retransmittedPacketsSent }, set: function (e) { this._retransmittedPacketsSent = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "retransmittedBytesSent", { get: function () { return this._retransmittedBytesSent }, set: function (e) { this._retransmittedBytesSent = e }, enumerable: !0, configurable: !0 }), e }(); t.LocalMediaStats = r }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { this._packetsReceived = 0, this._bytesReceived = 0, this._packetsLost = 0, this._jitterBufferDelay = 0, this._jitterBufferEmittedCount = 0, this._averageJitterBufferDelay = 0 } return Object.defineProperty(e.prototype, "packetsReceived", { get: function () { return this._packetsReceived }, set: function (e) { this._packetsReceived = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "bytesReceived", { get: function () { return this._bytesReceived }, set: function (e) { this._bytesReceived = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "packetsLost", { get: function () { return this._packetsLost }, set: function (e) { this._packetsLost = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "jitterBufferDelay", { get: function () { return this._jitterBufferDelay }, set: function (e) { this._jitterBufferDelay = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "jitterBufferEmittedCount", { get: function () { return this._jitterBufferEmittedCount }, set: function (e) { this._jitterBufferEmittedCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "averageJitterBufferDelay", { get: function () { return this._averageJitterBufferDelay }, set: function (e) { this._averageJitterBufferDelay = e }, enumerable: !0, configurable: !0 }), e }(); t.RemoteMediaStats = r }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(9), i = function () { function e() { } return e.getHangupStatus = function (e) { if (!e || !e.name && !e.message) return new r.HangupStatus(5051, "EC_WEBRTC_ERROR", "Unknown error."); var t = ""; return e.name && (t += e.name + " "), e.message && (t += e.message), new r.HangupStatus(5051, "EC_WEBRTC_ERROR", t) }, e }(); t.default = i }, function (e, t, n) { "use strict"; e.exports = function (e, t) { return function () { for (var n = new Array(arguments.length), r = 0; r < n.length; r++)n[r] = arguments[r]; return e.apply(t, n) } } }, function (e, t, n) { "use strict"; var r = n(0); function i(e) { return encodeURIComponent(e).replace(/%40/gi, "@").replace(/%3A/gi, ":").replace(/%24/g, "$").replace(/%2C/gi, ",").replace(/%20/g, "+").replace(/%5B/gi, "[").replace(/%5D/gi, "]") } e.exports = function (e, t, n) { if (!t) return e; var o; if (n) o = n(t); else if (r.isURLSearchParams(t)) o = t.toString(); else { var a = []; r.forEach(t, (function (e, t) { null != e && (r.isArray(e) ? t += "[]" : e = [e], r.forEach(e, (function (e) { r.isDate(e) ? e = e.toISOString() : r.isObject(e) && (e = JSON.stringify(e)), a.push(i(t) + "=" + i(e)) }))) })), o = a.join("&") } if (o) { var s = e.indexOf("#"); -1 !== s && (e = e.slice(0, s)), e += (-1 === e.indexOf("?") ? "?" : "&") + o } return e } }, function (e, t, n) { "use strict"; e.exports = function (e) { return !(!e || !e.__CANCEL__) } }, function (e, t, n) { "use strict"; (function (t) { var r = n(0), i = n(70), o = { "Content-Type": "application/x-www-form-urlencoded" }; function a(e, t) { !r.isUndefined(e) && r.isUndefined(e["Content-Type"]) && (e["Content-Type"] = t) } var s, c = { adapter: ((void 0 !== t && "[object process]" === Object.prototype.toString.call(t) || "undefined" != typeof XMLHttpRequest) && (s = n(25)), s), transformRequest: [function (e, t) { return i(t, "Accept"), i(t, "Content-Type"), r.isFormData(e) || r.isArrayBuffer(e) || r.isBuffer(e) || r.isStream(e) || r.isFile(e) || r.isBlob(e) ? e : r.isArrayBufferView(e) ? e.buffer : r.isURLSearchParams(e) ? (a(t, "application/x-www-form-urlencoded;charset=utf-8"), e.toString()) : r.isObject(e) ? (a(t, "application/json;charset=utf-8"), JSON.stringify(e)) : e }], transformResponse: [function (e) { if ("string" == typeof e) try { e = JSON.parse(e) } catch (e) { } return e }], timeout: 0, xsrfCookieName: "XSRF-TOKEN", xsrfHeaderName: "X-XSRF-TOKEN", maxContentLength: -1, validateStatus: function (e) { return e >= 200 && e < 300 } }; c.headers = { common: { Accept: "application/json, text/plain, */*" } }, r.forEach(["delete", "get", "head"], (function (e) { c.headers[e] = {} })), r.forEach(["post", "put", "patch"], (function (e) { c.headers[e] = r.merge(o) })), e.exports = c }).call(this, n(11)) }, function (e, t, n) { "use strict"; var r = n(0), i = n(71), o = n(22), a = n(73), s = n(74), c = n(26); e.exports = function (e) { return new Promise((function (t, u) { var f = e.data, l = e.headers; r.isFormData(f) && delete l["Content-Type"]; var d = new XMLHttpRequest; if (e.auth) { var p = e.auth.username || "", h = e.auth.password || ""; l.Authorization = "Basic " + btoa(p + ":" + h) } if (d.open(e.method.toUpperCase(), o(e.url, e.params, e.paramsSerializer), !0), d.timeout = e.timeout, d.onreadystatechange = function () { if (d && 4 === d.readyState && (0 !== d.status || d.responseURL && 0 === d.responseURL.indexOf("file:"))) { var n = "getAllResponseHeaders" in d ? a(d.getAllResponseHeaders()) : null, r = { data: e.responseType && "text" !== e.responseType ? d.response : d.responseText, status: d.status, statusText: d.statusText, headers: n, config: e, request: d }; i(t, u, r), d = null } }, d.onabort = function () { d && (u(c("Request aborted", e, "ECONNABORTED", d)), d = null) }, d.onerror = function () { u(c("Network Error", e, null, d)), d = null }, d.ontimeout = function () { u(c("timeout of " + e.timeout + "ms exceeded", e, "ECONNABORTED", d)), d = null }, r.isStandardBrowserEnv()) { var v = n(75), m = (e.withCredentials || s(e.url)) && e.xsrfCookieName ? v.read(e.xsrfCookieName) : void 0; m && (l[e.xsrfHeaderName] = m) } if ("setRequestHeader" in d && r.forEach(l, (function (e, t) { void 0 === f && "content-type" === t.toLowerCase() ? delete l[t] : d.setRequestHeader(t, e) })), e.withCredentials && (d.withCredentials = !0), e.responseType) try { d.responseType = e.responseType } catch (t) { if ("json" !== e.responseType) throw t } "function" == typeof e.onDownloadProgress && d.addEventListener("progress", e.onDownloadProgress), "function" == typeof e.onUploadProgress && d.upload && d.upload.addEventListener("progress", e.onUploadProgress), e.cancelToken && e.cancelToken.promise.then((function (e) { d && (d.abort(), u(e), d = null) })), void 0 === f && (f = null), d.send(f) })) } }, function (e, t, n) { "use strict"; var r = n(72); e.exports = function (e, t, n, i, o) { var a = new Error(e); return r(a, t, n, i, o) } }, function (e, t, n) { "use strict"; var r = n(0); e.exports = function (e, t) { t = t || {}; var n = {}; return r.forEach(["url", "method", "params", "data"], (function (e) { void 0 !== t[e] && (n[e] = t[e]) })), r.forEach(["headers", "auth", "proxy"], (function (i) { r.isObject(t[i]) ? n[i] = r.deepMerge(e[i], t[i]) : void 0 !== t[i] ? n[i] = t[i] : r.isObject(e[i]) ? n[i] = r.deepMerge(e[i]) : void 0 !== e[i] && (n[i] = e[i]) })), r.forEach(["baseURL", "transformRequest", "transformResponse", "paramsSerializer", "timeout", "withCredentials", "adapter", "responseType", "xsrfCookieName", "xsrfHeaderName", "onUploadProgress", "onDownloadProgress", "maxContentLength", "validateStatus", "maxRedirects", "httpAgent", "httpsAgent", "cancelToken", "socketPath"], (function (r) { void 0 !== t[r] ? n[r] = t[r] : void 0 !== e[r] && (n[r] = e[r]) })), n } }, function (e, t, n) { "use strict"; function r(e) { this.message = e } r.prototype.toString = function () { return "Cancel" + (this.message ? ": " + this.message : "") }, r.prototype.__CANCEL__ = !0, e.exports = r }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e(e, t) { this._identity = e, this._displayName = t } return Object.defineProperty(e.prototype, "identity", { get: function () { return this._identity }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "displayName", { get: function () { return this._displayName }, enumerable: !0, configurable: !0 }), e }(); t.User = r }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e(e, t) { void 0 === t && (t = {}), this._incomingCall = e, this._customData = t } return Object.defineProperty(e.prototype, "incomingCall", { get: function () { return this._incomingCall }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "customData", { get: function () { return this._customData }, enumerable: !0, configurable: !0 }), e }(); t.IncomingCallEvent = r }, function (e, t, n) { "use strict"; n.r(t); var r = {}; n.r(r), n.d(r, "shimGetUserMedia", (function () { return y })), n.d(r, "shimGetDisplayMedia", (function () { return _ })), n.d(r, "shimMediaStream", (function () { return C })), n.d(r, "shimOnTrack", (function () { return S })), n.d(r, "shimGetSendersWithDtmf", (function () { return E })), n.d(r, "shimSenderReceiverGetStats", (function () { return T })), n.d(r, "shimAddTrackRemoveTrackWithNative", (function () { return w })), n.d(r, "shimAddTrackRemoveTrack", (function () { return R })), n.d(r, "shimPeerConnection", (function () { return k })), n.d(r, "fixNegotiationNeeded", (function () { return P })); var i = {}; n.r(i), n.d(i, "shimGetUserMedia", (function () { return x })), n.d(i, "shimGetDisplayMedia", (function () { return I })), n.d(i, "shimPeerConnection", (function () { return M })), n.d(i, "shimReplaceTrack", (function () { return A })); var o = {}; n.r(o), n.d(o, "shimGetUserMedia", (function () { return j })), n.d(o, "shimGetDisplayMedia", (function () { return N })), n.d(o, "shimOnTrack", (function () { return L })), n.d(o, "shimPeerConnection", (function () { return F })), n.d(o, "shimSenderGetStats", (function () { return B })), n.d(o, "shimReceiverGetStats", (function () { return U })), n.d(o, "shimRemoveStream", (function () { return V })), n.d(o, "shimRTCDataChannel", (function () { return z })); var a = {}; n.r(a), n.d(a, "shimLocalStreamsAPI", (function () { return G })), n.d(a, "shimRemoteStreamsAPI", (function () { return W })), n.d(a, "shimCallbacksAPI", (function () { return H })), n.d(a, "shimGetUserMedia", (function () { return q })), n.d(a, "shimRTCIceServerUrls", (function () { return J })), n.d(a, "shimTrackEventTransceiver", (function () { return $ })), n.d(a, "shimCreateOfferLegacy", (function () { return K })); var s = {}; n.r(s), n.d(s, "shimRTCIceCandidate", (function () { return Y })), n.d(s, "shimMaxMessageSize", (function () { return X })), n.d(s, "shimSendThrowTypeError", (function () { return ee })), n.d(s, "shimConnectionState", (function () { return te })); let c = !0, u = !0; function f(e, t, n) { const r = e.match(t); return r && r.length >= n && parseInt(r[n], 10) } function l(e, t, n) { if (!e.RTCPeerConnection) return; const r = e.RTCPeerConnection.prototype, i = r.addEventListener; r.addEventListener = function (e, r) { if (e !== t) return i.apply(this, arguments); const o = e => { const t = n(e); t && r(t) }; return this._eventMap = this._eventMap || {}, this._eventMap[r] = o, i.apply(this, [e, o]) }; const o = r.removeEventListener; r.removeEventListener = function (e, n) { if (e !== t || !this._eventMap || !this._eventMap[n]) return o.apply(this, arguments); const r = this._eventMap[n]; return delete this._eventMap[n], o.apply(this, [e, r]) }, Object.defineProperty(r, "on" + t, { get() { return this["_on" + t] }, set(e) { this["_on" + t] && (this.removeEventListener(t, this["_on" + t]), delete this["_on" + t]), e && this.addEventListener(t, this["_on" + t] = e) }, enumerable: !0, configurable: !0 }) } function d(e) { return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (c = e, e ? "adapter.js logging disabled" : "adapter.js logging enabled") } function p(e) { return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (u = !e, "adapter.js deprecation warnings " + (e ? "disabled" : "enabled")) } function h() { if ("object" == typeof window) { if (c) return; "undefined" != typeof console && "function" == typeof console.log && console.log.apply(console, arguments) } } function v(e, t) { u && console.warn(e + " is deprecated, please use " + t + " instead.") } function m(e) { const { navigator: t } = e, n = { browser: null, version: null }; if (void 0 === e || !e.navigator) return n.browser = "Not a browser.", n; if (t.mozGetUserMedia) n.browser = "firefox", n.version = f(t.userAgent, /Firefox\/(\d+)\./, 1); else if (t.webkitGetUserMedia) n.browser = "chrome", n.version = f(t.userAgent, /Chrom(e|ium)\/(\d+)\./, 2); else if (t.mediaDevices && t.userAgent.match(/Edge\/(\d+).(\d+)$/)) n.browser = "edge", n.version = f(t.userAgent, /Edge\/(\d+).(\d+)$/, 2); else { if (!e.RTCPeerConnection || !t.userAgent.match(/AppleWebKit\/(\d+)\./)) return n.browser = "Not a supported browser.", n; n.browser = "safari", n.version = f(t.userAgent, /AppleWebKit\/(\d+)\./, 1) } return n } const g = h; function y(e) { const t = e && e.navigator; if (!t.mediaDevices) return; const n = m(e), r = function (e) { if ("object" != typeof e || e.mandatory || e.optional) return e; const t = {}; return Object.keys(e).forEach(n => { if ("require" === n || "advanced" === n || "mediaSource" === n) return; const r = "object" == typeof e[n] ? e[n] : { ideal: e[n] }; void 0 !== r.exact && "number" == typeof r.exact && (r.min = r.max = r.exact); const i = function (e, t) { return e ? e + t.charAt(0).toUpperCase() + t.slice(1) : "deviceId" === t ? "sourceId" : t }; if (void 0 !== r.ideal) { t.optional = t.optional || []; let e = {}; "number" == typeof r.ideal ? (e[i("min", n)] = r.ideal, t.optional.push(e), e = {}, e[i("max", n)] = r.ideal, t.optional.push(e)) : (e[i("", n)] = r.ideal, t.optional.push(e)) } void 0 !== r.exact && "number" != typeof r.exact ? (t.mandatory = t.mandatory || {}, t.mandatory[i("", n)] = r.exact) : ["min", "max"].forEach(e => { void 0 !== r[e] && (t.mandatory = t.mandatory || {}, t.mandatory[i(e, n)] = r[e]) }) }), e.advanced && (t.optional = (t.optional || []).concat(e.advanced)), t }, i = function (e, i) { if (n.version >= 61) return i(e); if ((e = JSON.parse(JSON.stringify(e))) && "object" == typeof e.audio) { const t = function (e, t, n) { t in e && !(n in e) && (e[n] = e[t], delete e[t]) }; t((e = JSON.parse(JSON.stringify(e))).audio, "autoGainControl", "googAutoGainControl"), t(e.audio, "noiseSuppression", "googNoiseSuppression"), e.audio = r(e.audio) } if (e && "object" == typeof e.video) { let o = e.video.facingMode; o = o && ("object" == typeof o ? o : { ideal: o }); const a = n.version < 66; if (o && ("user" === o.exact || "environment" === o.exact || "user" === o.ideal || "environment" === o.ideal) && (!t.mediaDevices.getSupportedConstraints || !t.mediaDevices.getSupportedConstraints().facingMode || a)) { let n; if (delete e.video.facingMode, "environment" === o.exact || "environment" === o.ideal ? n = ["back", "rear"] : "user" !== o.exact && "user" !== o.ideal || (n = ["front"]), n) return t.mediaDevices.enumerateDevices().then(t => { let a = (t = t.filter(e => "videoinput" === e.kind)).find(e => n.some(t => e.label.toLowerCase().includes(t))); return !a && t.length && n.includes("back") && (a = t[t.length - 1]), a && (e.video.deviceId = o.exact ? { exact: a.deviceId } : { ideal: a.deviceId }), e.video = r(e.video), g("chrome: " + JSON.stringify(e)), i(e) }) } e.video = r(e.video) } return g("chrome: " + JSON.stringify(e)), i(e) }, o = function (e) { return n.version >= 64 ? e : { name: { PermissionDeniedError: "NotAllowedError", PermissionDismissedError: "NotAllowedError", InvalidStateError: "NotAllowedError", DevicesNotFoundError: "NotFoundError", ConstraintNotSatisfiedError: "OverconstrainedError", TrackStartError: "NotReadableError", MediaDeviceFailedDueToShutdown: "NotAllowedError", MediaDeviceKillSwitchOn: "NotAllowedError", TabCaptureError: "AbortError", ScreenCaptureError: "AbortError", DeviceCaptureError: "AbortError" }[e.name] || e.name, message: e.message, constraint: e.constraint || e.constraintName, toString() { return this.name + (this.message && ": ") + this.message } } }; t.getUserMedia = function (e, n, r) { i(e, e => { t.webkitGetUserMedia(e, n, e => { r && r(o(e)) }) }) }.bind(t); const a = t.mediaDevices.getUserMedia.bind(t.mediaDevices); t.mediaDevices.getUserMedia = function (e) { return i(e, e => a(e).then(t => { if (e.audio && !t.getAudioTracks().length || e.video && !t.getVideoTracks().length) throw t.getTracks().forEach(e => { e.stop() }), new DOMException("", "NotFoundError"); return t }, e => Promise.reject(o(e)))) } } function _(e, t) { e.navigator.mediaDevices && "getDisplayMedia" in e.navigator.mediaDevices || e.navigator.mediaDevices && ("function" == typeof t ? e.navigator.mediaDevices.getDisplayMedia = function (n) { return t(n).then(t => { const r = n.video && n.video.width, i = n.video && n.video.height, o = n.video && n.video.frameRate; return n.video = { mandatory: { chromeMediaSource: "desktop", chromeMediaSourceId: t, maxFrameRate: o || 3 } }, r && (n.video.mandatory.maxWidth = r), i && (n.video.mandatory.maxHeight = i), e.navigator.mediaDevices.getUserMedia(n) }) } : console.error("shimGetDisplayMedia: getSourceId argument is not a function")) } function b(e, t, n) { const r = n ? "outbound-rtp" : "inbound-rtp", i = new Map; if (null === t) return i; const o = []; return e.forEach(e => { "track" === e.type && e.trackIdentifier === t.id && o.push(e) }), o.forEach(t => { e.forEach(n => { n.type === r && n.trackId === t.id && function e(t, n, r) { n && !r.has(n.id) && (r.set(n.id, n), Object.keys(n).forEach(i => { i.endsWith("Id") ? e(t, t.get(n[i]), r) : i.endsWith("Ids") && n[i].forEach(n => { e(t, t.get(n), r) }) })) }(e, n, i) }) }), i } function C(e) { e.MediaStream = e.MediaStream || e.webkitMediaStream } function S(e) { if ("object" == typeof e && e.RTCPeerConnection && !("ontrack" in e.RTCPeerConnection.prototype)) { Object.defineProperty(e.RTCPeerConnection.prototype, "ontrack", { get() { return this._ontrack }, set(e) { this._ontrack && this.removeEventListener("track", this._ontrack), this.addEventListener("track", this._ontrack = e) }, enumerable: !0, configurable: !0 }); const t = e.RTCPeerConnection.prototype.setRemoteDescription; e.RTCPeerConnection.prototype.setRemoteDescription = function () { return this._ontrackpoly || (this._ontrackpoly = t => { t.stream.addEventListener("addtrack", n => { let r; r = e.RTCPeerConnection.prototype.getReceivers ? this.getReceivers().find(e => e.track && e.track.id === n.track.id) : { track: n.track }; const i = new Event("track"); i.track = n.track, i.receiver = r, i.transceiver = { receiver: r }, i.streams = [t.stream], this.dispatchEvent(i) }), t.stream.getTracks().forEach(n => { let r; r = e.RTCPeerConnection.prototype.getReceivers ? this.getReceivers().find(e => e.track && e.track.id === n.id) : { track: n }; const i = new Event("track"); i.track = n, i.receiver = r, i.transceiver = { receiver: r }, i.streams = [t.stream], this.dispatchEvent(i) }) }, this.addEventListener("addstream", this._ontrackpoly)), t.apply(this, arguments) } } else l(e, "track", e => (e.transceiver || Object.defineProperty(e, "transceiver", { value: { receiver: e.receiver } }), e)) } function E(e) { if ("object" == typeof e && e.RTCPeerConnection && !("getSenders" in e.RTCPeerConnection.prototype) && "createDTMFSender" in e.RTCPeerConnection.prototype) { const t = function (e, t) { return { track: t, get dtmf() { return void 0 === this._dtmf && ("audio" === t.kind ? this._dtmf = e.createDTMFSender(t) : this._dtmf = null), this._dtmf }, _pc: e } }; if (!e.RTCPeerConnection.prototype.getSenders) { e.RTCPeerConnection.prototype.getSenders = function () { return this._senders = this._senders || [], this._senders.slice() }; const n = e.RTCPeerConnection.prototype.addTrack; e.RTCPeerConnection.prototype.addTrack = function (e, r) { let i = n.apply(this, arguments); return i || (i = t(this, e), this._senders.push(i)), i }; const r = e.RTCPeerConnection.prototype.removeTrack; e.RTCPeerConnection.prototype.removeTrack = function (e) { r.apply(this, arguments); const t = this._senders.indexOf(e); -1 !== t && this._senders.splice(t, 1) } } const n = e.RTCPeerConnection.prototype.addStream; e.RTCPeerConnection.prototype.addStream = function (e) { this._senders = this._senders || [], n.apply(this, [e]), e.getTracks().forEach(e => { this._senders.push(t(this, e)) }) }; const r = e.RTCPeerConnection.prototype.removeStream; e.RTCPeerConnection.prototype.removeStream = function (e) { this._senders = this._senders || [], r.apply(this, [e]), e.getTracks().forEach(e => { const t = this._senders.find(t => t.track === e); t && this._senders.splice(this._senders.indexOf(t), 1) }) } } else if ("object" == typeof e && e.RTCPeerConnection && "getSenders" in e.RTCPeerConnection.prototype && "createDTMFSender" in e.RTCPeerConnection.prototype && e.RTCRtpSender && !("dtmf" in e.RTCRtpSender.prototype)) { const t = e.RTCPeerConnection.prototype.getSenders; e.RTCPeerConnection.prototype.getSenders = function () { const e = t.apply(this, []); return e.forEach(e => e._pc = this), e }, Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", { get() { return void 0 === this._dtmf && ("audio" === this.track.kind ? this._dtmf = this._pc.createDTMFSender(this.track) : this._dtmf = null), this._dtmf } }) } } function T(e) { if (!("object" == typeof e && e.RTCPeerConnection && e.RTCRtpSender && e.RTCRtpReceiver)) return; if (!("getStats" in e.RTCRtpSender.prototype)) { const t = e.RTCPeerConnection.prototype.getSenders; t && (e.RTCPeerConnection.prototype.getSenders = function () { const e = t.apply(this, []); return e.forEach(e => e._pc = this), e }); const n = e.RTCPeerConnection.prototype.addTrack; n && (e.RTCPeerConnection.prototype.addTrack = function () { const e = n.apply(this, arguments); return e._pc = this, e }), e.RTCRtpSender.prototype.getStats = function () { const e = this; return this._pc.getStats().then(t => b(t, e.track, !0)) } } if (!("getStats" in e.RTCRtpReceiver.prototype)) { const t = e.RTCPeerConnection.prototype.getReceivers; t && (e.RTCPeerConnection.prototype.getReceivers = function () { const e = t.apply(this, []); return e.forEach(e => e._pc = this), e }), l(e, "track", e => (e.receiver._pc = e.srcElement, e)), e.RTCRtpReceiver.prototype.getStats = function () { const e = this; return this._pc.getStats().then(t => b(t, e.track, !1)) } } if (!("getStats" in e.RTCRtpSender.prototype) || !("getStats" in e.RTCRtpReceiver.prototype)) return; const t = e.RTCPeerConnection.prototype.getStats; e.RTCPeerConnection.prototype.getStats = function () { if (arguments.length > 0 && arguments[0] instanceof e.MediaStreamTrack) { const e = arguments[0]; let t, n, r; return this.getSenders().forEach(n => { n.track === e && (t ? r = !0 : t = n) }), this.getReceivers().forEach(t => (t.track === e && (n ? r = !0 : n = t), t.track === e)), r || t && n ? Promise.reject(new DOMException("There are more than one sender or receiver for the track.", "InvalidAccessError")) : t ? t.getStats() : n ? n.getStats() : Promise.reject(new DOMException("There is no sender or receiver for the track.", "InvalidAccessError")) } return t.apply(this, arguments) } } function w(e) { e.RTCPeerConnection.prototype.getLocalStreams = function () { return this._shimmedLocalStreams = this._shimmedLocalStreams || {}, Object.keys(this._shimmedLocalStreams).map(e => this._shimmedLocalStreams[e][0]) }; const t = e.RTCPeerConnection.prototype.addTrack; e.RTCPeerConnection.prototype.addTrack = function (e, n) { if (!n) return t.apply(this, arguments); this._shimmedLocalStreams = this._shimmedLocalStreams || {}; const r = t.apply(this, arguments); return this._shimmedLocalStreams[n.id] ? -1 === this._shimmedLocalStreams[n.id].indexOf(r) && this._shimmedLocalStreams[n.id].push(r) : this._shimmedLocalStreams[n.id] = [n, r], r }; const n = e.RTCPeerConnection.prototype.addStream; e.RTCPeerConnection.prototype.addStream = function (e) { this._shimmedLocalStreams = this._shimmedLocalStreams || {}, e.getTracks().forEach(e => { if (this.getSenders().find(t => t.track === e)) throw new DOMException("Track already exists.", "InvalidAccessError") }); const t = this.getSenders(); n.apply(this, arguments); const r = this.getSenders().filter(e => -1 === t.indexOf(e)); this._shimmedLocalStreams[e.id] = [e].concat(r) }; const r = e.RTCPeerConnection.prototype.removeStream; e.RTCPeerConnection.prototype.removeStream = function (e) { return this._shimmedLocalStreams = this._shimmedLocalStreams || {}, delete this._shimmedLocalStreams[e.id], r.apply(this, arguments) }; const i = e.RTCPeerConnection.prototype.removeTrack; e.RTCPeerConnection.prototype.removeTrack = function (e) { return this._shimmedLocalStreams = this._shimmedLocalStreams || {}, e && Object.keys(this._shimmedLocalStreams).forEach(t => { const n = this._shimmedLocalStreams[t].indexOf(e); -1 !== n && this._shimmedLocalStreams[t].splice(n, 1), 1 === this._shimmedLocalStreams[t].length && delete this._shimmedLocalStreams[t] }), i.apply(this, arguments) } } function R(e) { if (!e.RTCPeerConnection) return; const t = m(e); if (e.RTCPeerConnection.prototype.addTrack && t.version >= 65) return w(e); const n = e.RTCPeerConnection.prototype.getLocalStreams; e.RTCPeerConnection.prototype.getLocalStreams = function () { const e = n.apply(this); return this._reverseStreams = this._reverseStreams || {}, e.map(e => this._reverseStreams[e.id]) }; const r = e.RTCPeerConnection.prototype.addStream; e.RTCPeerConnection.prototype.addStream = function (t) { if (this._streams = this._streams || {}, this._reverseStreams = this._reverseStreams || {}, t.getTracks().forEach(e => { if (this.getSenders().find(t => t.track === e)) throw new DOMException("Track already exists.", "InvalidAccessError") }), !this._reverseStreams[t.id]) { const n = new e.MediaStream(t.getTracks()); this._streams[t.id] = n, this._reverseStreams[n.id] = t, t = n } r.apply(this, [t]) }; const i = e.RTCPeerConnection.prototype.removeStream; function o(e, t) { let n = t.sdp; return Object.keys(e._reverseStreams || []).forEach(t => { const r = e._reverseStreams[t], i = e._streams[r.id]; n = n.replace(new RegExp(i.id, "g"), r.id) }), new RTCSessionDescription({ type: t.type, sdp: n }) } function a(e, t) { let n = t.sdp; return Object.keys(e._reverseStreams || []).forEach(t => { const r = e._reverseStreams[t], i = e._streams[r.id]; n = n.replace(new RegExp(r.id, "g"), i.id) }), new RTCSessionDescription({ type: t.type, sdp: n }) } e.RTCPeerConnection.prototype.removeStream = function (e) { this._streams = this._streams || {}, this._reverseStreams = this._reverseStreams || {}, i.apply(this, [this._streams[e.id] || e]), delete this._reverseStreams[this._streams[e.id] ? this._streams[e.id].id : e.id], delete this._streams[e.id] }, e.RTCPeerConnection.prototype.addTrack = function (t, n) { if ("closed" === this.signalingState) throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.", "InvalidStateError"); const r = [].slice.call(arguments, 1); if (1 !== r.length || !r[0].getTracks().find(e => e === t)) throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.", "NotSupportedError"); const i = this.getSenders().find(e => e.track === t); if (i) throw new DOMException("Track already exists.", "InvalidAccessError"); this._streams = this._streams || {}, this._reverseStreams = this._reverseStreams || {}; const o = this._streams[n.id]; if (o) o.addTrack(t), Promise.resolve().then(() => { this.dispatchEvent(new Event("negotiationneeded")) }); else { const r = new e.MediaStream([t]); this._streams[n.id] = r, this._reverseStreams[r.id] = n, this.addStream(r) } return this.getSenders().find(e => e.track === t) }, ["createOffer", "createAnswer"].forEach((function (t) { const n = e.RTCPeerConnection.prototype[t]; e.RTCPeerConnection.prototype[t] = function () { const e = arguments, t = arguments.length && "function" == typeof arguments[0]; return t ? n.apply(this, [t => { const n = o(this, t); e[0].apply(null, [n]) }, t => { e[1] && e[1].apply(null, t) }, arguments[2]]) : n.apply(this, arguments).then(e => o(this, e)) } })); const s = e.RTCPeerConnection.prototype.setLocalDescription; e.RTCPeerConnection.prototype.setLocalDescription = function () { return arguments.length && arguments[0].type ? (arguments[0] = a(this, arguments[0]), s.apply(this, arguments)) : s.apply(this, arguments) }; const c = Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype, "localDescription"); Object.defineProperty(e.RTCPeerConnection.prototype, "localDescription", { get() { const e = c.get.apply(this); return "" === e.type ? e : o(this, e) } }), e.RTCPeerConnection.prototype.removeTrack = function (e) { if ("closed" === this.signalingState) throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.", "InvalidStateError"); if (!e._pc) throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.", "TypeError"); if (!(e._pc === this)) throw new DOMException("Sender was not created by this connection.", "InvalidAccessError"); let t; this._streams = this._streams || {}, Object.keys(this._streams).forEach(n => { this._streams[n].getTracks().find(t => e.track === t) && (t = this._streams[n]) }), t && (1 === t.getTracks().length ? this.removeStream(this._reverseStreams[t.id]) : t.removeTrack(e.track), this.dispatchEvent(new Event("negotiationneeded"))) } } function k(e) { if (!e.RTCPeerConnection && e.webkitRTCPeerConnection && (e.RTCPeerConnection = e.webkitRTCPeerConnection), !e.RTCPeerConnection) return; const t = e.RTCPeerConnection.prototype.getStats; e.RTCPeerConnection.prototype.getStats = function (e, n, r) { const i = arguments; if (arguments.length > 0 && "function" == typeof e) return t.apply(this, arguments); if (0 === t.length && (0 === arguments.length || "function" != typeof arguments[0])) return t.apply(this, []); const o = function (e) { const t = {}; return e.result().forEach(e => { const n = { id: e.id, timestamp: e.timestamp, type: { localcandidate: "local-candidate", remotecandidate: "remote-candidate" }[e.type] || e.type }; e.names().forEach(t => { n[t] = e.stat(t) }), t[n.id] = n }), t }, a = function (e) { return new Map(Object.keys(e).map(t => [t, e[t]])) }; if (arguments.length >= 2) { const e = function (e) { i[1](a(o(e))) }; return t.apply(this, [e, arguments[0]]) } return new Promise((e, n) => { t.apply(this, [function (t) { e(a(o(t))) }, n]) }).then(n, r) }, ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach((function (t) { const n = e.RTCPeerConnection.prototype[t]; e.RTCPeerConnection.prototype[t] = function () { return arguments[0] = new ("addIceCandidate" === t ? e.RTCIceCandidate : e.RTCSessionDescription)(arguments[0]), n.apply(this, arguments) } })); const n = e.RTCPeerConnection.prototype.addIceCandidate; e.RTCPeerConnection.prototype.addIceCandidate = function () { return arguments[0] ? n.apply(this, arguments) : (arguments[1] && arguments[1].apply(null), Promise.resolve()) } } function P(e) { l(e, "negotiationneeded", e => { if ("stable" === e.target.signalingState) return e }) } var O = n(32), D = n.n(O); function x(e) { const t = e && e.navigator, n = t.mediaDevices.getUserMedia.bind(t.mediaDevices); t.mediaDevices.getUserMedia = function (e) { return n(e).catch(e => Promise.reject(function (e) { return { name: { PermissionDeniedError: "NotAllowedError" }[e.name] || e.name, message: e.message, constraint: e.constraint, toString() { return this.name } } }(e))) } } function I(e) { "getDisplayMedia" in e.navigator && e.navigator.mediaDevices && (e.navigator.mediaDevices && "getDisplayMedia" in e.navigator.mediaDevices || (e.navigator.mediaDevices.getDisplayMedia = e.navigator.getDisplayMedia.bind(e.navigator.mediaDevices))) } function M(e) { const t = m(e); if (e.RTCIceGatherer && (e.RTCIceCandidate || (e.RTCIceCandidate = function (e) { return e }), e.RTCSessionDescription || (e.RTCSessionDescription = function (e) { return e }), t.version < 15025)) { const t = Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype, "enabled"); Object.defineProperty(e.MediaStreamTrack.prototype, "enabled", { set(e) { t.set.call(this, e); const n = new Event("enabled"); n.enabled = e, this.dispatchEvent(n) } }) } e.RTCRtpSender && !("dtmf" in e.RTCRtpSender.prototype) && Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", { get() { return void 0 === this._dtmf && ("audio" === this.track.kind ? this._dtmf = new e.RTCDtmfSender(this) : "video" === this.track.kind && (this._dtmf = null)), this._dtmf } }), e.RTCDtmfSender && !e.RTCDTMFSender && (e.RTCDTMFSender = e.RTCDtmfSender); const n = D()(e, t.version); e.RTCPeerConnection = function (e) { return e && e.iceServers && (e.iceServers = function (e, t) { let n = !1; return (e = JSON.parse(JSON.stringify(e))).filter(e => { if (e && (e.urls || e.url)) { var t = e.urls || e.url; e.url && !e.urls && v("RTCIceServer.url", "RTCIceServer.urls"); const r = "string" == typeof t; return r && (t = [t]), t = t.filter(e => { if (0 === e.indexOf("stun:")) return !1; const t = e.startsWith("turn") && !e.startsWith("turn:[") && e.includes("transport=udp"); return t && !n ? (n = !0, !0) : t && !n }), delete e.url, e.urls = r ? t[0] : t, !!t.length } }) }(e.iceServers, t.version), h("ICE servers after filtering:", e.iceServers)), new n(e) }, e.RTCPeerConnection.prototype = n.prototype } function A(e) { e.RTCRtpSender && !("replaceTrack" in e.RTCRtpSender.prototype) && (e.RTCRtpSender.prototype.replaceTrack = e.RTCRtpSender.prototype.setTrack) } function j(e) { const t = m(e), n = e && e.navigator, r = e && e.MediaStreamTrack; if (n.getUserMedia = function (e, t, r) { v("navigator.getUserMedia", "navigator.mediaDevices.getUserMedia"), n.mediaDevices.getUserMedia(e).then(t, r) }, !(t.version > 55 && "autoGainControl" in n.mediaDevices.getSupportedConstraints())) { const e = function (e, t, n) { t in e && !(n in e) && (e[n] = e[t], delete e[t]) }, t = n.mediaDevices.getUserMedia.bind(n.mediaDevices); if (n.mediaDevices.getUserMedia = function (n) { return "object" == typeof n && "object" == typeof n.audio && (n = JSON.parse(JSON.stringify(n)), e(n.audio, "autoGainControl", "mozAutoGainControl"), e(n.audio, "noiseSuppression", "mozNoiseSuppression")), t(n) }, r && r.prototype.getSettings) { const t = r.prototype.getSettings; r.prototype.getSettings = function () { const n = t.apply(this, arguments); return e(n, "mozAutoGainControl", "autoGainControl"), e(n, "mozNoiseSuppression", "noiseSuppression"), n } } if (r && r.prototype.applyConstraints) { const t = r.prototype.applyConstraints; r.prototype.applyConstraints = function (n) { return "audio" === this.kind && "object" == typeof n && (n = JSON.parse(JSON.stringify(n)), e(n, "autoGainControl", "mozAutoGainControl"), e(n, "noiseSuppression", "mozNoiseSuppression")), t.apply(this, [n]) } } } } function N(e, t) { e.navigator.mediaDevices && "getDisplayMedia" in e.navigator.mediaDevices || e.navigator.mediaDevices && (e.navigator.mediaDevices.getDisplayMedia = function (n) { if (!n || !n.video) { const e = new DOMException("getDisplayMedia without video constraints is undefined"); return e.name = "NotFoundError", e.code = 8, Promise.reject(e) } return !0 === n.video ? n.video = { mediaSource: t } : n.video.mediaSource = t, e.navigator.mediaDevices.getUserMedia(n) }) } function L(e) { "object" == typeof e && e.RTCTrackEvent && "receiver" in e.RTCTrackEvent.prototype && !("transceiver" in e.RTCTrackEvent.prototype) && Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", { get() { return { receiver: this.receiver } } }) } function F(e) { const t = m(e); if ("object" != typeof e || !e.RTCPeerConnection && !e.mozRTCPeerConnection) return; !e.RTCPeerConnection && e.mozRTCPeerConnection && (e.RTCPeerConnection = e.mozRTCPeerConnection), ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach((function (t) { const n = e.RTCPeerConnection.prototype[t]; e.RTCPeerConnection.prototype[t] = function () { return arguments[0] = new ("addIceCandidate" === t ? e.RTCIceCandidate : e.RTCSessionDescription)(arguments[0]), n.apply(this, arguments) } })); const n = e.RTCPeerConnection.prototype.addIceCandidate; e.RTCPeerConnection.prototype.addIceCandidate = function () { return arguments[0] ? n.apply(this, arguments) : (arguments[1] && arguments[1].apply(null), Promise.resolve()) }; const r = { inboundrtp: "inbound-rtp", outboundrtp: "outbound-rtp", candidatepair: "candidate-pair", localcandidate: "local-candidate", remotecandidate: "remote-candidate" }, i = e.RTCPeerConnection.prototype.getStats; e.RTCPeerConnection.prototype.getStats = function (e, n, o) { return i.apply(this, [e || null]).then(e => { if (t.version < 53 && !n) try { e.forEach(e => { e.type = r[e.type] || e.type }) } catch (t) { if ("TypeError" !== t.name) throw t; e.forEach((t, n) => { e.set(n, Object.assign({}, t, { type: r[t.type] || t.type })) }) } return e }).then(n, o) } } function B(e) { if ("object" != typeof e || !e.RTCPeerConnection || !e.RTCRtpSender) return; if (e.RTCRtpSender && "getStats" in e.RTCRtpSender.prototype) return; const t = e.RTCPeerConnection.prototype.getSenders; t && (e.RTCPeerConnection.prototype.getSenders = function () { const e = t.apply(this, []); return e.forEach(e => e._pc = this), e }); const n = e.RTCPeerConnection.prototype.addTrack; n && (e.RTCPeerConnection.prototype.addTrack = function () { const e = n.apply(this, arguments); return e._pc = this, e }), e.RTCRtpSender.prototype.getStats = function () { return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map) } } function U(e) { if ("object" != typeof e || !e.RTCPeerConnection || !e.RTCRtpSender) return; if (e.RTCRtpSender && "getStats" in e.RTCRtpReceiver.prototype) return; const t = e.RTCPeerConnection.prototype.getReceivers; t && (e.RTCPeerConnection.prototype.getReceivers = function () { const e = t.apply(this, []); return e.forEach(e => e._pc = this), e }), l(e, "track", e => (e.receiver._pc = e.srcElement, e)), e.RTCRtpReceiver.prototype.getStats = function () { return this._pc.getStats(this.track) } } function V(e) { e.RTCPeerConnection && !("removeStream" in e.RTCPeerConnection.prototype) && (e.RTCPeerConnection.prototype.removeStream = function (e) { v("removeStream", "removeTrack"), this.getSenders().forEach(t => { t.track && e.getTracks().includes(t.track) && this.removeTrack(t) }) }) } function z(e) { e.DataChannel && !e.RTCDataChannel && (e.RTCDataChannel = e.DataChannel) } function G(e) { if ("object" == typeof e && e.RTCPeerConnection) { if ("getLocalStreams" in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.getLocalStreams = function () { return this._localStreams || (this._localStreams = []), this._localStreams }), !("addStream" in e.RTCPeerConnection.prototype)) { const t = e.RTCPeerConnection.prototype.addTrack; e.RTCPeerConnection.prototype.addStream = function (e) { this._localStreams || (this._localStreams = []), this._localStreams.includes(e) || this._localStreams.push(e), e.getTracks().forEach(n => t.call(this, n, e)) }, e.RTCPeerConnection.prototype.addTrack = function (e, n) { return n && (this._localStreams ? this._localStreams.includes(n) || this._localStreams.push(n) : this._localStreams = [n]), t.call(this, e, n) } } "removeStream" in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.removeStream = function (e) { this._localStreams || (this._localStreams = []); const t = this._localStreams.indexOf(e); if (-1 === t) return; this._localStreams.splice(t, 1); const n = e.getTracks(); this.getSenders().forEach(e => { n.includes(e.track) && this.removeTrack(e) }) }) } } function W(e) { if ("object" == typeof e && e.RTCPeerConnection && ("getRemoteStreams" in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.getRemoteStreams = function () { return this._remoteStreams ? this._remoteStreams : [] }), !("onaddstream" in e.RTCPeerConnection.prototype))) { Object.defineProperty(e.RTCPeerConnection.prototype, "onaddstream", { get() { return this._onaddstream }, set(e) { this._onaddstream && (this.removeEventListener("addstream", this._onaddstream), this.removeEventListener("track", this._onaddstreampoly)), this.addEventListener("addstream", this._onaddstream = e), this.addEventListener("track", this._onaddstreampoly = e => { e.streams.forEach(e => { if (this._remoteStreams || (this._remoteStreams = []), this._remoteStreams.includes(e)) return; this._remoteStreams.push(e); const t = new Event("addstream"); t.stream = e, this.dispatchEvent(t) }) }) } }); const t = e.RTCPeerConnection.prototype.setRemoteDescription; e.RTCPeerConnection.prototype.setRemoteDescription = function () { const e = this; return this._onaddstreampoly || this.addEventListener("track", this._onaddstreampoly = function (t) { t.streams.forEach(t => { if (e._remoteStreams || (e._remoteStreams = []), e._remoteStreams.indexOf(t) >= 0) return; e._remoteStreams.push(t); const n = new Event("addstream"); n.stream = t, e.dispatchEvent(n) }) }), t.apply(e, arguments) } } } function H(e) { if ("object" != typeof e || !e.RTCPeerConnection) return; const t = e.RTCPeerConnection.prototype, n = t.createOffer, r = t.createAnswer, i = t.setLocalDescription, o = t.setRemoteDescription, a = t.addIceCandidate; t.createOffer = function (e, t) { const r = arguments.length >= 2 ? arguments[2] : arguments[0], i = n.apply(this, [r]); return t ? (i.then(e, t), Promise.resolve()) : i }, t.createAnswer = function (e, t) { const n = arguments.length >= 2 ? arguments[2] : arguments[0], i = r.apply(this, [n]); return t ? (i.then(e, t), Promise.resolve()) : i }; let s = function (e, t, n) { const r = i.apply(this, [e]); return n ? (r.then(t, n), Promise.resolve()) : r }; t.setLocalDescription = s, s = function (e, t, n) { const r = o.apply(this, [e]); return n ? (r.then(t, n), Promise.resolve()) : r }, t.setRemoteDescription = s, s = function (e, t, n) { const r = a.apply(this, [e]); return n ? (r.then(t, n), Promise.resolve()) : r }, t.addIceCandidate = s } function q(e) { const t = e && e.navigator; !t.getUserMedia && t.mediaDevices && t.mediaDevices.getUserMedia && (t.getUserMedia = function (e, n, r) { t.mediaDevices.getUserMedia(e).then(n, r) }.bind(t)) } function J(e) { const t = e.RTCPeerConnection; e.RTCPeerConnection = function (e, n) { if (e && e.iceServers) { const t = []; for (let n = 0; n < e.iceServers.length; n++) { let r = e.iceServers[n]; !r.hasOwnProperty("urls") && r.hasOwnProperty("url") ? (v("RTCIceServer.url", "RTCIceServer.urls"), r = JSON.parse(JSON.stringify(r)), r.urls = r.url, delete r.url, t.push(r)) : t.push(e.iceServers[n]) } e.iceServers = t } return new t(e, n) }, e.RTCPeerConnection.prototype = t.prototype, "generateCertificate" in e.RTCPeerConnection && Object.defineProperty(e.RTCPeerConnection, "generateCertificate", { get: () => t.generateCertificate }) } function $(e) { "object" == typeof e && e.RTCPeerConnection && "receiver" in e.RTCTrackEvent.prototype && !e.RTCTransceiver && Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", { get() { return { receiver: this.receiver } } }) } function K(e) { const t = e.RTCPeerConnection.prototype.createOffer; e.RTCPeerConnection.prototype.createOffer = function (e) { if (e) { void 0 !== e.offerToReceiveAudio && (e.offerToReceiveAudio = !!e.offerToReceiveAudio); const t = this.getTransceivers().find(e => e.sender.track && "audio" === e.sender.track.kind); !1 === e.offerToReceiveAudio && t ? "sendrecv" === t.direction ? t.setDirection ? t.setDirection("sendonly") : t.direction = "sendonly" : "recvonly" === t.direction && (t.setDirection ? t.setDirection("inactive") : t.direction = "inactive") : !0 !== e.offerToReceiveAudio || t || this.addTransceiver("audio"), void 0 !== e.offerToReceiveVideo && (e.offerToReceiveVideo = !!e.offerToReceiveVideo); const n = this.getTransceivers().find(e => e.sender.track && "video" === e.sender.track.kind); !1 === e.offerToReceiveVideo && n ? "sendrecv" === n.direction ? n.setDirection ? n.setDirection("sendonly") : n.direction = "sendonly" : "recvonly" === n.direction && (n.setDirection ? n.setDirection("inactive") : n.direction = "inactive") : !0 !== e.offerToReceiveVideo || n || this.addTransceiver("video") } return t.apply(this, arguments) } } var Z = n(2), Q = n.n(Z); function Y(e) { if (!e.RTCIceCandidate || e.RTCIceCandidate && "foundation" in e.RTCIceCandidate.prototype) return; const t = e.RTCIceCandidate; e.RTCIceCandidate = function (e) { if ("object" == typeof e && e.candidate && 0 === e.candidate.indexOf("a=") && ((e = JSON.parse(JSON.stringify(e))).candidate = e.candidate.substr(2)), e.candidate && e.candidate.length) { const n = new t(e), r = Q.a.parseCandidate(e.candidate), i = Object.assign(n, r); return i.toJSON = function () { return { candidate: i.candidate, sdpMid: i.sdpMid, sdpMLineIndex: i.sdpMLineIndex, usernameFragment: i.usernameFragment } }, i } return new t(e) }, e.RTCIceCandidate.prototype = t.prototype, l(e, "icecandidate", t => (t.candidate && Object.defineProperty(t, "candidate", { value: new e.RTCIceCandidate(t.candidate), writable: "false" }), t)) } function X(e) { if (e.RTCSctpTransport || !e.RTCPeerConnection) return; const t = m(e); "sctp" in e.RTCPeerConnection.prototype || Object.defineProperty(e.RTCPeerConnection.prototype, "sctp", { get() { return void 0 === this._sctp ? null : this._sctp } }); const n = function (e) { const t = Q.a.splitSections(e.sdp); return t.shift(), t.some(e => { const t = Q.a.parseMLine(e); return t && "application" === t.kind && -1 !== t.protocol.indexOf("SCTP") }) }, r = function (e) { const t = e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/); if (null === t || t.length < 2) return -1; const n = parseInt(t[1], 10); return n != n ? -1 : n }, i = function (e) { let n = 65536; return "firefox" === t.browser && (n = t.version < 57 ? -1 === e ? 16384 : 2147483637 : t.version < 60 ? 57 === t.version ? 65535 : 65536 : 2147483637), n }, o = function (e, n) { let r = 65536; "firefox" === t.browser && 57 === t.version && (r = 65535); const i = Q.a.matchPrefix(e.sdp, "a=max-message-size:"); return i.length > 0 ? r = parseInt(i[0].substr(19), 10) : "firefox" === t.browser && -1 !== n && (r = 2147483637), r }, a = e.RTCPeerConnection.prototype.setRemoteDescription; e.RTCPeerConnection.prototype.setRemoteDescription = function () { if (this._sctp = null, n(arguments[0])) { const e = r(arguments[0]), t = i(e), n = o(arguments[0], e); let a; a = 0 === t && 0 === n ? Number.POSITIVE_INFINITY : 0 === t || 0 === n ? Math.max(t, n) : Math.min(t, n); const s = {}; Object.defineProperty(s, "maxMessageSize", { get: () => a }), this._sctp = s } return a.apply(this, arguments) } } function ee(e) { if (!e.RTCPeerConnection || !("createDataChannel" in e.RTCPeerConnection.prototype)) return; function t(e, t) { const n = e.send; e.send = function () { const r = arguments[0], i = r.length || r.size || r.byteLength; if ("open" === e.readyState && t.sctp && i > t.sctp.maxMessageSize) throw new TypeError("Message too large (can send a maximum of " + t.sctp.maxMessageSize + " bytes)"); return n.apply(e, arguments) } } const n = e.RTCPeerConnection.prototype.createDataChannel; e.RTCPeerConnection.prototype.createDataChannel = function () { const e = n.apply(this, arguments); return t(e, this), e }, l(e, "datachannel", e => (t(e.channel, e.target), e)) } function te(e) { if (!e.RTCPeerConnection || "connectionState" in e.RTCPeerConnection.prototype) return; const t = e.RTCPeerConnection.prototype; Object.defineProperty(t, "connectionState", { get() { return { completed: "connected", checking: "connecting" }[this.iceConnectionState] || this.iceConnectionState }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "onconnectionstatechange", { get() { return this._onconnectionstatechange || null }, set(e) { this._onconnectionstatechange && (this.removeEventListener("connectionstatechange", this._onconnectionstatechange), delete this._onconnectionstatechange), e && this.addEventListener("connectionstatechange", this._onconnectionstatechange = e) }, enumerable: !0, configurable: !0 }), ["setLocalDescription", "setRemoteDescription"].forEach(e => { const n = t[e]; t[e] = function () { return this._connectionstatechangepoly || (this._connectionstatechangepoly = e => { const t = e.target; if (t._lastConnectionState !== t.connectionState) { t._lastConnectionState = t.connectionState; const n = new Event("connectionstatechange", e); t.dispatchEvent(n) } return e }, this.addEventListener("iceconnectionstatechange", this._connectionstatechangepoly)), n.apply(this, arguments) } }) } const ne = function ({ window: e } = {}, t = { shimChrome: !0, shimFirefox: !0, shimEdge: !0, shimSafari: !0 }) { const n = h, c = m(e), u = { browserDetails: c, commonShim: s, extractVersion: f, disableLog: d, disableWarnings: p }; switch (c.browser) { case "chrome": if (!r || !k || !t.shimChrome) return n("Chrome shim is not included in this adapter release."), u; n("adapter.js shimming chrome."), u.browserShim = r, y(e), C(e), k(e), S(e), R(e), E(e), T(e), P(e), Y(e), te(e), X(e), ee(e); break; case "firefox": if (!o || !F || !t.shimFirefox) return n("Firefox shim is not included in this adapter release."), u; n("adapter.js shimming firefox."), u.browserShim = o, j(e), F(e), L(e), V(e), B(e), U(e), z(e), Y(e), te(e), X(e), ee(e); break; case "edge": if (!i || !M || !t.shimEdge) return n("MS edge shim is not included in this adapter release."), u; n("adapter.js shimming edge."), u.browserShim = i, x(e), I(e), M(e), A(e), X(e), ee(e); break; case "safari": if (!a || !t.shimSafari) return n("Safari shim is not included in this adapter release."), u; n("adapter.js shimming safari."), u.browserShim = a, J(e), K(e), H(e), G(e), W(e), $(e), q(e), Y(e), X(e), ee(e); break; default: n("Unsupported browser!") }return u }({ window: window }); t.default = ne }, function (e, t, n) { "use strict"; var r = n(2); function i(e, t, n, i, o) { var a = r.writeRtpDescription(e.kind, t); if (a += r.writeIceParameters(e.iceGatherer.getLocalParameters()), a += r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(), "offer" === n ? "actpass" : o || "active"), a += "a=mid:" + e.mid + "\r\n", e.rtpSender && e.rtpReceiver ? a += "a=sendrecv\r\n" : e.rtpSender ? a += "a=sendonly\r\n" : e.rtpReceiver ? a += "a=recvonly\r\n" : a += "a=inactive\r\n", e.rtpSender) { var s = e.rtpSender._initialTrackId || e.rtpSender.track.id; e.rtpSender._initialTrackId = s; var c = "msid:" + (i ? i.id : "-") + " " + s + "\r\n"; a += "a=" + c, a += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + c, e.sendEncodingParameters[0].rtx && (a += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + c, a += "a=ssrc-group:FID " + e.sendEncodingParameters[0].ssrc + " " + e.sendEncodingParameters[0].rtx.ssrc + "\r\n") } return a += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " cname:" + r.localCName + "\r\n", e.rtpSender && e.sendEncodingParameters[0].rtx && (a += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " cname:" + r.localCName + "\r\n"), a } function o(e, t) { var n = { codecs: [], headerExtensions: [], fecMechanisms: [] }, r = function (e, t) { e = parseInt(e, 10); for (var n = 0; n < t.length; n++)if (t[n].payloadType === e || t[n].preferredPayloadType === e) return t[n] }, i = function (e, t, n, i) { var o = r(e.parameters.apt, n), a = r(t.parameters.apt, i); return o && a && o.name.toLowerCase() === a.name.toLowerCase() }; return e.codecs.forEach((function (r) { for (var o = 0; o < t.codecs.length; o++) { var a = t.codecs[o]; if (r.name.toLowerCase() === a.name.toLowerCase() && r.clockRate === a.clockRate) { if ("rtx" === r.name.toLowerCase() && r.parameters && a.parameters.apt && !i(r, a, e.codecs, t.codecs)) continue; (a = JSON.parse(JSON.stringify(a))).numChannels = Math.min(r.numChannels, a.numChannels), n.codecs.push(a), a.rtcpFeedback = a.rtcpFeedback.filter((function (e) { for (var t = 0; t < r.rtcpFeedback.length; t++)if (r.rtcpFeedback[t].type === e.type && r.rtcpFeedback[t].parameter === e.parameter) return !0; return !1 })); break } } })), e.headerExtensions.forEach((function (e) { for (var r = 0; r < t.headerExtensions.length; r++) { var i = t.headerExtensions[r]; if (e.uri === i.uri) { n.headerExtensions.push(i); break } } })), n } function a(e, t, n) { return -1 !== { offer: { setLocalDescription: ["stable", "have-local-offer"], setRemoteDescription: ["stable", "have-remote-offer"] }, answer: { setLocalDescription: ["have-remote-offer", "have-local-pranswer"], setRemoteDescription: ["have-local-offer", "have-remote-pranswer"] } }[t][e].indexOf(n) } function s(e, t) { var n = e.getRemoteCandidates().find((function (e) { return t.foundation === e.foundation && t.ip === e.ip && t.port === e.port && t.priority === e.priority && t.protocol === e.protocol && t.type === e.type })); return n || e.addRemoteCandidate(t), !n } function c(e, t) { var n = new Error(t); return n.name = e, n.code = { NotSupportedError: 9, InvalidStateError: 11, InvalidAccessError: 15, TypeError: void 0, OperationError: void 0 }[e], n } e.exports = function (e, t) { function n(t, n) { n.addTrack(t), n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack", { track: t })) } function u(t, n, r, i) { var o = new Event("track"); o.track = n, o.receiver = r, o.transceiver = { receiver: r }, o.streams = i, e.setTimeout((function () { t._dispatchEvent("track", o) })) } var f = function (n) { var i = this, o = document.createDocumentFragment(); if (["addEventListener", "removeEventListener", "dispatchEvent"].forEach((function (e) { i[e] = o[e].bind(o) })), this.canTrickleIceCandidates = null, this.needNegotiation = !1, this.localStreams = [], this.remoteStreams = [], this._localDescription = null, this._remoteDescription = null, this.signalingState = "stable", this.iceConnectionState = "new", this.connectionState = "new", this.iceGatheringState = "new", n = JSON.parse(JSON.stringify(n || {})), this.usingBundle = "max-bundle" === n.bundlePolicy, "negotiate" === n.rtcpMuxPolicy) throw c("NotSupportedError", "rtcpMuxPolicy 'negotiate' is not supported"); switch (n.rtcpMuxPolicy || (n.rtcpMuxPolicy = "require"), n.iceTransportPolicy) { case "all": case "relay": break; default: n.iceTransportPolicy = "all" }switch (n.bundlePolicy) { case "balanced": case "max-compat": case "max-bundle": break; default: n.bundlePolicy = "balanced" }if (n.iceServers = function (e, t) { var n = !1; return (e = JSON.parse(JSON.stringify(e))).filter((function (e) { if (e && (e.urls || e.url)) { var r = e.urls || e.url; e.url && !e.urls && console.warn("RTCIceServer.url is deprecated! Use urls instead."); var i = "string" == typeof r; return i && (r = [r]), r = r.filter((function (e) { return 0 === e.indexOf("turn:") && -1 !== e.indexOf("transport=udp") && -1 === e.indexOf("turn:[") && !n ? (n = !0, !0) : 0 === e.indexOf("stun:") && t >= 14393 && -1 === e.indexOf("?transport=udp") })), delete e.url, e.urls = i ? r[0] : r, !!r.length } })) }(n.iceServers || [], t), this._iceGatherers = [], n.iceCandidatePoolSize) for (var a = n.iceCandidatePoolSize; a > 0; a--)this._iceGatherers.push(new e.RTCIceGatherer({ iceServers: n.iceServers, gatherPolicy: n.iceTransportPolicy })); else n.iceCandidatePoolSize = 0; this._config = n, this.transceivers = [], this._sdpSessionId = r.generateSessionId(), this._sdpSessionVersion = 0, this._dtlsRole = void 0, this._isClosed = !1 }; Object.defineProperty(f.prototype, "localDescription", { configurable: !0, get: function () { return this._localDescription } }), Object.defineProperty(f.prototype, "remoteDescription", { configurable: !0, get: function () { return this._remoteDescription } }), f.prototype.onicecandidate = null, f.prototype.onaddstream = null, f.prototype.ontrack = null, f.prototype.onremovestream = null, f.prototype.onsignalingstatechange = null, f.prototype.oniceconnectionstatechange = null, f.prototype.onconnectionstatechange = null, f.prototype.onicegatheringstatechange = null, f.prototype.onnegotiationneeded = null, f.prototype.ondatachannel = null, f.prototype._dispatchEvent = function (e, t) { this._isClosed || (this.dispatchEvent(t), "function" == typeof this["on" + e] && this["on" + e](t)) }, f.prototype._emitGatheringStateChange = function () { var e = new Event("icegatheringstatechange"); this._dispatchEvent("icegatheringstatechange", e) }, f.prototype.getConfiguration = function () { return this._config }, f.prototype.getLocalStreams = function () { return this.localStreams }, f.prototype.getRemoteStreams = function () { return this.remoteStreams }, f.prototype._createTransceiver = function (e, t) { var n = this.transceivers.length > 0, r = { track: null, iceGatherer: null, iceTransport: null, dtlsTransport: null, localCapabilities: null, remoteCapabilities: null, rtpSender: null, rtpReceiver: null, kind: e, mid: null, sendEncodingParameters: null, recvEncodingParameters: null, stream: null, associatedRemoteMediaStreams: [], wantReceive: !0 }; if (this.usingBundle && n) r.iceTransport = this.transceivers[0].iceTransport, r.dtlsTransport = this.transceivers[0].dtlsTransport; else { var i = this._createIceAndDtlsTransports(); r.iceTransport = i.iceTransport, r.dtlsTransport = i.dtlsTransport } return t || this.transceivers.push(r), r }, f.prototype.addTrack = function (t, n) { if (this._isClosed) throw c("InvalidStateError", "Attempted to call addTrack on a closed peerconnection."); var r; if (this.transceivers.find((function (e) { return e.track === t }))) throw c("InvalidAccessError", "Track already exists."); for (var i = 0; i < this.transceivers.length; i++)this.transceivers[i].track || this.transceivers[i].kind !== t.kind || (r = this.transceivers[i]); return r || (r = this._createTransceiver(t.kind)), this._maybeFireNegotiationNeeded(), -1 === this.localStreams.indexOf(n) && this.localStreams.push(n), r.track = t, r.stream = n, r.rtpSender = new e.RTCRtpSender(t, r.dtlsTransport), r.rtpSender }, f.prototype.addStream = function (e) { var n = this; if (t >= 15025) e.getTracks().forEach((function (t) { n.addTrack(t, e) })); else { var r = e.clone(); e.getTracks().forEach((function (e, t) { var n = r.getTracks()[t]; e.addEventListener("enabled", (function (e) { n.enabled = e.enabled })) })), r.getTracks().forEach((function (e) { n.addTrack(e, r) })) } }, f.prototype.removeTrack = function (t) { if (this._isClosed) throw c("InvalidStateError", "Attempted to call removeTrack on a closed peerconnection."); if (!(t instanceof e.RTCRtpSender)) throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender."); var n = this.transceivers.find((function (e) { return e.rtpSender === t })); if (!n) throw c("InvalidAccessError", "Sender was not created by this connection."); var r = n.stream; n.rtpSender.stop(), n.rtpSender = null, n.track = null, n.stream = null, -1 === this.transceivers.map((function (e) { return e.stream })).indexOf(r) && this.localStreams.indexOf(r) > -1 && this.localStreams.splice(this.localStreams.indexOf(r), 1), this._maybeFireNegotiationNeeded() }, f.prototype.removeStream = function (e) { var t = this; e.getTracks().forEach((function (e) { var n = t.getSenders().find((function (t) { return t.track === e })); n && t.removeTrack(n) })) }, f.prototype.getSenders = function () { return this.transceivers.filter((function (e) { return !!e.rtpSender })).map((function (e) { return e.rtpSender })) }, f.prototype.getReceivers = function () { return this.transceivers.filter((function (e) { return !!e.rtpReceiver })).map((function (e) { return e.rtpReceiver })) }, f.prototype._createIceGatherer = function (t, n) { var r = this; if (n && t > 0) return this.transceivers[0].iceGatherer; if (this._iceGatherers.length) return this._iceGatherers.shift(); var i = new e.RTCIceGatherer({ iceServers: this._config.iceServers, gatherPolicy: this._config.iceTransportPolicy }); return Object.defineProperty(i, "state", { value: "new", writable: !0 }), this.transceivers[t].bufferedCandidateEvents = [], this.transceivers[t].bufferCandidates = function (e) { var n = !e.candidate || 0 === Object.keys(e.candidate).length; i.state = n ? "completed" : "gathering", null !== r.transceivers[t].bufferedCandidateEvents && r.transceivers[t].bufferedCandidateEvents.push(e) }, i.addEventListener("localcandidate", this.transceivers[t].bufferCandidates), i }, f.prototype._gather = function (t, n) { var i = this, o = this.transceivers[n].iceGatherer; if (!o.onlocalcandidate) { var a = this.transceivers[n].bufferedCandidateEvents; this.transceivers[n].bufferedCandidateEvents = null, o.removeEventListener("localcandidate", this.transceivers[n].bufferCandidates), o.onlocalcandidate = function (e) { if (!(i.usingBundle && n > 0)) { var a = new Event("icecandidate"); a.candidate = { sdpMid: t, sdpMLineIndex: n }; var s = e.candidate, c = !s || 0 === Object.keys(s).length; if (c) "new" !== o.state && "gathering" !== o.state || (o.state = "completed"); else { "new" === o.state && (o.state = "gathering"), s.component = 1, s.ufrag = o.getLocalParameters().usernameFragment; var u = r.writeCandidate(s); a.candidate = Object.assign(a.candidate, r.parseCandidate(u)), a.candidate.candidate = u, a.candidate.toJSON = function () { return { candidate: a.candidate.candidate, sdpMid: a.candidate.sdpMid, sdpMLineIndex: a.candidate.sdpMLineIndex, usernameFragment: a.candidate.usernameFragment } } } var f = r.getMediaSections(i._localDescription.sdp); f[a.candidate.sdpMLineIndex] += c ? "a=end-of-candidates\r\n" : "a=" + a.candidate.candidate + "\r\n", i._localDescription.sdp = r.getDescription(i._localDescription.sdp) + f.join(""); var l = i.transceivers.every((function (e) { return e.iceGatherer && "completed" === e.iceGatherer.state })); "gathering" !== i.iceGatheringState && (i.iceGatheringState = "gathering", i._emitGatheringStateChange()), c || i._dispatchEvent("icecandidate", a), l && (i._dispatchEvent("icecandidate", new Event("icecandidate")), i.iceGatheringState = "complete", i._emitGatheringStateChange()) } }, e.setTimeout((function () { a.forEach((function (e) { o.onlocalcandidate(e) })) }), 0) } }, f.prototype._createIceAndDtlsTransports = function () { var t = this, n = new e.RTCIceTransport(null); n.onicestatechange = function () { t._updateIceConnectionState(), t._updateConnectionState() }; var r = new e.RTCDtlsTransport(n); return r.ondtlsstatechange = function () { t._updateConnectionState() }, r.onerror = function () { Object.defineProperty(r, "state", { value: "failed", writable: !0 }), t._updateConnectionState() }, { iceTransport: n, dtlsTransport: r } }, f.prototype._disposeIceAndDtlsTransports = function (e) { var t = this.transceivers[e].iceGatherer; t && (delete t.onlocalcandidate, delete this.transceivers[e].iceGatherer); var n = this.transceivers[e].iceTransport; n && (delete n.onicestatechange, delete this.transceivers[e].iceTransport); var r = this.transceivers[e].dtlsTransport; r && (delete r.ondtlsstatechange, delete r.onerror, delete this.transceivers[e].dtlsTransport) }, f.prototype._transceive = function (e, n, i) { var a = o(e.localCapabilities, e.remoteCapabilities); n && e.rtpSender && (a.encodings = e.sendEncodingParameters, a.rtcp = { cname: r.localCName, compound: e.rtcpParameters.compound }, e.recvEncodingParameters.length && (a.rtcp.ssrc = e.recvEncodingParameters[0].ssrc), e.rtpSender.send(a)), i && e.rtpReceiver && a.codecs.length > 0 && ("video" === e.kind && e.recvEncodingParameters && t < 15019 && e.recvEncodingParameters.forEach((function (e) { delete e.rtx })), e.recvEncodingParameters.length ? a.encodings = e.recvEncodingParameters : a.encodings = [{}], a.rtcp = { compound: e.rtcpParameters.compound }, e.rtcpParameters.cname && (a.rtcp.cname = e.rtcpParameters.cname), e.sendEncodingParameters.length && (a.rtcp.ssrc = e.sendEncodingParameters[0].ssrc), e.rtpReceiver.receive(a)) }, f.prototype.setLocalDescription = function (e) { var t, n, i = this; if (-1 === ["offer", "answer"].indexOf(e.type)) return Promise.reject(c("TypeError", 'Unsupported type "' + e.type + '"')); if (!a("setLocalDescription", e.type, i.signalingState) || i._isClosed) return Promise.reject(c("InvalidStateError", "Can not set local " + e.type + " in state " + i.signalingState)); if ("offer" === e.type) t = r.splitSections(e.sdp), n = t.shift(), t.forEach((function (e, t) { var n = r.parseRtpParameters(e); i.transceivers[t].localCapabilities = n })), i.transceivers.forEach((function (e, t) { i._gather(e.mid, t) })); else if ("answer" === e.type) { t = r.splitSections(i._remoteDescription.sdp), n = t.shift(); var s = r.matchPrefix(n, "a=ice-lite").length > 0; t.forEach((function (e, t) { var a = i.transceivers[t], c = a.iceGatherer, u = a.iceTransport, f = a.dtlsTransport, l = a.localCapabilities, d = a.remoteCapabilities; if (!(r.isRejected(e) && 0 === r.matchPrefix(e, "a=bundle-only").length) && !a.rejected) { var p = r.getIceParameters(e, n), h = r.getDtlsParameters(e, n); s && (h.role = "server"), i.usingBundle && 0 !== t || (i._gather(a.mid, t), "new" === u.state && u.start(c, p, s ? "controlling" : "controlled"), "new" === f.state && f.start(h)); var v = o(l, d); i._transceive(a, v.codecs.length > 0, !1) } })) } return i._localDescription = { type: e.type, sdp: e.sdp }, "offer" === e.type ? i._updateSignalingState("have-local-offer") : i._updateSignalingState("stable"), Promise.resolve() }, f.prototype.setRemoteDescription = function (i) { var f = this; if (-1 === ["offer", "answer"].indexOf(i.type)) return Promise.reject(c("TypeError", 'Unsupported type "' + i.type + '"')); if (!a("setRemoteDescription", i.type, f.signalingState) || f._isClosed) return Promise.reject(c("InvalidStateError", "Can not set remote " + i.type + " in state " + f.signalingState)); var l = {}; f.remoteStreams.forEach((function (e) { l[e.id] = e })); var d = [], p = r.splitSections(i.sdp), h = p.shift(), v = r.matchPrefix(h, "a=ice-lite").length > 0, m = r.matchPrefix(h, "a=group:BUNDLE ").length > 0; f.usingBundle = m; var g = r.matchPrefix(h, "a=ice-options:")[0]; return f.canTrickleIceCandidates = !!g && g.substr(14).split(" ").indexOf("trickle") >= 0, p.forEach((function (a, c) { var u = r.splitLines(a), p = r.getKind(a), g = r.isRejected(a) && 0 === r.matchPrefix(a, "a=bundle-only").length, y = u[0].substr(2).split(" ")[2], _ = r.getDirection(a, h), b = r.parseMsid(a), C = r.getMid(a) || r.generateIdentifier(); if (g || "application" === p && ("DTLS/SCTP" === y || "UDP/DTLS/SCTP" === y)) f.transceivers[c] = { mid: C, kind: p, protocol: y, rejected: !0 }; else { var S, E, T, w, R, k, P, O, D; !g && f.transceivers[c] && f.transceivers[c].rejected && (f.transceivers[c] = f._createTransceiver(p, !0)); var x, I, M = r.parseRtpParameters(a); g || (x = r.getIceParameters(a, h), (I = r.getDtlsParameters(a, h)).role = "client"), P = r.parseRtpEncodingParameters(a); var A = r.parseRtcpParameters(a), j = r.matchPrefix(a, "a=end-of-candidates", h).length > 0, N = r.matchPrefix(a, "a=candidate:").map((function (e) { return r.parseCandidate(e) })).filter((function (e) { return 1 === e.component })); if (("offer" === i.type || "answer" === i.type) && !g && m && c > 0 && f.transceivers[c] && (f._disposeIceAndDtlsTransports(c), f.transceivers[c].iceGatherer = f.transceivers[0].iceGatherer, f.transceivers[c].iceTransport = f.transceivers[0].iceTransport, f.transceivers[c].dtlsTransport = f.transceivers[0].dtlsTransport, f.transceivers[c].rtpSender && f.transceivers[c].rtpSender.setTransport(f.transceivers[0].dtlsTransport), f.transceivers[c].rtpReceiver && f.transceivers[c].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport)), "offer" !== i.type || g) { if ("answer" === i.type && !g) { E = (S = f.transceivers[c]).iceGatherer, T = S.iceTransport, w = S.dtlsTransport, R = S.rtpReceiver, k = S.sendEncodingParameters, O = S.localCapabilities, f.transceivers[c].recvEncodingParameters = P, f.transceivers[c].remoteCapabilities = M, f.transceivers[c].rtcpParameters = A, N.length && "new" === T.state && (!v && !j || m && 0 !== c ? N.forEach((function (e) { s(S.iceTransport, e) })) : T.setRemoteCandidates(N)), m && 0 !== c || ("new" === T.state && T.start(E, x, "controlling"), "new" === w.state && w.start(I)), !o(S.localCapabilities, S.remoteCapabilities).codecs.filter((function (e) { return "rtx" === e.name.toLowerCase() })).length && S.sendEncodingParameters[0].rtx && delete S.sendEncodingParameters[0].rtx, f._transceive(S, "sendrecv" === _ || "recvonly" === _, "sendrecv" === _ || "sendonly" === _), !R || "sendrecv" !== _ && "sendonly" !== _ ? delete S.rtpReceiver : (D = R.track, b ? (l[b.stream] || (l[b.stream] = new e.MediaStream), n(D, l[b.stream]), d.push([D, R, l[b.stream]])) : (l.default || (l.default = new e.MediaStream), n(D, l.default), d.push([D, R, l.default]))) } } else { (S = f.transceivers[c] || f._createTransceiver(p)).mid = C, S.iceGatherer || (S.iceGatherer = f._createIceGatherer(c, m)), N.length && "new" === S.iceTransport.state && (!j || m && 0 !== c ? N.forEach((function (e) { s(S.iceTransport, e) })) : S.iceTransport.setRemoteCandidates(N)), O = e.RTCRtpReceiver.getCapabilities(p), t < 15019 && (O.codecs = O.codecs.filter((function (e) { return "rtx" !== e.name }))), k = S.sendEncodingParameters || [{ ssrc: 1001 * (2 * c + 2) }]; var L, F = !1; if ("sendrecv" === _ || "sendonly" === _) { if (F = !S.rtpReceiver, R = S.rtpReceiver || new e.RTCRtpReceiver(S.dtlsTransport, p), F) D = R.track, b && "-" === b.stream || (b ? (l[b.stream] || (l[b.stream] = new e.MediaStream, Object.defineProperty(l[b.stream], "id", { get: function () { return b.stream } })), Object.defineProperty(D, "id", { get: function () { return b.track } }), L = l[b.stream]) : (l.default || (l.default = new e.MediaStream), L = l.default)), L && (n(D, L), S.associatedRemoteMediaStreams.push(L)), d.push([D, R, L]) } else S.rtpReceiver && S.rtpReceiver.track && (S.associatedRemoteMediaStreams.forEach((function (t) { var n = t.getTracks().find((function (e) { return e.id === S.rtpReceiver.track.id })); n && function (t, n) { n.removeTrack(t), n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack", { track: t })) }(n, t) })), S.associatedRemoteMediaStreams = []); S.localCapabilities = O, S.remoteCapabilities = M, S.rtpReceiver = R, S.rtcpParameters = A, S.sendEncodingParameters = k, S.recvEncodingParameters = P, f._transceive(f.transceivers[c], !1, F) } } })), void 0 === f._dtlsRole && (f._dtlsRole = "offer" === i.type ? "active" : "passive"), f._remoteDescription = { type: i.type, sdp: i.sdp }, "offer" === i.type ? f._updateSignalingState("have-remote-offer") : f._updateSignalingState("stable"), Object.keys(l).forEach((function (t) { var n = l[t]; if (n.getTracks().length) { if (-1 === f.remoteStreams.indexOf(n)) { f.remoteStreams.push(n); var r = new Event("addstream"); r.stream = n, e.setTimeout((function () { f._dispatchEvent("addstream", r) })) } d.forEach((function (e) { var t = e[0], r = e[1]; n.id === e[2].id && u(f, t, r, [n]) })) } })), d.forEach((function (e) { e[2] || u(f, e[0], e[1], []) })), e.setTimeout((function () { f && f.transceivers && f.transceivers.forEach((function (e) { e.iceTransport && "new" === e.iceTransport.state && e.iceTransport.getRemoteCandidates().length > 0 && (console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"), e.iceTransport.addRemoteCandidate({})) })) }), 4e3), Promise.resolve() }, f.prototype.close = function () { this.transceivers.forEach((function (e) { e.iceTransport && e.iceTransport.stop(), e.dtlsTransport && e.dtlsTransport.stop(), e.rtpSender && e.rtpSender.stop(), e.rtpReceiver && e.rtpReceiver.stop() })), this._isClosed = !0, this._updateSignalingState("closed") }, f.prototype._updateSignalingState = function (e) { this.signalingState = e; var t = new Event("signalingstatechange"); this._dispatchEvent("signalingstatechange", t) }, f.prototype._maybeFireNegotiationNeeded = function () { var t = this; "stable" === this.signalingState && !0 !== this.needNegotiation && (this.needNegotiation = !0, e.setTimeout((function () { if (t.needNegotiation) { t.needNegotiation = !1; var e = new Event("negotiationneeded"); t._dispatchEvent("negotiationneeded", e) } }), 0)) }, f.prototype._updateIceConnectionState = function () { var e, t = { new: 0, closed: 0, checking: 0, connected: 0, completed: 0, disconnected: 0, failed: 0 }; if (this.transceivers.forEach((function (e) { e.iceTransport && !e.rejected && t[e.iceTransport.state]++ })), e = "new", t.failed > 0 ? e = "failed" : t.checking > 0 ? e = "checking" : t.disconnected > 0 ? e = "disconnected" : t.new > 0 ? e = "new" : t.connected > 0 ? e = "connected" : t.completed > 0 && (e = "completed"), e !== this.iceConnectionState) { this.iceConnectionState = e; var n = new Event("iceconnectionstatechange"); this._dispatchEvent("iceconnectionstatechange", n) } }, f.prototype._updateConnectionState = function () { var e, t = { new: 0, closed: 0, connecting: 0, connected: 0, completed: 0, disconnected: 0, failed: 0 }; if (this.transceivers.forEach((function (e) { e.iceTransport && e.dtlsTransport && !e.rejected && (t[e.iceTransport.state]++, t[e.dtlsTransport.state]++) })), t.connected += t.completed, e = "new", t.failed > 0 ? e = "failed" : t.connecting > 0 ? e = "connecting" : t.disconnected > 0 ? e = "disconnected" : t.new > 0 ? e = "new" : t.connected > 0 && (e = "connected"), e !== this.connectionState) { this.connectionState = e; var n = new Event("connectionstatechange"); this._dispatchEvent("connectionstatechange", n) } }, f.prototype.createOffer = function () { var n = this; if (n._isClosed) return Promise.reject(c("InvalidStateError", "Can not call createOffer after close")); var o = n.transceivers.filter((function (e) { return "audio" === e.kind })).length, a = n.transceivers.filter((function (e) { return "video" === e.kind })).length, s = arguments[0]; if (s) { if (s.mandatory || s.optional) throw new TypeError("Legacy mandatory/optional constraints not supported."); void 0 !== s.offerToReceiveAudio && (o = !0 === s.offerToReceiveAudio ? 1 : !1 === s.offerToReceiveAudio ? 0 : s.offerToReceiveAudio), void 0 !== s.offerToReceiveVideo && (a = !0 === s.offerToReceiveVideo ? 1 : !1 === s.offerToReceiveVideo ? 0 : s.offerToReceiveVideo) } for (n.transceivers.forEach((function (e) { "audio" === e.kind ? --o < 0 && (e.wantReceive = !1) : "video" === e.kind && --a < 0 && (e.wantReceive = !1) })); o > 0 || a > 0;)o > 0 && (n._createTransceiver("audio"), o--), a > 0 && (n._createTransceiver("video"), a--); var u = r.writeSessionBoilerplate(n._sdpSessionId, n._sdpSessionVersion++); n.transceivers.forEach((function (i, o) { var a = i.track, s = i.kind, c = i.mid || r.generateIdentifier(); i.mid = c, i.iceGatherer || (i.iceGatherer = n._createIceGatherer(o, n.usingBundle)); var u = e.RTCRtpSender.getCapabilities(s); t < 15019 && (u.codecs = u.codecs.filter((function (e) { return "rtx" !== e.name }))), u.codecs.forEach((function (e) { "H264" === e.name && void 0 === e.parameters["level-asymmetry-allowed"] && (e.parameters["level-asymmetry-allowed"] = "1"), i.remoteCapabilities && i.remoteCapabilities.codecs && i.remoteCapabilities.codecs.forEach((function (t) { e.name.toLowerCase() === t.name.toLowerCase() && e.clockRate === t.clockRate && (e.preferredPayloadType = t.payloadType) })) })), u.headerExtensions.forEach((function (e) { (i.remoteCapabilities && i.remoteCapabilities.headerExtensions || []).forEach((function (t) { e.uri === t.uri && (e.id = t.id) })) })); var f = i.sendEncodingParameters || [{ ssrc: 1001 * (2 * o + 1) }]; a && t >= 15019 && "video" === s && !f[0].rtx && (f[0].rtx = { ssrc: f[0].ssrc + 1 }), i.wantReceive && (i.rtpReceiver = new e.RTCRtpReceiver(i.dtlsTransport, s)), i.localCapabilities = u, i.sendEncodingParameters = f })), "max-compat" !== n._config.bundlePolicy && (u += "a=group:BUNDLE " + n.transceivers.map((function (e) { return e.mid })).join(" ") + "\r\n"), u += "a=ice-options:trickle\r\n", n.transceivers.forEach((function (e, t) { u += i(e, e.localCapabilities, "offer", e.stream, n._dtlsRole), u += "a=rtcp-rsize\r\n", !e.iceGatherer || "new" === n.iceGatheringState || 0 !== t && n.usingBundle || (e.iceGatherer.getLocalCandidates().forEach((function (e) { e.component = 1, u += "a=" + r.writeCandidate(e) + "\r\n" })), "completed" === e.iceGatherer.state && (u += "a=end-of-candidates\r\n")) })); var f = new e.RTCSessionDescription({ type: "offer", sdp: u }); return Promise.resolve(f) }, f.prototype.createAnswer = function () { var n = this; if (n._isClosed) return Promise.reject(c("InvalidStateError", "Can not call createAnswer after close")); if ("have-remote-offer" !== n.signalingState && "have-local-pranswer" !== n.signalingState) return Promise.reject(c("InvalidStateError", "Can not call createAnswer in signalingState " + n.signalingState)); var a = r.writeSessionBoilerplate(n._sdpSessionId, n._sdpSessionVersion++); n.usingBundle && (a += "a=group:BUNDLE " + n.transceivers.map((function (e) { return e.mid })).join(" ") + "\r\n"), a += "a=ice-options:trickle\r\n"; var s = r.getMediaSections(n._remoteDescription.sdp).length; n.transceivers.forEach((function (e, r) { if (!(r + 1 > s)) { if (e.rejected) return "application" === e.kind ? "DTLS/SCTP" === e.protocol ? a += "m=application 0 DTLS/SCTP 5000\r\n" : a += "m=application 0 " + e.protocol + " webrtc-datachannel\r\n" : "audio" === e.kind ? a += "m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n" : "video" === e.kind && (a += "m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"), void (a += "c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:" + e.mid + "\r\n"); var c; if (e.stream) "audio" === e.kind ? c = e.stream.getAudioTracks()[0] : "video" === e.kind && (c = e.stream.getVideoTracks()[0]), c && t >= 15019 && "video" === e.kind && !e.sendEncodingParameters[0].rtx && (e.sendEncodingParameters[0].rtx = { ssrc: e.sendEncodingParameters[0].ssrc + 1 }); var u = o(e.localCapabilities, e.remoteCapabilities); !u.codecs.filter((function (e) { return "rtx" === e.name.toLowerCase() })).length && e.sendEncodingParameters[0].rtx && delete e.sendEncodingParameters[0].rtx, a += i(e, u, "answer", e.stream, n._dtlsRole), e.rtcpParameters && e.rtcpParameters.reducedSize && (a += "a=rtcp-rsize\r\n") } })); var u = new e.RTCSessionDescription({ type: "answer", sdp: a }); return Promise.resolve(u) }, f.prototype.addIceCandidate = function (e) { var t, n = this; return e && void 0 === e.sdpMLineIndex && !e.sdpMid ? Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")) : new Promise((function (i, o) { if (!n._remoteDescription) return o(c("InvalidStateError", "Can not add ICE candidate without a remote description")); if (e && "" !== e.candidate) { var a = e.sdpMLineIndex; if (e.sdpMid) for (var u = 0; u < n.transceivers.length; u++)if (n.transceivers[u].mid === e.sdpMid) { a = u; break } var f = n.transceivers[a]; if (!f) return o(c("OperationError", "Can not add ICE candidate")); if (f.rejected) return i(); var l = Object.keys(e.candidate).length > 0 ? r.parseCandidate(e.candidate) : {}; if ("tcp" === l.protocol && (0 === l.port || 9 === l.port)) return i(); if (l.component && 1 !== l.component) return i(); if ((0 === a || a > 0 && f.iceTransport !== n.transceivers[0].iceTransport) && !s(f.iceTransport, l)) return o(c("OperationError", "Can not add ICE candidate")); var d = e.candidate.trim(); 0 === d.indexOf("a=") && (d = d.substr(2)), (t = r.getMediaSections(n._remoteDescription.sdp))[a] += "a=" + (l.type ? d : "end-of-candidates") + "\r\n", n._remoteDescription.sdp = r.getDescription(n._remoteDescription.sdp) + t.join("") } else for (var p = 0; p < n.transceivers.length && (n.transceivers[p].rejected || (n.transceivers[p].iceTransport.addRemoteCandidate({}), (t = r.getMediaSections(n._remoteDescription.sdp))[p] += "a=end-of-candidates\r\n", n._remoteDescription.sdp = r.getDescription(n._remoteDescription.sdp) + t.join(""), !n.usingBundle)); p++); i() })) }, f.prototype.getStats = function (t) { if (t && t instanceof e.MediaStreamTrack) { var n = null; if (this.transceivers.forEach((function (e) { e.rtpSender && e.rtpSender.track === t ? n = e.rtpSender : e.rtpReceiver && e.rtpReceiver.track === t && (n = e.rtpReceiver) })), !n) throw c("InvalidAccessError", "Invalid selector."); return n.getStats() } var r = []; return this.transceivers.forEach((function (e) { ["rtpSender", "rtpReceiver", "iceGatherer", "iceTransport", "dtlsTransport"].forEach((function (t) { e[t] && r.push(e[t].getStats()) })) })), Promise.all(r).then((function (e) { var t = new Map; return e.forEach((function (e) { e.forEach((function (e) { t.set(e.id, e) })) })), t })) };["RTCRtpSender", "RTCRtpReceiver", "RTCIceGatherer", "RTCIceTransport", "RTCDtlsTransport"].forEach((function (t) { var n = e[t]; if (n && n.prototype && n.prototype.getStats) { var r = n.prototype.getStats; n.prototype.getStats = function () { return r.apply(this).then((function (e) { var t = new Map; return Object.keys(e).forEach((function (n) { var r; e[n].type = { inboundrtp: "inbound-rtp", outboundrtp: "outbound-rtp", candidatepair: "candidate-pair", localcandidate: "local-candidate", remotecandidate: "remote-candidate" }[(r = e[n]).type] || r.type, t.set(n, e[n]) })), t })) } } })); var l = ["createOffer", "createAnswer"]; return l.forEach((function (e) { var t = f.prototype[e]; f.prototype[e] = function () { var e = arguments; return "function" == typeof e[0] || "function" == typeof e[1] ? t.apply(this, [arguments[2]]).then((function (t) { "function" == typeof e[0] && e[0].apply(null, [t]) }), (function (t) { "function" == typeof e[1] && e[1].apply(null, [t]) })) : t.apply(this, arguments) } })), (l = ["setLocalDescription", "setRemoteDescription", "addIceCandidate"]).forEach((function (e) { var t = f.prototype[e]; f.prototype[e] = function () { var e = arguments; return "function" == typeof e[1] || "function" == typeof e[2] ? t.apply(this, arguments).then((function () { "function" == typeof e[1] && e[1].apply(null) }), (function (t) { "function" == typeof e[2] && e[2].apply(null, [t]) })) : t.apply(this, arguments) } })), ["getStats"].forEach((function (e) { var t = f.prototype[e]; f.prototype[e] = function () { var e = arguments; return "function" == typeof e[1] ? t.apply(this, arguments).then((function () { "function" == typeof e[1] && e[1].apply(null) })) : t.apply(this, arguments) } })), f } }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(3), i = n(34), o = n(15), a = n(47), s = n(9), c = n(7), u = n(61), f = n(62), l = n(80), d = n(29), p = n(84), h = n(30), v = n(14), m = function () { function e(e, t) { if (void 0 === t && (t = {}), this.token = e, this.rtcOptions = t, !this.isWebRTCSupported()) throw new Error("Browser does not support WebRTC."); this.eventEmitter = new r.EventEmitter, this.apiEventEmitter = new r.EventEmitter, this.gateway = new i.InfobipGatewayImpl(this.eventEmitter, this.token), this.device = new l.DefaultDevice, this.activeCall = null, this.rtcConfig = {}, this.configureEventHandlers.call(this) } return e.prototype.connect = function () { this.validateStatus(o.default.OFFLINE, "connect"), this.gateway.connect(!1) }, e.prototype.disconnect = function () { this.logger && this.logger.stop(), this.gateway.disconnect() }, e.prototype.on = function (t, n) { if (!e.ALLOWED_API_EVENTS.includes(t)) throw new Error("Unknown event: " + t + "!"); this.apiEventEmitter.on(t, n) }, e.prototype.call = function (t, n) { if (this.validateStatus(o.default.CONNECTED, "call"), this.activeCall) throw Error("Call already in progress."); if (!e.IDENTITY_PATTERN.test(t)) throw Error("Invalid destination."); var r = this.getUserFromToken(v(this.token)), i = new d.User(t, null); return this.activeCall = new a.DefaultOutgoingCall(this.eventEmitter, this.apiEventEmitter, this.gateway, this.logger, this.rtcConfig, this.device, r, i, n), this.activeCall }, e.prototype.callPhoneNumber = function (t, n) { if (this.validateStatus(o.default.CONNECTED, "callPhoneNumber"), this.activeCall) throw Error("Call already in progress."); if (!e.PHONE_NUMBER_PATTERN.test(t)) throw Error("Invalid destination."); var r = this.getUserFromToken(v(this.token)), i = new d.User(t, null); return this.activeCall = new a.DefaultOutgoingCall(this.eventEmitter, this.apiEventEmitter, this.gateway, this.logger, this.rtcConfig, this.device, r, i, n, !0), this.activeCall }, e.prototype.callSIP = function (t) { if (this.validateStatus(o.default.CONNECTED, "callSIP"), this.activeCall) throw Error("Call already in progress."); if (!e.IDENTITY_PATTERN.test(t)) throw Error("Invalid destination."); var n = this.getUserFromToken(v(this.token)), r = new d.User(t, null); return this.activeCall = new a.DefaultOutgoingCall(this.eventEmitter, this.apiEventEmitter, this.gateway, this.logger, this.rtcConfig, this.device, n, r, null, !1, !1, !1, !0), this.activeCall }, e.prototype.callDynamicDestination = function (e) { if (this.validateStatus(o.default.CONNECTED, "callDynamicDestination"), this.activeCall) throw Error("Call already in progress."); var t = this.getUserFromToken(v(this.token)), n = new d.User(null, null); return this.activeCall = new a.DefaultOutgoingCall(this.eventEmitter, this.apiEventEmitter, this.gateway, this.logger, this.rtcConfig, this.device, t, n, e, !1, !1, !0), this.activeCall }, e.prototype.getAudioInputDevices = function () { return this.device.getAudioInputDevices() }, e.prototype.setAudioInputDevice = function (e) { this.device.setAudioInputDevice(e) }, e.prototype.unsetAudioInputDevice = function (e) { this.device.unsetAudioInputDevice(e) }, e.prototype.getAudioOutputDevices = function () { return this.device.getAudioOutputDevices() }, e.prototype.getVideoInputDevices = function () { return this.device.getVideoInputDevices() }, e.prototype.setVideoInputDevice = function (e) { this.device.setVideoInputDevice(e) }, e.prototype.unsetVideoInputDevice = function (e) { this.device.unsetVideoInputDevice(e) }, e.prototype.validateStatus = function (e, t) { var n = this.gateway.status; if (e !== n) throw new Error("Cannot " + t + ", required status is " + o.StatusLabels.get(e) + ", current status is " + o.StatusLabels.get(n) + ".") }, e.prototype.configureEventHandlers = function () { this.eventEmitter.once("registered", this.handleRegistered.bind(this)), this.eventEmitter.on("registration_failed", this.handleDisconnect.bind(this)), this.eventEmitter.once("disconnected", this.handleDisconnect.bind(this)), this.eventEmitter.on("reconnecting", this.handleReconnecting.bind(this)), this.eventEmitter.on("reconnected", this.handleReconnected.bind(this)), this.eventEmitter.on("connection_closed", this.handleConnectionClosed.bind(this)), this.eventEmitter.on("call", this.handleIncomingCall.bind(this)), this.eventEmitter.on("call_finished", this.handleHangup.bind(this)) }, e.prototype.handleRegistered = function (e) { e.iceServers && (this.rtcConfig.iceServers = e.iceServers); var t = this.rtcOptions.statsUrl || e.apiUrl; e.loggerOptions ? this.logger = new f.DefaultLogger(this.token, e.loggerOptions, t) : this.logger = new f.DefaultLogger(this.token, new p.LoggerOptions(null), t), this.apiEventEmitter.emit("connected", { identity: e.identity }) }, e.prototype.handleIncomingCall = function (e) { if (this.activeCall) return this.apiEventEmitter.emit("call-error", c.ErrorCode.ACTIVE_CALL_ON_INCOMING_CALL); var t = this.getUserFromToken(v(this.token)); this.activeCall = new u.DefaultIncomingCall(this.eventEmitter, this.apiEventEmitter, this.gateway, this.logger, this.rtcConfig, this.device, e.caller, t, e.description, e.callId, e.correlationId), this.apiEventEmitter.emit("incoming-call", new h.IncomingCallEvent(this.activeCall, e.customData)) }, e.prototype.handleHangup = function (e) { delete this.activeCall }, e.prototype.handleReconnecting = function (e) { this.apiEventEmitter.emit("reconnecting", {}) }, e.prototype.handleReconnected = function (e) { this.apiEventEmitter.emit("reconnected", {}) }, e.prototype.handleConnectionClosed = function (e) { this.activeCall && this.eventEmitter.emit("hangup", { status: new s.HangupStatus(5050, "EC_CONNECTION_ERROR", "Connection error.") }) }, e.prototype.handleDisconnect = function (t) { var n = this; this.apiEventEmitter.emit("disconnected", { reason: t.reason }), this.eventEmitter.removeAllListeners("registered"), this.eventEmitter.removeAllListeners("registration_failed"), this.eventEmitter.removeAllListeners("disconnected"), this.eventEmitter.removeAllListeners("reconnecting"), this.eventEmitter.removeAllListeners("reconnected"), this.eventEmitter.removeAllListeners("connection_closed"), this.eventEmitter.removeAllListeners("call"), this.eventEmitter.removeAllListeners("hangup"), this.eventEmitter.removeAllListeners("call-error"), e.ALLOWED_API_EVENTS.forEach((function (e) { return n.apiEventEmitter.removeAllListeners(e) })) }, e.prototype.isWebRTCSupported = function () { return void 0 !== RTCPeerConnection && null !== RTCPeerConnection && void 0 !== navigator.getUserMedia && null !== navigator.getUserMedia }, e.prototype.getUserFromToken = function (e) { var t = e.identity, n = e.name; return new d.User(t, n) }, e.ALLOWED_API_EVENTS = ["connected", "disconnected", "reconnecting", "reconnected", "incoming-call"], e.IDENTITY_PATTERN = /^[a-zA-Z0-9\\._-]+$/, e.PHONE_NUMBER_PATTERN = /^[0-9+]+$/, e }(); t.InfobipRTC = m }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(35), i = n(14), o = n(44), a = n(15), s = n(45), c = n(46).getParser(window.navigator.userAgent), u = function () { function e(e, t) { this.eventEmitter = e, this.token = t, this.status = a.default.OFFLINE, this.url = this.generatePortunusUrl(i(t)), this.deviceInfo = this.encodeDeviceInfo(), this.setupBackOff() } return e.prototype.connect = function (e) { void 0 === e && (e = !1), this.ws = new WebSocket("wss://" + this.url, [this.token, this.deviceInfo]), this.status = e ? a.default.RECONNECTING : a.default.CONNECTING, this.ws.onopen = this.onOpen.bind(this), this.ws.onclose = this.onClose.bind(this), this.ws.onmessage = this.onMessage.bind(this), this.ws.onerror = this.onError.bind(this) }, e.prototype.disconnect = function () { this.status === a.default.CONNECTED && (this.send({ action: "destroy" }), this.ws.close()), this.backoff.reset(), this.status = a.default.OFFLINE }, e.prototype.send = function (e) { if (this.status === a.default.CONNECTED) { this.logSendingMessage(e); var t = JSON.stringify(e); this.ws.send(t) } else console.error("Socket to Infobip WebRTC Gateway not opened, could not send " + e + "!") }, e.prototype.encodeDeviceInfo = function () { var e = JSON.stringify(this.generateDeviceInfo()); return this.base64EncodeUrl(window.btoa(e)) }, e.prototype.generatePortunusUrl = function (e) { var t = e.location; return t ? "io" === t ? "portunus.ioinfobip.com" : "portunus-" + t + ".infobip.com" : "portunus.infobip.com" }, e.prototype.logSendingMessage = function (e) { "heartbeat" !== e.action && console.log("Sending " + JSON.stringify(e) + " to Infobip WebRTC Gateway...") }, e.prototype.onOpen = function () { console.log("Socket to Infobip WebRTC Gateway opened."), this.status === a.default.RECONNECTING && this.eventEmitter.emit("reconnected"), this.status = a.default.CONNECTED, this.scheduleHeartbeat(), this.backoff.reset() }, e.prototype.onMessage = function (e) { var t = JSON.parse(e.data); this.logReceivedMessage(t), "heartbeat_resp" !== t.event ? ("registration_failed" === t.event && this.disconnect(), this.eventEmitter.emit(t.event, t)) : clearTimeout(this.heartbeatCheck) }, e.prototype.logReceivedMessage = function (e) { "heartbeat_resp" !== e.event && console.log("Received message from Infobip Gateway: " + JSON.stringify(e) + ".") }, e.prototype.onClose = function (e) { console.log("Socket closed, code " + e.code + ", reason: " + e.reason + "."), this.cleanup(), this.status !== a.default.OFFLINE && e.code < 4e3 ? (this.eventEmitter.emit("connection_closed"), this.backoff.backoff(), this.status === a.default.CONNECTED && this.eventEmitter.emit("reconnecting")) : (this.status = a.default.OFFLINE, this.eventEmitter.emit("disconnected", e)) }, e.prototype.cleanup = function () { clearInterval(this.heartbeat), clearTimeout(this.heartbeatCheck), this.ws.onopen = null, this.ws.onclose = null, this.ws.onmessage = null, this.ws.onerror = null, delete this.ws }, e.prototype.onError = function (e) { console.error("Socket error: " + e + ".") }, e.prototype.scheduleHeartbeat = function () { var e = this; this.heartbeat = setInterval((function () { e.ws.readyState === WebSocket.OPEN && (e.send({ action: "heartbeat" }), e.scheduleHeartbeatCheck()) }), o.default.HEARTBEAT_PERIOD) }, e.prototype.scheduleHeartbeatCheck = function () { clearTimeout(this.heartbeatCheck); var e = this; this.heartbeatCheck = setTimeout((function () { console.log("No heartbeat response in " + o.default.HEARTBEAT_TIMEOUT + " milliseconds. Closing socket..."), e.onClose({ code: 3e3, reason: "Heartbeat timeout." }) }), o.default.HEARTBEAT_TIMEOUT) }, e.prototype.setupBackOff = function () { this.backoff = r.exponential({ initialDelay: o.default.RECONNECT_INITIAL_DELAY, maxDelay: o.default.RECONNECT_MAX_DELAY }), this.backoff.failAfter(o.default.RECONNECT_MAX); var e = this; this.backoff.on("ready", (function (t, n) { console.log("Reconnect attempt " + t + "..."), e.connect(!0) })), this.backoff.on("fail", (function () { console.log("Reconnecting failed..."), e.eventEmitter.emit("disconnected", { reason: "Connection error." }) })) }, e.prototype.generateDeviceInfo = function () { return { sdk: { type: "js", version: s.version }, device: { browser: c.getBrowser(), os: c.getOS() } } }, e.prototype.base64EncodeUrl = function (e) { return e.replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "") }, e }(); t.InfobipGatewayImpl = u }, function (e, t, n) { var r = n(10), i = n(40), o = n(13), a = n(41); e.exports.Backoff = r, e.exports.FunctionCall = a, e.exports.FibonacciStrategy = o, e.exports.ExponentialStrategy = i, e.exports.fibonacci = function (e) { return new r(new o(e)) }, e.exports.exponential = function (e) { return new r(new i(e)) }, e.exports.call = function (e, t, n) { var r = Array.prototype.slice.call(arguments); return e = r[0], t = r.slice(1, r.length - 1), n = r[r.length - 1], new a(e, t, n) } }, function (e, t, n) { var r = n(1), i = e.exports = n(39); function o(e, t, n, i) { n = n || ""; var o = new e(r.format.apply(this, [n].concat(i))); throw Error.captureStackTrace(o, t), o } function a(e, t, n) { o(i.IllegalArgumentError, e, t, n) } function s(e, t, n) { o(i.IllegalStateError, e, t, n) } function c(e) { var t = typeof e; if ("object" == t) { if (!e) return "null"; if (e instanceof Array) return "array" } return t } function u(e) { return function (t, n) { var r = c(t); if (r == e) return t; a(arguments.callee, n || 'Expected "' + e + '" but got "' + r + '".', Array.prototype.slice.call(arguments, 2)) } } e.exports.checkArgument = function (e, t) { e || a(arguments.callee, t, Array.prototype.slice.call(arguments, 2)) }, e.exports.checkState = function (e, t) { e || s(arguments.callee, t, Array.prototype.slice.call(arguments, 2)) }, e.exports.checkIsDef = function (e, t) { if (void 0 !== e) return e; a(arguments.callee, t || "Expected value to be defined but was undefined.", Array.prototype.slice.call(arguments, 2)) }, e.exports.checkIsDefAndNotNull = function (e, t) { if (null != e) return e; a(arguments.callee, t || 'Expected value to be defined and not null but got "' + c(e) + '".', Array.prototype.slice.call(arguments, 2)) }, e.exports.checkIsString = u("string"), e.exports.checkIsArray = u("array"), e.exports.checkIsNumber = u("number"), e.exports.checkIsBoolean = u("boolean"), e.exports.checkIsFunction = u("function"), e.exports.checkIsObject = u("object") }, function (e, t) { e.exports = function (e) { return e && "object" == typeof e && "function" == typeof e.copy && "function" == typeof e.fill && "function" == typeof e.readUInt8 } }, function (e, t) { "function" == typeof Object.create ? e.exports = function (e, t) { e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }) } : e.exports = function (e, t) { e.super_ = t; var n = function () { }; n.prototype = t.prototype, e.prototype = new n, e.prototype.constructor = e } }, function (e, t, n) { var r = n(1); function i(e) { Error.call(this, e), this.message = e } function o(e) { Error.call(this, e), this.message = e } r.inherits(i, Error), i.prototype.name = "IllegalArgumentError", r.inherits(o, Error), o.prototype.name = "IllegalStateError", e.exports.IllegalStateError = o, e.exports.IllegalArgumentError = i }, function (e, t, n) { var r = n(1), i = n(6), o = n(12); function a(e) { o.call(this, e), this.backoffDelay_ = 0, this.nextBackoffDelay_ = this.getInitialDelay(), this.factor_ = a.DEFAULT_FACTOR, e && void 0 !== e.factor && (i.checkArgument(e.factor > 1, "Exponential factor should be greater than 1 but got %s.", e.factor), this.factor_ = e.factor) } r.inherits(a, o), a.DEFAULT_FACTOR = 2, a.prototype.next_ = function () { return this.backoffDelay_ = Math.min(this.nextBackoffDelay_, this.getMaxDelay()), this.nextBackoffDelay_ = this.backoffDelay_ * this.factor_, this.backoffDelay_ }, a.prototype.reset_ = function () { this.backoffDelay_ = 0, this.nextBackoffDelay_ = this.getInitialDelay() }, e.exports = a }, function (e, t, n) { var r = n(3), i = n(6), o = n(1), a = n(10), s = n(13); function c(e, t, n) { r.EventEmitter.call(this), i.checkIsFunction(e, "Expected fn to be a function."), i.checkIsArray(t, "Expected args to be an array."), i.checkIsFunction(n, "Expected callback to be a function."), this.function_ = e, this.arguments_ = t, this.callback_ = n, this.lastResult_ = [], this.numRetries_ = 0, this.backoff_ = null, this.strategy_ = null, this.failAfter_ = -1, this.retryPredicate_ = c.DEFAULT_RETRY_PREDICATE_, this.state_ = c.State_.PENDING } o.inherits(c, r.EventEmitter), c.State_ = { PENDING: 0, RUNNING: 1, COMPLETED: 2, ABORTED: 3 }, c.DEFAULT_RETRY_PREDICATE_ = function (e) { return !0 }, c.prototype.isPending = function () { return this.state_ == c.State_.PENDING }, c.prototype.isRunning = function () { return this.state_ == c.State_.RUNNING }, c.prototype.isCompleted = function () { return this.state_ == c.State_.COMPLETED }, c.prototype.isAborted = function () { return this.state_ == c.State_.ABORTED }, c.prototype.setStrategy = function (e) { return i.checkState(this.isPending(), "FunctionCall in progress."), this.strategy_ = e, this }, c.prototype.retryIf = function (e) { return i.checkState(this.isPending(), "FunctionCall in progress."), this.retryPredicate_ = e, this }, c.prototype.getLastResult = function () { return this.lastResult_.concat() }, c.prototype.getNumRetries = function () { return this.numRetries_ }, c.prototype.failAfter = function (e) { return i.checkState(this.isPending(), "FunctionCall in progress."), this.failAfter_ = e, this }, c.prototype.abort = function () { this.isCompleted() || this.isAborted() || (this.isRunning() && this.backoff_.reset(), this.state_ = c.State_.ABORTED, this.lastResult_ = [new Error("Backoff aborted.")], this.emit("abort"), this.doCallback_()) }, c.prototype.start = function (e) { i.checkState(!this.isAborted(), "FunctionCall is aborted."), i.checkState(this.isPending(), "FunctionCall already started."); var t = this.strategy_ || new s; this.backoff_ = e ? e(t) : new a(t), this.backoff_.on("ready", this.doCall_.bind(this, !0)), this.backoff_.on("fail", this.doCallback_.bind(this)), this.backoff_.on("backoff", this.handleBackoff_.bind(this)), this.failAfter_ > 0 && this.backoff_.failAfter(this.failAfter_), this.state_ = c.State_.RUNNING, this.doCall_(!1) }, c.prototype.doCall_ = function (e) { e && this.numRetries_++; var t = ["call"].concat(this.arguments_); r.EventEmitter.prototype.emit.apply(this, t); var n = this.handleFunctionCallback_.bind(this); this.function_.apply(null, this.arguments_.concat(n)) }, c.prototype.doCallback_ = function () { this.callback_.apply(null, this.lastResult_) }, c.prototype.handleFunctionCallback_ = function () { if (!this.isAborted()) { var e = Array.prototype.slice.call(arguments); this.lastResult_ = e, r.EventEmitter.prototype.emit.apply(this, ["callback"].concat(e)); var t = e[0]; t && this.retryPredicate_(t) ? this.backoff_.backoff(t) : (this.state_ = c.State_.COMPLETED, this.doCallback_()) } }, c.prototype.handleBackoff_ = function (e, t, n) { this.emit("backoff", e, t, n) }, e.exports = c }, function (e, t, n) { var r = n(43); e.exports = function (e) { var t = e.replace(/-/g, "+").replace(/_/g, "/"); switch (t.length % 4) { case 0: break; case 2: t += "=="; break; case 3: t += "="; break; default: throw "Illegal base64url string!" }try { return function (e) { return decodeURIComponent(r(e).replace(/(.)/g, (function (e, t) { var n = t.charCodeAt(0).toString(16).toUpperCase(); return n.length < 2 && (n = "0" + n), "%" + n }))) }(t) } catch (e) { return r(t) } } }, function (e, t) { function n(e) { this.message = e } n.prototype = new Error, n.prototype.name = "InvalidCharacterError", e.exports = "undefined" != typeof window && window.atob && window.atob.bind(window) || function (e) { var t = String(e).replace(/=+$/, ""); if (t.length % 4 == 1) throw new n("'atob' failed: The string to be decoded is not correctly encoded."); for (var r, i, o = 0, a = 0, s = ""; i = t.charAt(a++); ~i && (r = o % 4 ? 64 * r + i : i, o++ % 4) ? s += String.fromCharCode(255 & r >> (-2 * o & 6)) : 0)i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i); return s } }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); t.default = { HEARTBEAT_PERIOD: 5e3, HEARTBEAT_TIMEOUT: 2e3, RECONNECT_INITIAL_DELAY: 50, RECONNECT_MAX_DELAY: 1e3, RECONNECT_MAX: 50 } }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.version = "0.2.7" }, function (e, t, n) { e.exports = function (e) { var t = {}; function n(r) { if (t[r]) return t[r].exports; var i = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(i.exports, i, i.exports, n), i.l = !0, i.exports } return n.m = e, n.c = t, n.d = function (e, t, r) { n.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: r }) }, n.r = function (e) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, n.t = function (e, t) { if (1 & t && (e = n(e)), 8 & t) return e; if (4 & t && "object" == typeof e && e && e.__esModule) return e; var r = Object.create(null); if (n.r(r), Object.defineProperty(r, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var i in e) n.d(r, i, function (t) { return e[t] }.bind(null, i)); return r }, n.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return n.d(t, "a", t), t }, n.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, n.p = "", n(n.s = 86) }({ 17: function (e, t, n) { var r, i; void 0 === (i = "function" == typeof (r = function (n) { "use strict"; function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var i = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return t = e, (n = [{ key: "getFirstMatch", value: function (e, t) { var n = t.match(e); return n && n.length > 0 && n[1] || "" } }, { key: "getSecondMatch", value: function (e, t) { var n = t.match(e); return n && n.length > 1 && n[2] || "" } }, { key: "matchAndReturnConst", value: function (e, t, n) { if (e.test(t)) return n } }, { key: "getWindowsVersionName", value: function (e) { switch (e) { case "NT": return "NT"; case "XP": return "XP"; case "NT 5.0": return "2000"; case "NT 5.1": return "XP"; case "NT 5.2": return "2003"; case "NT 6.0": return "Vista"; case "NT 6.1": return "7"; case "NT 6.2": return "8"; case "NT 6.3": return "8.1"; case "NT 10.0": return "10"; default: return } } }, { key: "getAndroidVersionName", value: function (e) { var t = e.split(".").splice(0, 2).map((function (e) { return parseInt(e, 10) || 0 })); if (t.push(0), !(1 === t[0] && t[1] < 5)) return 1 === t[0] && t[1] < 6 ? "Cupcake" : 1 === t[0] && t[1] >= 6 ? "Donut" : 2 === t[0] && t[1] < 2 ? "Eclair" : 2 === t[0] && 2 === t[1] ? "Froyo" : 2 === t[0] && t[1] > 2 ? "Gingerbread" : 3 === t[0] ? "Honeycomb" : 4 === t[0] && t[1] < 1 ? "Ice Cream Sandwich" : 4 === t[0] && t[1] < 4 ? "Jelly Bean" : 4 === t[0] && t[1] >= 4 ? "KitKat" : 5 === t[0] ? "Lollipop" : 6 === t[0] ? "Marshmallow" : 7 === t[0] ? "Nougat" : 8 === t[0] ? "Oreo" : void 0 } }, { key: "getVersionPrecision", value: function (e) { return e.split(".").length } }, { key: "compareVersions", value: function (t, n) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], i = e.getVersionPrecision(t), o = e.getVersionPrecision(n), a = Math.max(i, o), s = 0, c = e.map([t, n], (function (t) { var n = a - e.getVersionPrecision(t), r = t + new Array(n + 1).join(".0"); return e.map(r.split("."), (function (e) { return new Array(20 - e.length).join("0") + e })).reverse() })); for (r && (s = a - Math.min(i, o)), a -= 1; a >= s;) { if (c[0][a] > c[1][a]) return 1; if (c[0][a] === c[1][a]) { if (a === s) return 0; a -= 1 } else if (c[0][a] < c[1][a]) return -1 } } }, { key: "map", value: function (e, t) { var n, r = []; if (Array.prototype.map) return Array.prototype.map.call(e, t); for (n = 0; n < e.length; n += 1)r.push(t(e[n])); return r } }]) && r(t, n), e; var t, n }(); n.default = i, e.exports = t.default }) ? r.apply(t, [t]) : r) || (e.exports = i) }, 86: function (e, t, n) { var r, i, o; i = [t, n(87)], void 0 === (o = "function" == typeof (r = function (n, r) { "use strict"; function i(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var o; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = (o = r) && o.__esModule ? o : { default: o }; var a = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return t = e, (n = [{ key: "getParser", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; if ("string" != typeof e) throw new Error("UserAgent should be a string"); return new r.default(e, t) } }, { key: "parse", value: function (e) { return new r.default(e).getResult() } }]) && i(t, n), e; var t, n }(); n.default = a, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) }, 87: function (e, t, n) { var r, i, o; i = [t, n(88), n(89), n(90), n(91), n(17)], void 0 === (o = "function" == typeof (r = function (n, r, i, o, a, s) { "use strict"; function c(e) { return e && e.__esModule ? e : { default: e } } function u(e) { return (u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function f(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = c(r), i = c(i), o = c(o), a = c(a), s = c(s); var l = function () { function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), null == t || "" === t) throw new Error("UserAgent parameter can't be empty"); this._ua = t, this.parsedResult = {}, !0 !== n && this.parse() } return t = e, (n = [{ key: "getUA", value: function () { return this._ua } }, { key: "test", value: function (e) { return e.test(this._ua) } }, { key: "parseBrowser", value: function () { var e = this; this.parsedResult.browser = {}; var t = r.default.find((function (t) { if ("function" == typeof t.test) return t.test(e); if (t.test instanceof Array) return t.test.some((function (t) { return e.test(t) })); throw new Error("Browser's test function is not valid") })); return t && (this.parsedResult.browser = t.describe(this.getUA())), this.parsedResult.browser } }, { key: "getBrowser", value: function () { return this.parsedResult.browser ? this.parsedResult.browser : this.parseBrowser() } }, { key: "getBrowserName", value: function (e) { return e ? String(this.getBrowser().name).toLowerCase() || "" : this.getBrowser().name || "" } }, { key: "getBrowserVersion", value: function () { return this.getBrowser().version } }, { key: "getOS", value: function () { return this.parsedResult.os ? this.parsedResult.os : this.parseOS() } }, { key: "parseOS", value: function () { var e = this; this.parsedResult.os = {}; var t = i.default.find((function (t) { if ("function" == typeof t.test) return t.test(e); if (t.test instanceof Array) return t.test.some((function (t) { return e.test(t) })); throw new Error("Browser's test function is not valid") })); return t && (this.parsedResult.os = t.describe(this.getUA())), this.parsedResult.os } }, { key: "getOSName", value: function (e) { var t = this.getOS().name; return e ? String(t).toLowerCase() || "" : t || "" } }, { key: "getOSVersion", value: function () { return this.getOS().version } }, { key: "getPlatform", value: function () { return this.parsedResult.platform ? this.parsedResult.platform : this.parsePlatform() } }, { key: "getPlatformType", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0], t = this.getPlatform(), n = t.type; return e ? String(n).toLowerCase() || "" : n || "" } }, { key: "parsePlatform", value: function () { var e = this; this.parsedResult.platform = {}; var t = o.default.find((function (t) { if ("function" == typeof t.test) return t.test(e); if (t.test instanceof Array) return t.test.some((function (t) { return e.test(t) })); throw new Error("Browser's test function is not valid") })); return t && (this.parsedResult.platform = t.describe(this.getUA())), this.parsedResult.platform } }, { key: "getEngine", value: function () { return this.parsedResult.engine ? this.parsedResult.engine : this.parseEngine() } }, { key: "getEngineName", value: function (e) { return e ? String(this.getEngine().name).toLowerCase() || "" : this.getEngine().name || "" } }, { key: "parseEngine", value: function () { var e = this; this.parsedResult.engine = {}; var t = a.default.find((function (t) { if ("function" == typeof t.test) return t.test(e); if (t.test instanceof Array) return t.test.some((function (t) { return e.test(t) })); throw new Error("Browser's test function is not valid") })); return t && (this.parsedResult.engine = t.describe(this.getUA())), this.parsedResult.engine } }, { key: "parse", value: function () { return this.parseBrowser(), this.parseOS(), this.parsePlatform(), this.parseEngine(), this } }, { key: "getResult", value: function () { return Object.assign({}, this.parsedResult) } }, { key: "satisfies", value: function (e) { var t = this, n = {}, r = 0, i = {}, o = 0; if (Object.keys(e).forEach((function (t) { var a = e[t]; "string" == typeof a ? (i[t] = a, o += 1) : "object" === u(a) && (n[t] = a, r += 1) })), r > 0) { var a = Object.keys(n), s = a.find((function (e) { return t.isOS(e) })); if (s) { var c = this.satisfies(n[s]); if (void 0 !== c) return c } var f = a.find((function (e) { return t.isPlatform(e) })); if (f) { var l = this.satisfies(n[f]); if (void 0 !== l) return l } } if (o > 0) { var d = Object.keys(i).find((function (e) { return t.isBrowser(e) })); if (void 0 !== d) return this.compareVersion(i[d]) } } }, { key: "isBrowser", value: function (e) { return this.getBrowserName(!0) === String(e).toLowerCase() } }, { key: "compareVersion", value: function (e) { var t = [0], n = e, r = !1, i = this.getBrowserVersion(); if ("string" == typeof i) return ">" === e[0] || "<" === e[0] ? (n = e.substr(1), "=" === e[1] ? (r = !0, n = e.substr(2)) : t = [], ">" === e[0] ? t.push(1) : t.push(-1)) : "=" === e[0] ? n = e.substr(1) : "~" === e[0] && (r = !0, n = e.substr(1)), t.indexOf(s.default.compareVersions(i, n, r)) > -1 } }, { key: "isOS", value: function (e) { return this.getOSName(!0) === String(e).toLowerCase() } }, { key: "isPlatform", value: function (e) { return this.getPlatformType(!0) === String(e).toLowerCase() } }, { key: "isEngine", value: function (e) { return this.getEngineName(!0) === String(e).toLowerCase() } }, { key: "is", value: function (e) { return this.isBrowser(e) || this.isOS(e) || this.isPlatform(e) } }, { key: "some", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : []; return t.some((function (t) { return e.is(t) })) } }]) && f(t.prototype, n), e; var t, n }(); n.default = l, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) }, 88: function (e, t, n) { var r, i, o; i = [t, n(17)], void 0 === (o = "function" == typeof (r = function (n, r) { "use strict"; var i; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = (i = r) && i.__esModule ? i : { default: i }; var o = /version\/(\d+(\.?_?\d+)+)/i, a = [{ test: [/googlebot/i], describe: function (e) { var t = { name: "Googlebot" }, n = r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/opera/i], describe: function (e) { var t = { name: "Opera" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:opera)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/opr\/|opios/i], describe: function (e) { var t = { name: "Opera" }, n = r.default.getFirstMatch(/(?:opr|opios)[\s\/](\S+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/SamsungBrowser/i], describe: function (e) { var t = { name: "Samsung Internet for Android" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/Whale/i], describe: function (e) { var t = { name: "NAVER Whale Browser" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/MZBrowser/i], describe: function (e) { var t = { name: "MZ Browser" }, n = r.default.getFirstMatch(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/focus/i], describe: function (e) { var t = { name: "Focus" }, n = r.default.getFirstMatch(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/swing/i], describe: function (e) { var t = { name: "Swing" }, n = r.default.getFirstMatch(/(?:swing)[\s\/](\d+(?:\.\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/coast/i], describe: function (e) { var t = { name: "Opera Coast" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:coast)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/yabrowser/i], describe: function (e) { var t = { name: "Yandex Browser" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/ucbrowser/i], describe: function (e) { var t = { name: "UC Browser" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:ucbrowser)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/Maxthon|mxios/i], describe: function (e) { var t = { name: "Maxthon" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:Maxthon|mxios)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/epiphany/i], describe: function (e) { var t = { name: "Epiphany" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:epiphany)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/puffin/i], describe: function (e) { var t = { name: "Puffin" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:puffin)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/sleipnir/i], describe: function (e) { var t = { name: "Sleipnir" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:sleipnir)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/k-meleon/i], describe: function (e) { var t = { name: "K-Meleon" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/(?:k-meleon)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/micromessenger/i], describe: function (e) { var t = { name: "WeChat" }, n = r.default.getFirstMatch(/(?:micromessenger)[\s\/](\d+(\.?_?\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/msie|trident/i], describe: function (e) { var t = { name: "Internet Explorer" }, n = r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/edg([ea]|ios)/i], describe: function (e) { var t = { name: "Microsoft Edge" }, n = r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/vivaldi/i], describe: function (e) { var t = { name: "Vivaldi" }, n = r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/seamonkey/i], describe: function (e) { var t = { name: "SeaMonkey" }, n = r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/sailfish/i], describe: function (e) { var t = { name: "Sailfish" }, n = r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i, e); return n && (t.version = n), t } }, { test: [/silk/i], describe: function (e) { var t = { name: "Amazon Silk" }, n = r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/phantom/i], describe: function (e) { var t = { name: "PhantomJS" }, n = r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/slimerjs/i], describe: function (e) { var t = { name: "SlimerJS" }, n = r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/blackberry|\bbb\d+/i, /rim\stablet/i], describe: function (e) { var t = { name: "BlackBerry" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/(web|hpw)[o0]s/i], describe: function (e) { var t = { name: "WebOS Browser" }, n = r.default.getFirstMatch(o, e) || r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/bada/i], describe: function (e) { var t = { name: "Bada" }, n = r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/tizen/i], describe: function (e) { var t = { name: "Tizen" }, n = r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/qupzilla/i], describe: function (e) { var t = { name: "QupZilla" }, n = r.default.getFirstMatch(/(?:qupzilla)[\s\/](\d+(\.?_?\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/firefox|iceweasel|fxios/i], describe: function (e) { var t = { name: "Firefox" }, n = r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s\/](\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/chromium/i], describe: function (e) { var t = { name: "Chromium" }, n = r.default.getFirstMatch(/(?:chromium)[\s\/](\d+(\.?_?\d+)+)/i, e) || r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/chrome|crios|crmo/i], describe: function (e) { var t = { name: "Chrome" }, n = r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: function (e) { var t = !e.test(/like android/i), n = e.test(/android/i); return t && n }, describe: function (e) { var t = { name: "Android Browser" }, n = r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/playstation 4/i], describe: function (e) { var t = { name: "PlayStation 4" }, n = r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/safari|applewebkit/i], describe: function (e) { var t = { name: "Safari" }, n = r.default.getFirstMatch(o, e); return n && (t.version = n), t } }, { test: [/.*/i], describe: function (e) { return { name: r.default.getFirstMatch(/^(.*)\/(.*) /, e), version: r.default.getSecondMatch(/^(.*)\/(.*) /, e) } } }]; n.default = a, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) }, 89: function (e, t, n) { var r, i, o; i = [t, n(17)], void 0 === (o = "function" == typeof (r = function (n, r) { "use strict"; var i; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = (i = r) && i.__esModule ? i : { default: i }; var o = [{ test: [/windows phone/i], describe: function (e) { return { name: "Windows Phone", version: r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i, e) } } }, { test: [/windows/i], describe: function (e) { var t = r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i, e); return { name: "Windows", version: t, versionName: r.default.getWindowsVersionName(t) } } }, { test: [/macintosh/i], describe: function (e) { return { name: "macOS", version: r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i, e).replace(/[_\s]/g, ".") } } }, { test: [/(ipod|iphone|ipad)/i], describe: function (e) { return { name: "iOS", version: r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i, e).replace(/[_\s]/g, ".") } } }, { test: function (e) { var t = !e.test(/like android/i), n = e.test(/android/i); return t && n }, describe: function (e) { var t = r.default.getFirstMatch(/android[\s\/-](\d+(\.\d+)*)/i, e), n = r.default.getAndroidVersionName(t), i = { name: "Android", version: t }; return n && (i.versionName = n), i } }, { test: [/(web|hpw)[o0]s/i], describe: function (e) { var t = r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i, e), n = { name: "WebOS" }; return t && t.length && (n.version = t), n } }, { test: [/blackberry|\bbb\d+/i, /rim\stablet/i], describe: function (e) { return { name: "BlackBerry", version: r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i, e) || r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i, e) || r.default.getFirstMatch(/\bbb(\d+)/i, e) } } }, { test: [/bada/i], describe: function (e) { return { name: "Bada", version: r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i, e) } } }, { test: [/tizen/i], describe: function (e) { return { name: "Tizen", version: r.default.getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i, e) } } }, { test: [/linux/i], describe: function () { return { name: "Linux" } } }, { test: [/CrOS/], describe: function () { return { name: "Chrome OS" } } }, { test: [/PlayStation 4/], describe: function (e) { return { name: "PlayStation 4", version: r.default.getFirstMatch(/PlayStation 4[\/\s](\d+(\.\d+)*)/i, e) } } }]; n.default = o, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) }, 90: function (e, t, n) { var r, i, o; i = [t, n(17)], void 0 === (o = "function" == typeof (r = function (n, r) { "use strict"; var i; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = (i = r) && i.__esModule ? i : { default: i }; var o = "tablet", a = "mobile", s = "desktop", c = "tv", u = [{ test: [/googlebot/i], describe: function () { return { type: "bot", vendor: "Google" } } }, { test: [/huawei/i], describe: function (e) { var t = r.default.getFirstMatch(/(can-l01)/i, e) && "Nova", n = { type: a, vendor: "Huawei" }; return t && (n.model = t), n } }, { test: [/nexus\s*(?:7|8|9|10).*/i], describe: function () { return { type: o, vendor: "Nexus" } } }, { test: [/ipad/i], describe: function () { return { type: o, vendor: "Apple", model: "iPad" } } }, { test: [/kftt build/i], describe: function () { return { type: o, vendor: "Amazon", model: "Kindle Fire HD 7" } } }, { test: [/silk/i], describe: function () { return { type: o, vendor: "Amazon" } } }, { test: [/tablet/i], describe: function () { return { type: o } } }, { test: function (e) { var t = e.test(/ipod|iphone/i), n = e.test(/like (ipod|iphone)/i); return t && !n }, describe: function (e) { var t = r.default.getFirstMatch(/(ipod|iphone)/i, e); return { type: a, vendor: "Apple", model: t } } }, { test: [/nexus\s*[0-6].*/i, /galaxy nexus/i], describe: function () { return { type: a, vendor: "Nexus" } } }, { test: [/[^-]mobi/i], describe: function () { return { type: a } } }, { test: function (e) { return "blackberry" === e.getBrowserName(!0) }, describe: function () { return { type: a, vendor: "BlackBerry" } } }, { test: function (e) { return "bada" === e.getBrowserName(!0) }, describe: function () { return { type: a } } }, { test: function (e) { return "windows phone" === e.getBrowserName() }, describe: function () { return { type: a, vendor: "Microsoft" } } }, { test: function (e) { var t = Number(String(e.getOSVersion()).split(".")[0]); return "android" === e.getOSName(!0) && t >= 3 }, describe: function () { return { type: o } } }, { test: function (e) { return "android" === e.getOSName(!0) }, describe: function () { return { type: a } } }, { test: function (e) { return "macos" === e.getOSName(!0) }, describe: function () { return { type: s, vendor: "Apple" } } }, { test: function (e) { return "windows" === e.getOSName(!0) }, describe: function () { return { type: s } } }, { test: function (e) { return "linux" === e.getOSName(!0) }, describe: function () { return { type: s } } }, { test: function (e) { return "playstation 4" === e.getOSName(!0) }, describe: function () { return { type: c } } }]; n.default = u, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) }, 91: function (e, t, n) { var r, i, o; i = [t, n(17)], void 0 === (o = "function" == typeof (r = function (n, r) { "use strict"; var i; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0, r = (i = r) && i.__esModule ? i : { default: i }; var o = [{ test: function (e) { return "microsoft edge" === e.getBrowserName(!0) }, describe: function (e) { return { name: "EdgeHTML", version: r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i, e) } } }, { test: [/trident/i], describe: function (e) { var t = { name: "Trident" }, n = r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: function (e) { return e.test(/presto/i) }, describe: function (e) { var t = { name: "Presto" }, n = r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: function (e) { var t = e.test(/gecko/i), n = e.test(/like gecko/i); return t && !n }, describe: function (e) { var t = { name: "Gecko" }, n = r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }, { test: [/(apple)?webkit\/537\.36/i], describe: function () { return { name: "Blink" } } }, { test: [/(apple)?webkit/i], describe: function (e) { var t = { name: "WebKit" }, n = r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i, e); return n && (t.version = n), t } }]; n.default = o, e.exports = t.default }) ? r.apply(t, i) : r) || (e.exports = o) } }) }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = n(16), a = n(20), s = n(8), c = n(4), u = n(5), f = function (e) { function t(t, n, r, i, o, a, s, c, f, l, d, p, h) { void 0 === l && (l = !1), void 0 === d && (d = !1), void 0 === p && (p = !1), void 0 === h && (h = !1); var v = e.call(this, t, n, r, i, o, a, f, s, c) || this; return v.isPSTNCall = l, v.isEarlyMedia = d, v.isDynamicDestinationCall = p, v.isSIPCall = h, f || (v.options = l ? u.CallPhoneNumberOptions.builder().build() : u.CallOptions.builder().build()), v.createPC(), v.initEventHandlers(), v.startCall(), v } return i(t, e), t.prototype.cleanup = function () { var n = this; e.prototype.cleanup.call(this), this.eventEmitter.removeAllListeners("ringing"), this.eventEmitter.removeAllListeners("call_response"), this.eventEmitter.removeAllListeners("call_accepted"), this.eventEmitter.removeAllListeners("hangup"), this.eventEmitter.removeAllListeners("call-error"), this.eventEmitter.removeAllListeners("trickle_ice"), t.ALLOWED_API_EVENTS.forEach((function (e) { return n.apiEventEmitter.removeAllListeners(e) })) }, t.prototype.getAllowedApiEvents = function () { return t.ALLOWED_API_EVENTS }, t.prototype.onIceConnectionStateChange = function () { if (this.pc) { var e = this.pc.iceConnectionState; if ("connected" === e) { var t = { localStream: this.localStream, remoteStream: this.remoteStream }; this.callStatus = c.CallStatus.ESTABLISHED, this.isEarlyMedia || (this.callEstablishTime = new Date); var n = this.isEarlyMedia ? "early-media" : "established"; this.apiEventEmitter.emit(n, t) } this.logger.log(new s.IceConnectionChangeLog(this.callId, { state: e })) } }, t.prototype.initEventHandlers = function () { var e = this; this.eventEmitter.once("ringing", (function (t) { return e.ringingHandler(t) })), this.eventEmitter.once("call_response", (function (t) { return e.responseHandler(t) })), this.eventEmitter.once("call_accepted", (function (t) { return e.callAcceptedHandler(t) })), this.eventEmitter.once("hangup", (function (t) { return e.hangupHandler(t) })), this.eventEmitter.once("call-error", (function (t) { return e.errorHandler(t) })), this.eventEmitter.on("trickle_ice", this.handleTrickleIce.bind(this)) }, t.prototype.startCall = function () { var e = this, t = this; this.getLocalStream(t.options.video).then((function (n) { return e.setLocalStream(t, n) })).then((function (n) { return e.addTracks(t.pc, n) })).then((function () { return t.pc.createOffer() })).then((function (n) { return e.setLocalDescription(t.pc, n) })).then((function (n) { return e.sendOffer(t, n) })).catch((function (t) { return e.handleCallFlowError(t) })) }, t.prototype.sendOffer = function (e, t) { var n = e.options.video, r = e.options.customData, i = e.options.from, o = e.isSIPCall ? "sip_call" : e.isDynamicDestinationCall ? "dynamic_destination_call" : e.isPSTNCall ? "pstn_call" : n ? "video_call" : "call"; this.callStatus = c.CallStatus.CALLING, e.gateway.send({ action: o, callId: e.callId, correlationId: e.corrId, destination: e.callDestination.identity, from: i, description: t, customData: r }) }, t.prototype.ringingHandler = function (e) { this.apiEventEmitter.emit("ringing", {}) }, t.prototype.responseHandler = function (e) { var t = this; this.isEarlyMedia = e.isEarlyMedia, this.pc.setRemoteDescription(e.description).then((function () { t.setRemoteCandidates(), t.hasRemoteDescription = !0 })).catch((function (e) { return t.handleCallFlowError(e, !0) })) }, t.prototype.callAcceptedHandler = function (e) { var t = { localStream: this.localStream, remoteStream: this.remoteStream }; this.callStatus = c.CallStatus.ESTABLISHED, this.callEstablishTime = new Date, this.apiEventEmitter.emit("established", t) }, t.prototype.handleCallFlowError = function (e, t) { void 0 === t && (t = !1), this.logger.log(new s.ErrorLog(this.callId, e)), t && this.gateway.send({ action: "hangup", callId: this.callId }); var n = a.default.getHangupStatus(e); this.eventEmitter.emit("call-error", { status: n }) }, t.ALLOWED_API_EVENTS = ["ringing", "early-media", "established", "hangup", "error", "call-error"], t }(o.DefaultCall); t.DefaultOutgoingCall = f }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); t.default = { DTMF_TONE_DURATION: 500, DTMF_TONE_GAP: 50 } }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(8), i = n(50), o = n(57), a = function () { function e(t, n, r, i) { this.callId = t, this.pc = n, this.isVideo = r, this.logger = i; var o = this; this.interval = setInterval((function () { o.sendStats() }), e.DEFAULT_MONITOR_INTERVAL) } return e.prototype.stop = function () { this.sendTotalCallStats(), clearInterval(this.interval) }, e.prototype.sendTotalCallStats = function () { var e = this.previousCallStats; e && this.logger.log(new r.TotalCallMediaStatsLog(this.callId, e)) }, e.prototype.sendStats = function () { var t = this; this.pc && e.MONITOR_ICE_STATES.includes(this.pc.iceConnectionState) && this.pc.getStats().then((function (e) { var n = i.MediaStatsAdapter.extract(e, t.isVideo), a = o.MediaStatsDiffUtil.diff(t.previousCallStats, n, t.isVideo); t.logger.log(new r.CallMediaStatsLog(t.callId, a, a.timestamp)), t.previousCallStats = n })) }, e.MONITOR_ICE_STATES = ["connected", "completed"], e.DEFAULT_MONITOR_INTERVAL = 1e3, e }(); t.PeerConnectionMediaMonitor = a }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(17), i = function () { function e() { } return e.extract = function (t, n) { var i = new r.CallStats(n), o = null; return t.forEach((function (n) { "transport" === n.type && "connected" === n.dtlsState ? o = t.get(n.selectedCandidatePairId) : "inbound-rtp" === n.type ? e.extractInboundRTPStats(i, n) : "outbound-rtp" === n.type ? e.extractOutboundRTPStats(i, n) : "track" === n.type && e.extractTrackRTPStats(i, n) })), o || (o = e.getSelectedCandidatePair(t)), o && e.extractTransportMetrics(i, o), i }, e.getSelectedCandidatePair = function (e) { var t = null; return e.forEach((function (e) { "candidate-pair" === e.type && e.selected && (t = e) })), t }, e.extractInboundRTPStats = function (t, n) { "audio" === n.kind ? (e.extractCommonRemoteMediaStats(t.audio.remote, n), e.extractJitter(t.audio.remote, n)) : (e.extractCommonRemoteMediaStats(t.video.remote, n), e.extractVideoRemoteMediaStats(t.video.remote, n)) }, e.extractOutboundRTPStats = function (t, n) { "audio" === n.kind ? e.extractCommonLocalMediaStats(t.audio.local, n) : (e.extractCommonLocalMediaStats(t.video.local, n), e.extractVideoLocalMediaStats(t.video.local, n)) }, e.extractCommonRemoteMediaStats = function (e, t) { e.packetsReceived = t.packetsReceived, e.packetsLost = t.packetsLost, e.bytesReceived = t.bytesReceived }, e.extractCommonLocalMediaStats = function (e, t) { e.bytesSent = t.bytesSent, e.packetsSent = t.packetsSent, e.retransmittedBytesSent = t.retransmittedBytesSent, e.retransmittedPacketsSent = t.retransmittedPacketsSent }, e.extractJitter = function (e, t) { e.jitter = 1e3 * t.jitter }, e.extractVideoRemoteMediaStats = function (e, t) { e.framesDecoded = t.framesDecoded, e.nackCount = t.nackCount, e.firCount = t.firCount, e.pliCount = t.pliCount, e.qpSum = t.qpSum, e.framesDecoded > 0 && (e.averageQP = Math.round(e.qpSum / e.framesDecoded)) }, e.extractVideoLocalMediaStats = function (e, t) { e.framesEncoded = t.framesEncoded, e.nackCount = t.nackCount, e.firCount = t.firCount, e.pliCount = t.pliCount, e.qpSum = t.qpSum, e.framesEncoded > 0 && (e.averageQP = Math.round(e.qpSum / e.framesEncoded)), e.qualityLimitationReason = t.qualityLimitationReason }, e.extractTrackRTPStats = function (t, n) { "audio" === n.kind && n.remoteSource ? e.extractAverageJitterBufferDelay(t.audio.remote, n) : "video" === n.kind && (n.remoteSource ? (e.extractAverageJitterBufferDelay(t.video.remote, n), e.extractTrackVideoRemoteStats(t.video.remote, n)) : e.extractTrackVideoLocalStats(t.video.local, n)) }, e.extractAverageJitterBufferDelay = function (e, t) { e.jitterBufferDelay = t.jitterBufferDelay, e.jitterBufferEmittedCount = t.jitterBufferEmittedCount, e.jitterBufferEmittedCount > 0 && (e.averageJitterBufferDelay = Math.round(e.jitterBufferDelay / e.jitterBufferEmittedCount)) }, e.extractTrackVideoRemoteStats = function (e, t) { e.frameWidth = t.frameWidth, e.frameHeight = t.frameHeight, e.framesReceived = t.framesReceived, e.framesDropped = t.framesDropped }, e.extractTrackVideoLocalStats = function (e, t) { e.frameWidth = t.frameWidth, e.frameHeight = t.frameHeight, e.framesSent = t.framesSent }, e.extractTransportMetrics = function (e, t) { e.bytesReceived = t.bytesReceived, e.bytesSent = t.bytesSent, e.availableOutgoingBitrate = t.availableOutgoingBitrate, e.currentRoundTripTime = 1e3 * t.currentRoundTripTime }, e }(); t.MediaStatsAdapter = i }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(52), i = n(53), o = function () { function e() { this._local = new r.AudioLocalMediaStats, this._remote = new i.AudioRemoteMediaStats } return Object.defineProperty(e.prototype, "local", { get: function () { return this._local }, set: function (e) { this._local = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "remote", { get: function () { return this._remote }, set: function (e) { this._remote = e }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { return { local: this.local, remote: this.remote } }, e }(); t.AudioMediaStats = o }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return i(t, e), t.prototype.toJSON = function () { return { packetsSent: this.packetsSent, bytesSent: this.bytesSent, retransmittedPacketsSent: this.retransmittedPacketsSent, retransmittedBytesSent: this.retransmittedBytesSent } }, t }(n(18).LocalMediaStats); t.AudioLocalMediaStats = o }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = function (e) { function t() { var t = null !== e && e.apply(this, arguments) || this; return t._jitter = 0, t } return i(t, e), Object.defineProperty(t.prototype, "jitter", { get: function () { return this._jitter }, set: function (e) { this._jitter = e }, enumerable: !0, configurable: !0 }), t.prototype.toJSON = function () { return { jitter: this.jitter, packetsReceived: this.packetsReceived, bytesReceived: this.bytesReceived, packetsLost: this.packetsLost, averageJitterBufferDelay: this.averageJitterBufferDelay } }, t }(n(19).RemoteMediaStats); t.AudioRemoteMediaStats = o }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(55), i = n(56), o = function () { function e() { this._local = new r.VideoLocalMediaStats, this._remote = new i.VideoRemoteMediaStats } return Object.defineProperty(e.prototype, "local", { get: function () { return this._local }, set: function (e) { this._local = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "remote", { get: function () { return this._remote }, set: function (e) { this._remote = e }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { return { local: this.local, remote: this.remote } }, e }(); t.VideoMediaStats = o }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = function (e) { function t() { var t = null !== e && e.apply(this, arguments) || this; return t._framesSent = 0, t._framesEncoded = 0, t._nackCount = 0, t._firCount = 0, t._pliCount = 0, t._qpSum = 0, t._averageQP = 0, t } return i(t, e), Object.defineProperty(t.prototype, "frameWidth", { get: function () { return this._frameWidth }, set: function (e) { this._frameWidth = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "frameHeight", { get: function () { return this._frameHeight }, set: function (e) { this._frameHeight = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "framesSent", { get: function () { return this._framesSent }, set: function (e) { this._framesSent = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "framesEncoded", { get: function () { return this._framesEncoded }, set: function (e) { this._framesEncoded = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "nackCount", { get: function () { return this._nackCount }, set: function (e) { this._nackCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "firCount", { get: function () { return this._firCount }, set: function (e) { this._firCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "pliCount", { get: function () { return this._pliCount }, set: function (e) { this._pliCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "qpSum", { get: function () { return this._qpSum }, set: function (e) { this._qpSum = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "averageQP", { get: function () { return this._averageQP }, set: function (e) { this._averageQP = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "qualityLimitationReason", { get: function () { return this._qualityLimitationReason }, set: function (e) { this._qualityLimitationReason = e }, enumerable: !0, configurable: !0 }), t.prototype.toJSON = function () { return { packetsSent: this.packetsSent, bytesSent: this.bytesSent, retransmittedPacketsSent: this.retransmittedPacketsSent, retransmittedBytesSent: this.retransmittedBytesSent, frameWidth: this.frameWidth, frameHeight: this.frameHeight, framesSent: this.framesSent, framesEncoded: this.framesEncoded, nackCount: this.nackCount, firCount: this.firCount, pliCount: this.pliCount, averageQP: this.averageQP, qualityLimitationReason: this.qualityLimitationReason } }, t }(n(18).LocalMediaStats); t.VideoLocalMediaStats = o }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = function (e) { function t() { var t = null !== e && e.apply(this, arguments) || this; return t._framesReceived = 0, t._framesDecoded = 0, t._framesDropped = 0, t._nackCount = 0, t._firCount = 0, t._pliCount = 0, t._qpSum = 0, t._averageQP = 0, t } return i(t, e), Object.defineProperty(t.prototype, "frameWidth", { get: function () { return this._frameWidth }, set: function (e) { this._frameWidth = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "frameHeight", { get: function () { return this._frameHeight }, set: function (e) { this._frameHeight = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "framesReceived", { get: function () { return this._framesReceived }, set: function (e) { this._framesReceived = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "framesDecoded", { get: function () { return this._framesDecoded }, set: function (e) { this._framesDecoded = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "framesDropped", { get: function () { return this._framesDropped }, set: function (e) { this._framesDropped = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "nackCount", { get: function () { return this._nackCount }, set: function (e) { this._nackCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "firCount", { get: function () { return this._firCount }, set: function (e) { this._firCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "pliCount", { get: function () { return this._pliCount }, set: function (e) { this._pliCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "qpSum", { get: function () { return this._qpSum }, set: function (e) { this._qpSum = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "averageQP", { get: function () { return this._averageQP }, set: function (e) { this._averageQP = e }, enumerable: !0, configurable: !0 }), t.prototype.toJSON = function () { return { packetsReceived: this.packetsReceived, bytesReceived: this.bytesReceived, packetsLost: this.packetsLost, averageJitterBufferDelay: this.averageJitterBufferDelay, frameWidth: this.frameWidth, frameHeight: this.frameHeight, framesReceived: this.framesReceived, framesDecoded: this.framesDecoded, framesDropped: this.framesDropped, nackCount: this.nackCount, firCount: this.firCount, pliCount: this.pliCount, averageQP: this.averageQP } }, t }(n(19).RemoteMediaStats); t.VideoRemoteMediaStats = o }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(17), i = function () { function e() { } return e.diff = function (t, n, i) { if (!t) return n; var o = new r.CallStats(i); return o.bytesSent = n.bytesSent - t.bytesSent, o.bytesReceived = n.bytesReceived - t.bytesReceived, o.currentRoundTripTime = n.currentRoundTripTime, o.availableOutgoingBitrate = n.availableOutgoingBitrate, e.calculateAudioDiff(o.audio, n.audio, t.audio), e.calculateVideoDiff(o.video, n.video, t.video), o }, e.calculateAudioDiff = function (t, n, r) { e.calculateCommonLocalMediaDiff(t.local, n.local, r.local), e.calculateCommonRemoteMediaDiff(t.remote, n.remote, r.remote), t.remote.jitter = n.remote.jitter }, e.calculateVideoDiff = function (t, n, r) { e.calculateCommonLocalMediaDiff(t.local, n.local, r.local), e.calculateCommonRemoteMediaDiff(t.remote, n.remote, r.remote), e.calculateCommonVideoLocalMediaDiff(t.local, n.local, r.local), e.calculateCommonVideoRemoteMediaDiff(t.remote, n.remote, r.remote) }, e.calculateCommonLocalMediaDiff = function (e, t, n) { e.bytesSent = t.bytesSent - n.bytesSent, e.packetsSent = t.packetsSent - n.packetsSent, e.retransmittedBytesSent = t.retransmittedBytesSent - n.retransmittedBytesSent, e.retransmittedPacketsSent = t.retransmittedPacketsSent - n.retransmittedPacketsSent }, e.calculateCommonRemoteMediaDiff = function (e, t, n) { e.bytesReceived = t.bytesReceived - n.bytesReceived, e.packetsReceived = t.packetsReceived - n.packetsReceived, e.packetsLost = t.packetsLost - n.packetsLost, e.jitterBufferDelay = t.jitterBufferDelay - n.jitterBufferDelay, e.jitterBufferEmittedCount = t.jitterBufferEmittedCount - n.jitterBufferEmittedCount, e.jitterBufferEmittedCount > 0 && (e.averageJitterBufferDelay = Math.round(e.jitterBufferDelay / e.jitterBufferEmittedCount)) }, e.calculateCommonVideoLocalMediaDiff = function (e, t, n) { e.frameHeight = t.frameHeight, e.frameWidth = t.frameWidth, e.framesSent = t.framesSent - n.framesSent, e.framesEncoded = t.framesEncoded - n.framesEncoded, e.nackCount = t.nackCount - n.nackCount, e.firCount = t.firCount - n.firCount, e.pliCount = t.pliCount - n.pliCount, e.qpSum = t.qpSum - n.qpSum, e.qualityLimitationReason = t.qualityLimitationReason, e.framesEncoded > 0 && (e.averageQP = Math.round(e.qpSum / e.framesEncoded)) }, e.calculateCommonVideoRemoteMediaDiff = function (e, t, n) { e.frameHeight = t.frameHeight, e.frameWidth = t.frameWidth, e.framesReceived = t.framesReceived - n.framesReceived, e.framesDecoded = t.framesDecoded - n.framesDecoded, e.framesDropped = t.framesDropped - n.framesDropped, e.nackCount = t.nackCount - n.nackCount, e.firCount = t.firCount - n.firCount, e.pliCount = t.pliCount - n.pliCount, e.qpSum = t.qpSum - n.qpSum, e.framesDecoded > 0 && (e.averageQP = Math.round(e.qpSum / e.framesDecoded)) }, e }(); t.MediaStatsDiffUtil = i }, function (e, t, n) { var r = n(59), i = n(60); e.exports = function (e, t, n) { var o = t && n || 0; "string" == typeof e && (t = "binary" === e ? new Array(16) : null, e = null); var a = (e = e || {}).random || (e.rng || r)(); if (a[6] = 15 & a[6] | 64, a[8] = 63 & a[8] | 128, t) for (var s = 0; s < 16; ++s)t[o + s] = a[s]; return t || i(a) } }, function (e, t) { var n = "undefined" != typeof crypto && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || "undefined" != typeof msCrypto && "function" == typeof window.msCrypto.getRandomValues && msCrypto.getRandomValues.bind(msCrypto); if (n) { var r = new Uint8Array(16); e.exports = function () { return n(r), r } } else { var i = new Array(16); e.exports = function () { for (var e, t = 0; t < 16; t++)0 == (3 & t) && (e = 4294967296 * Math.random()), i[t] = e >>> ((3 & t) << 3) & 255; return i } } }, function (e, t) { for (var n = [], r = 0; r < 256; ++r)n[r] = (r + 256).toString(16).substr(1); e.exports = function (e, t) { var r = t || 0, i = n; return [i[e[r++]], i[e[r++]], i[e[r++]], i[e[r++]], "-", i[e[r++]], i[e[r++]], "-", i[e[r++]], i[e[r++]], "-", i[e[r++]], i[e[r++]], "-", i[e[r++]], i[e[r++]], i[e[r++]], i[e[r++]], i[e[r++]], i[e[r++]]].join("") } }, function (e, t, n) { "use strict"; var r, i = this && this.__extends || (r = function (e, t) { return (r = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } r(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(t, "__esModule", { value: !0 }); var o = n(16), a = n(20), s = n(4), c = n(5), u = function (e) { function t(n, r, i, o, a, c, u, f, l, d, p) { var h = e.call(this, n, r, i, o, a, c, t.getOptions(l), u, f, d, p) || this; return h.remoteOffer = l, h.callStatus = s.CallStatus.CALLING, h.initEventHandlers(), h } return i(t, e), t.getOptions = function (e) { var t = e.sdp.indexOf("m=video") > -1; return c.CallOptions.builder().setVideo(t).build() }, t.prototype.hasRemoteVideo = function () { return this.options.video }, t.prototype.accept = function () { var e = this; this.createPC(); var t = this; this.getLocalStream(t.options.video).then((function (n) { return e.setLocalStream(t, n) })).then((function (n) { return e.addTracks(t.pc, n) })).then((function () { return t.pc.setRemoteDescription(t.remoteOffer) })).then((function () { return e.handleRemoteCandidates(t) })).then((function () { return t.pc.createAnswer() })).then((function (n) { return e.setLocalDescription(t.pc, n) })).then((function (n) { return e.sendAnswer(t, n) })).catch((function (t) { return e.handleCallFlowError(t) })) }, t.prototype.decline = function () { this.callStatus = s.CallStatus.FINISHED, this.gateway.send({ action: "call_response", callId: this.callId, status: "decline", code: 486 }) }, t.prototype.cleanup = function () { var n = this; e.prototype.cleanup.call(this), this.eventEmitter.removeAllListeners("hangup"), this.eventEmitter.removeAllListeners("call-error"), this.eventEmitter.removeAllListeners("trickle_ice"), t.ALLOWED_API_EVENTS.forEach((function (e) { return n.apiEventEmitter.removeAllListeners(e) })) }, t.prototype.getAllowedApiEvents = function () { return t.ALLOWED_API_EVENTS }, t.prototype.initEventHandlers = function () { var e = this; this.eventEmitter.once("hangup", (function (t) { return e.hangupHandler(t) })), this.eventEmitter.once("call-error", (function (t) { return e.errorHandler(t) })), this.eventEmitter.on("trickle_ice", this.handleTrickleIce.bind(this)) }, t.prototype.handleRemoteCandidates = function (e) { e.setRemoteCandidates(), e.hasRemoteDescription = !0 }, t.prototype.sendAnswer = function (e, t) { e.gateway.send({ action: "call_response", callId: this.callId, status: "accept", description: t }) }, t.prototype.handleCallFlowError = function (e) { console.error("Call flow error occurred: " + e), this.gateway.send({ action: "call_response", callId: this.callId, status: "decline", code: 480 }); var t = a.default.getHangupStatus(e); this.eventEmitter.emit("call-error", { status: t }) }, t.ALLOWED_API_EVENTS = ["established", "hangup", "error", "call-error"], t }(o.DefaultCall); t.DefaultIncomingCall = u }, function (e, t, n) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(63), i = function () { function e(e, t, n) { this.apiUrl = "api.infobip.com", this.logs = [], this.interval = this.createInterval(this, t.period), n && (this.apiUrl = n), this.httpClient = r.default.create({ baseURL: "https://" + n, headers: { Authorization: "Bearer " + e, "Content-Type": "application/json" } }) } return e.prototype.log = function (e) { this.logs.push(e) }, e.prototype.stop = function () { clearInterval(this.interval), this.sendLogs() }, e.prototype.setOptions = function (e) { e.period && (clearInterval(this.interval), this.createInterval(this, e.period)) }, e.prototype.sendLogs = function () { var e = this.logs; this.logs = []; var t = this; this.httpClient.request({ method: "POST", url: "/webrtc/log", data: { logEvents: e } }).catch((function (n) { t.ifNotForbidden(n) && (t.logs = t.logs.concat(e)) })) }, e.prototype.createInterval = function (t, n) { return setInterval((function () { t.logs.length > 0 && t.sendLogs() }), n || e.DEFAULT_PERIOD) }, e.prototype.ifNotForbidden = function (t) { return t.response && t.response.status !== e.FORBIDDEN_STATUS_CODE }, e.DEFAULT_PERIOD = 5e3, e.FORBIDDEN_STATUS_CODE = 403, e }(); t.DefaultLogger = i }, function (e, t, n) { e.exports = n(64) }, function (e, t, n) { "use strict"; var r = n(0), i = n(21), o = n(66), a = n(27); function s(e) { var t = new o(e), n = i(o.prototype.request, t); return r.extend(n, o.prototype, t), r.extend(n, t), n } var c = s(n(24)); c.Axios = o, c.create = function (e) { return s(a(c.defaults, e)) }, c.Cancel = n(28), c.CancelToken = n(78), c.isCancel = n(23), c.all = function (e) { return Promise.all(e) }, c.spread = n(79), e.exports = c, e.exports.default = c }, function (e, t) {
